<!DOCTYPE html>

<html lang="ko">

<head>
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>SCREEN MASTER</title>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Nanum+Myeongjo:wght@700;800&display=swap" rel="stylesheet">

    <style>

        :root {

            --primary: #5A6472;

            --primary-light: #7A8494;

            --secondary: #C4A882;

            --accent: #B84430;

            --bg: #F2F3F5;

            --card-bg: #FFFFFF;

            --text: #2C2C2E;

            --text-light: #7A7A80;

            --border: #D8D9DC;

            --shadow: rgba(0, 0, 0, 0.07);

        }



        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

        }



        body {

            font-family: 'Noto Sans KR', sans-serif;

            background: var(--bg);

            color: var(--text);

            line-height: 1.6;

            padding: 20px;

            min-height: 100vh;

        }



        /* 로그인 화면 */

        #loginScreen {

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background: linear-gradient(135deg,#F2F3F5,#EAEBED);

            display: flex;

            align-items: center;

            justify-content: center;

            z-index: 10000;

        }



        .login-box {

            background: white;

            padding: 50px;

            border-radius: 20px;

            box-shadow: 0 20px 60px rgba(0,0,0,0.3);

            max-width: 400px;

            width: 90%;

            text-align: center;

        }



        .login-logo {

            width: 120px;

            height: auto;

            margin-bottom: 30px;

        }



        .login-title {

            font-size: 28px;

            font-weight: 700;

            color: var(--primary);

            margin-bottom: 10px;

        }



        .login-subtitle {

            font-size: 14px;

            color: var(--text-light);

            margin-bottom: 30px;

        }



        .login-input {

            width: 100%;

            padding: 15px;

            border: 2px solid #ddd;

            border-radius: 10px;

            font-size: 16px;

            margin-bottom: 20px;

            transition: all 0.3s;

        }



        .login-input:focus {

            outline: none;

            border-color: var(--primary);

        }



        .login-button {

            width: 100%;

            padding: 15px;

            background:linear-gradient(135deg,var(--primary),var(--primary-light));

            color: white;

            border: none;

            border-radius: 10px;

            font-size: 16px;

            font-weight: 600;

            cursor: pointer;

            transition: all 0.3s;

        }



        .login-button:hover {

            transform: translateY(-2px);

            box-shadow: 0 6px 20px rgba(90, 100, 114, 0.4);

        }



        .login-error {

            color: #dc3545;

            font-size: 14px;

            margin-top: 10px;

            display: none;

        }



        #mainApp {

            display: none;

        }



        .container {

            max-width: 1200px;

            margin: 0 auto;

            animation: fadeIn 0.6s ease-out;

        }



        @keyframes fadeIn {

            from { opacity: 0; transform: translateY(20px); }

            to { opacity: 1; transform: translateY(0); }

        }



        header {

            text-align: center;

            margin-bottom: 50px;

            padding: 40px 20px;

            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);

            border-radius: 20px;

            box-shadow: 0 10px 40px var(--shadow);

            position: relative;

            overflow: hidden;

        }



        header::before {

            content: '';

            position: absolute;

            top: -50%;

            right: -50%;

            width: 200%;

            height: 200%;

            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);

            animation: rotate 20s linear infinite;

        }



        @keyframes rotate {

            from { transform: rotate(0deg); }

            to { transform: rotate(360deg); }

        }



        h1 {

            font-family: 'Nanum Myeongjo', serif;

            font-size: 3em;

            font-weight: 800;

            color: white;

            margin-bottom: 10px;

            letter-spacing: -1px;

            position: relative;

            z-index: 1;

        }



        .subtitle {

            font-size: 1.1em;

            color: rgba(255,255,255,0.9);

            font-weight: 500;

            position: relative;

            z-index: 1;

        }



        .tabs {

            display: flex;

            gap: 15px;

            margin-bottom: 30px;

            justify-content: center;

            flex-wrap: wrap;

        }



        .tab {

            padding: 15px 35px;

            background: var(--card-bg);

            border: 2px solid var(--border);

            border-radius: 50px;

            cursor: pointer;

            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

            font-weight: 700;

            font-size: 1.05em;

            color: var(--text);

            box-shadow: 0 4px 15px rgba(0,0,0,0.05);

        }



        .tab:hover {

            transform: translateY(-2px);

            box-shadow: 0 8px 25px rgba(0,0,0,0.1);

            border-color: var(--primary);

        }



        .tab.active {

            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);

            color: white;

            border-color: var(--primary);

            box-shadow: 0 8px 30px var(--shadow);

        }



        .content {

            display: none;

            animation: slideIn 0.4s ease-out;

        }



        .content.active {

            display: block;

        }



        @keyframes slideIn {

            from { opacity: 0; transform: translateX(-20px); }

            to { opacity: 1; transform: translateX(0); }

        }



        .card {

            background: var(--card-bg);

            padding: 35px;

            border-radius: 20px;

            box-shadow: 0 8px 30px rgba(0,0,0,0.06);

            margin-bottom: 25px;

            border: 1px solid var(--border);

            transition: all 0.3s ease;

        }



        .card:hover {

            box-shadow: 0 12px 40px rgba(0,0,0,0.1);

            transform: translateY(-2px);

        }



        .card-title {

            font-family: 'Nanum Myeongjo', serif;

            font-size: 1.6em;

            font-weight: 800;

            color: var(--primary);

            margin-bottom: 25px;

            display: flex;

            align-items: center;

            gap: 12px;

        }



        .card-title::before {

            content: '';

            width: 6px;

            height: 30px;

            background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);

            border-radius: 3px;

        }



        .input-grid {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));

            gap: 25px;

            margin-bottom: 25px;

        }



        .input-group {

            position: relative;

        }



        label {

            display: block;

            margin-bottom: 10px;

            font-weight: 600;

            color: var(--text);

            font-size: 0.95em;

            text-transform: uppercase;

            letter-spacing: 0.5px;

        }



        input, select {

            width: 100%;

            padding: 14px 18px;

            border: 2px solid var(--border);

            border-radius: 12px;

            font-size: 1em;

            font-family: 'Noto Sans KR', sans-serif;

            transition: all 0.3s ease;

            background: white;

        }



        input:focus, select:focus {

            outline: none;

            border-color: var(--primary);

            box-shadow: 0 0 0 4px rgba(90, 100, 114, 0.1);

        }



        input::placeholder {

            color: #BBBBB8;

        }




        /* ===== 설치장소 다중 입력 ===== */
        /* ===== 설치장소 엔트리 카드 ===== */
        .location-entry-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            overflow: hidden;
            transition: box-shadow 0.2s;
        }
        .location-entry-card:hover {
            box-shadow: 0 4px 20px rgba(44,95,45,0.12);
        }
        .location-entry-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background:linear-gradient(135deg,var(--primary),var(--primary-light));
            color: white;
            cursor: pointer;
            user-select: none;
        }
        .location-entry-num {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.25);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.95em;
            font-weight: 800;
            flex-shrink: 0;
        }
        .location-entry-name {
            flex: 1;
            font-size: 1.05em;
            font-weight: 700;
        }
        .location-entry-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 700;
            background: rgba(255,255,255,0.2);
        }
        .location-entry-body {
            padding: 20px;
        }
        .door-type-select-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .door-type-btn {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: white;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'Noto Sans KR', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .door-type-btn:hover {
            border-color: var(--primary);
            background: rgba(44,95,45,0.05);
        }
        .door-type-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
            box-shadow: 0 3px 10px rgba(44,95,45,0.3);
        }
        .entry-result-box {
            background: transparent;
            border-radius: 0;
            padding: 0;
            color: inherit;
            margin-top: 16px;
        }
        /* 결과 박스 안 카드들 스타일 조정 */
        .entry-result-box .card {
            margin-bottom: 12px !important;
        }
        .entry-result-box .card:last-child {
            margin-bottom: 0 !important;
        }
        .entry-result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
            margin-top: 12px;
        }
        .entry-result-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 10px 12px;
        }
        .entry-result-label {
            font-size: 0.75em;
            color: rgba(255,255,255,0.7);
            margin-bottom: 4px;
        }
        .entry-result-value {
            font-size: 1em;
            font-weight: 700;
        }
        /* ===== 설치장소 엔트리 끝 ===== */


        .location-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 8px;
        }
        .location-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f8f9fa;
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 10px 14px;
            transition: all 0.2s;
        }
        .location-item:focus-within {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(44,95,45,0.08);
        }
        .location-item-num {
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.78em;
            font-weight: 700;
            flex-shrink: 0;
        }
        .location-item input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 4px 6px;
            font-size: 0.95em;
            font-family: 'Noto Sans KR', sans-serif;
            outline: none;
            min-width: 0;
        }
        .location-item input::placeholder { color: #bbb; }
        .location-remove-btn {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 1.2em;
            line-height: 1;
            padding: 2px 4px;
            border-radius: 4px;
            transition: all 0.15s;
            flex-shrink: 0;
        }
        .location-remove-btn:hover { color: #e53935; background: #ffeaea; }
        .location-add-btn {
            display: flex;
            align-items: center;
            gap: 7px;
            padding: 9px 16px;
            background: white;
            border: 2px dashed var(--primary);
            border-radius: 10px;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.2s;
            margin-top: 4px;
            font-family: 'Noto Sans KR', sans-serif;
            width: 100%;
        }
        .location-add-btn:hover {
            background: rgba(44,95,45,0.06);
            border-color: var(--primary-light);
        }
        /* ===== 설치장소 끝 ===== */


        .unit-toggle {

            display: flex;

            gap: 10px;

            margin-bottom: 15px;

        }



        .unit-btn {

            flex: 1;

            padding: 10px;

            background: var(--bg);

            border: 2px solid var(--border);

            border-radius: 10px;

            cursor: pointer;

            font-weight: 600;

            transition: all 0.3s ease;

            color: var(--text-light);

        }



        .unit-btn.active {

            background: var(--primary);

            color: white;

            border-color: var(--primary);

        }



        .results {

            background: linear-gradient(135deg, #F8F6F1 0%, #F0EDE5 100%);

            padding: 30px;

            border-radius: 15px;

            border: 2px solid var(--secondary);

            margin-top: 25px;

        }



        .result-item {

            display: flex;

            justify-content: space-between;

            align-items: center;

            padding: 15px;

            margin-bottom: 12px;

            background: white;

            border-radius: 10px;

            border-left: 4px solid var(--primary);

            transition: all 0.3s ease;

        }



        .result-item:hover {

            transform: translateX(5px);

            box-shadow: 0 4px 15px rgba(0,0,0,0.08);

        }



        .result-item:last-child {

            margin-bottom: 0;

        }



        .result-label {

            font-weight: 600;

            color: var(--text);

            font-size: 1.05em;

        }



        .result-value {

            font-weight: 700;

            color: var(--primary);

            font-size: 1.2em;

            font-family: 'Nanum Myeongjo', serif;

        }



        .result-value-dual {

            display: flex;

            flex-direction: column;

            align-items: flex-end;

            gap: 4px;

        }



        .result-primary {

            font-weight: 700;

            color: var(--primary);

            font-size: 1.2em;

            font-family: 'Nanum Myeongjo', serif;

        }



        .result-secondary {

            font-size: 0.85em;

            color: var(--text-light);

            font-weight: 600;

        }



        .highlight {

            background: linear-gradient(135deg, var(--accent) 0%, #E55A45 100%);

            color: white;

            padding: 20px;

            border-radius: 12px;

            border: none;

            margin-top: 20px;

        }



        .highlight .result-label,

        .highlight .result-value {

            color: white;

        }



        .btn-group {

            display: flex;

            gap: 15px;

            margin-top: 25px;

            flex-wrap: wrap;

        }



        .btn {

            flex: 1;

            min-width: 150px;

            padding: 16px 30px;

            border: none;

            border-radius: 12px;

            font-weight: 700;

            font-size: 1em;

            cursor: pointer;

            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

            text-transform: uppercase;

            letter-spacing: 1px;

            box-shadow: 0 4px 15px rgba(0,0,0,0.1);

        }



        .btn-primary {

            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);

            color: white;

        }



        .btn-primary:hover {

            transform: translateY(-3px);

            box-shadow: 0 8px 25px var(--shadow);

        }



        .btn-secondary {

            background: white;

            color: var(--primary);

            border: 2px solid var(--primary);

        }



        .btn-secondary:hover {

            background: var(--primary);

            color: white;

        }



        .info-section {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));

            gap: 20px;

            margin-top: 25px;

        }



        .info-card {

            background: white;

            padding: 20px;

            border-radius: 12px;

            border: 2px solid var(--border);

            text-align: center;

            transition: all 0.3s ease;

        }



        .info-card:hover {

            border-color: var(--primary);

            transform: scale(1.03);

        }



        .info-number {

            font-size: 2.5em;

            font-weight: 900;

            font-family: 'Nanum Myeongjo', serif;

            color: var(--primary);

            margin-bottom: 8px;

        }



        .info-label {

            font-size: 0.9em;

            color: var(--text-light);

            font-weight: 600;

        }



        footer {

            text-align: center;

            margin-top: 60px;

            padding: 30px;

            color: var(--text-light);

            font-size: 0.9em;

        }



        @media (max-width: 768px) {

            h1 { font-size: 2em; }

            .input-grid { grid-template-columns: 1fr; }

            .btn-group { flex-direction: column; }

            .btn { min-width: 100%; }

            .info-section { grid-template-columns: repeat(2, 1fr); }

        }



        @media (max-width: 1024px) {

            .diagram-container {

                grid-template-columns: 1fr !important;

            }

            

            #hole-positions-single,

            #hole-positions-double {

                grid-template-columns: repeat(3, 1fr) !important;

            }

        }



        .emoji {

            font-size: 1.3em;

            margin-right: 5px;

        }



        .parts-card {

            background: white;

            padding: 20px;

            border-radius: 15px;

            border: 2px solid var(--border);

            text-align: center;

            transition: all 0.3s ease;

            cursor: pointer;

        }



        .parts-card:hover {

            border-color: var(--primary);

            transform: translateY(-5px);

            box-shadow: 0 8px 25px rgba(0,0,0,0.1);

        }



        .parts-icon {

            margin-bottom: 15px;

            padding: 10px;

        }



        .parts-card h4 {

            font-family: 'Nanum Myeongjo', serif;

            font-size: 1.1em;

            font-weight: 800;

            color: var(--primary);

            margin-bottom: 10px;

        }



        .parts-card p {

            font-size: 0.9em;

            color: var(--text-light);

            line-height: 1.5;

        }



        /* 팝업 모달 스타일 */

        .modal {

            display: none;

            position: fixed;

            z-index: 9999;

            left: 0;

            top: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0, 0, 0, 0.8);

            animation: fadeIn 0.3s ease-out;

        }



        .modal-content {

            position: relative;

            margin: 5% auto;

            padding: 0;

            max-width: 90%;

            max-height: 85vh;

            background: white;

            border-radius: 20px;

            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);

            animation: slideIn 0.3s ease-out;

        }



        .modal-header {

            padding: 20px 30px;

            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);

            color: white;

            border-radius: 20px 20px 0 0;

            display: flex;

            justify-content: space-between;

            align-items: center;

        }



        .modal-header h3 {

            margin: 0;

            font-family: 'Nanum Myeongjo', serif;

            font-size: 1.5em;

        }



        .modal-close {

            color: white;

            font-size: 2em;

            font-weight: bold;

            cursor: pointer;

            background: none;

            border: none;

            padding: 0;

            width: 40px;

            height: 40px;

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: all 0.3s ease;

        }



        .modal-close:hover {

            background: rgba(255, 255, 255, 0.2);

            transform: rotate(90deg);

        }



        .modal-body {

            padding: 30px;

            text-align: center;

            overflow: auto;

            max-height: calc(85vh - 100px);

        }



        .modal-body img {

            max-width: 100%;

            height: auto;

            border-radius: 10px;

            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);

        }



        .image-error {

            font-size: 8em;

            margin: 40px 0;

            animation: wiggle 1s ease-in-out infinite;

        }



        .error-message {

            color: var(--text-light);

            font-size: 1.2em;

            margin-top: 20px;

        }



        @keyframes wiggle {

            0%, 100% { transform: rotate(0deg); }

            25% { transform: rotate(-5deg); }

            75% { transform: rotate(5deg); }

        }



        .structure-icon {

            display: inline-flex;

            align-items: center;

            justify-content: center;

            width: 36px;

            height: 36px;

            background: linear-gradient(135deg, var(--secondary) 0%, #E8B863 100%);

            border-radius: 50%;

            cursor: pointer;

            transition: all 0.3s ease;

            margin-left: 10px;

            font-size: 1.3em;

            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);

        }



        .structure-icon:hover {

            background: linear-gradient(135deg, var(--accent) 0%, #D83520 100%);

            transform: scale(1.15) rotate(5deg);

            box-shadow: 0 4px 15px rgba(200, 70, 48, 0.4);

        }



        /* 계산 및 저장 버튼 호버 효과 */

        button[onclick*="calculate"]:hover {

            transform: translateY(-2px);

            box-shadow: 0 6px 20px rgba(90, 100, 114, 0.4) !important;

        }



        button[onclick*="manualSave"]:hover {

            transform: translateY(-2px);

            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4) !important;

        }



        button[onclick*="calculate"]:active,

        button[onclick*="manualSave"]:active {

            transform: translateY(0);

        }



        @keyframes fadeIn {

            from { opacity: 0; }

            to { opacity: 1; }

        }



        /* 프린트 스타일 - Letter 사이즈 (8.5" x 11") 최적화 */

        @media print {

            @page {

                size: letter;

                margin: 0.25in;

            }



            body {

                background: white;

                padding: 0;

                margin: 0;

                font-size: 8pt;

            }



            .container {

                max-width: 100%;

                padding: 0;

                box-shadow: none;

            }



            /* 로그인 화면 숨기기 */

            #loginScreen {

                display: none !important;

            }



            #mainApp {

                display: block !important;

            }



            /* 헤더 최소화 */

            header {

                padding: 8px 12px !important;

                margin-bottom: 8px !important;

                page-break-after: avoid;

            }



            header img {

                height: 25px !important;

            }



            header > div > div:first-child > div:first-child {

                gap: 6px !important;

            }



            header > div > div:first-child > div:first-child > div > div:first-child {

                font-size: 12pt !important;

                margin-bottom: 2px !important;

            }



            header > div > div:first-child > div:first-child > div > div:last-child {

                font-size: 7pt !important;

            }



            header > div > div:nth-child(2) {

                margin: 5px 0 !important;

            }



            header > div > div:nth-child(2) > div:first-child {

                font-size: 14pt !important;

                margin-bottom: 2px !important;

            }



            header > div > div:nth-child(2) > div:last-child {

                font-size: 7pt !important;

            }



            header > div > div:last-child {

                padding-top: 5px !important;

                gap: 6px !important;

                font-size: 6pt !important;

                grid-template-columns: repeat(4, 1fr) !important;

            }



            header > div > div:last-child > div {

                font-size: 6pt !important;

            }



            /* 탭 숨기기 */

            .tabs {

                display: none !important;

            }



            /* 카드 간격 축소 */

            .card {

                padding: 8px !important;

                margin-bottom: 6px !important;

                box-shadow: none !important;

                page-break-inside: avoid;

            }



            .card-title {

                font-size: 10pt !important;

                margin-bottom: 6px !important;

            }



            .card-title::before {

                width: 3px !important;

                height: 15px !important;

            }



            /* 입력 그리드 */

            .input-grid {

                display: grid !important;

                grid-template-columns: repeat(3, 1fr) !important;

                gap: 6px !important;

                margin-bottom: 6px !important;

            }



            .input-group {

                margin-bottom: 0 !important;

            }



            label {

                font-size: 7pt !important;

                margin-bottom: 2px !important;

            }



            input, select {

                font-size: 7pt !important;

                padding: 2px 4px !important;

                border: 1px solid #ddd !important;

            }



            /* 단위 토글 숨기기 */

            .unit-toggle {

                display: none !important;

            }



            /* 버튼 숨기기 */

            button,

            .btn,

            .btn-group,

            .print-button,

            .reset-button {

                display: none !important;

            }



            /* 결과 섹션 */

            .results {

                padding: 6px !important;

                margin-top: 6px !important;

            }



            .result-item {

                padding: 2px 6px !important;

                margin-bottom: 3px !important;

                font-size: 7pt !important;

            }



            .result-label {

                font-size: 7pt !important;

            }



            .result-value, 

            .result-value-dual {

                font-size: 8pt !important;

            }



            .result-primary {

                font-size: 8pt !important;

            }



            .result-secondary {

                font-size: 6pt !important;

            }



            /* 정보 카드 */

            .info-section {

                display: grid !important;

                grid-template-columns: repeat(4, 1fr) !important;

                gap: 4px !important;

                margin: 4px 0 !important;

            }



            .info-card {

                padding: 4px !important;

                margin: 0 !important;

                page-break-inside: avoid;

            }



            .info-number {

                font-size: 12pt !important;

                margin-bottom: 2px !important;

            }



            .info-label {

                font-size: 6pt !important;

            }



            /* 망구멍 정보 */

            .hole-info-section {

                page-break-inside: avoid;

            }



            .hole-info-card {

                padding: 4px !important;

                font-size: 7pt !important;

            }



            .hole-info-header {

                font-size: 8pt !important;

                margin-bottom: 4px !important;

            }



            .hole-list {

                font-size: 6pt !important;

                column-count: 8 !important;

                column-gap: 6px !important;

                line-height: 1.2 !important;

            }



            .hole-item {

                padding: 1px 0 !important;

                break-inside: avoid !important;

            }



            /* 다이어그램 축소 */

            #screen-diagram-single,

            #screen-diagram-double {

                max-height: 80px !important;

                display: block !important;

            }



            /* 하이라이트 */

            .highlight {

                padding: 6px !important;

                margin-top: 4px !important;

            }



            /* 탭 콘텐츠 - 활성화된 것만 표시 */

            .content {

                display: none !important;

            }



            .content.active {

                display: block !important;

            }



            /* 모달 숨기기 */

            #structureModal,

            #partsModal,

            #savedCalculationsModal,

            #estimateModal,

            #calcResultModal,

            #crm-screen-btns,

            .modal {

                display: none !important;

            }



            /* 페이지 브레이크 방지 */

            .card,

            .result-item,

            .info-card,

            .hole-info-card {

                page-break-inside: avoid;

            }



            /* 여백 최소화 */

            h1, h2, h3, p {

                margin: 2px 0 !important;

                padding: 0 !important;

            }



            /* 색상 유지 */

            * {

                -webkit-print-color-adjust: exact !important;

                print-color-adjust: exact !important;

                color-adjust: exact !important;

            }



            /* 부속 리스트 아이콘 축소 */

            .parts-icon {

                width: 15px !important;

                height: 15px !important;

            }



            /* Footer 숨기기 */

            footer {

                display: none !important;

            }



            /* 전체 페이지를 한 장에 맞추기 */

            html, body {

                height: auto !important;

                overflow: visible !important;

            }



            /* 강제로 한 페이지에 맞추기 */

            .container {

                transform: scale(0.95);

                transform-origin: top left;

            }

        }

    </style>



</head>

<body>

    <!-- 로그인 화면 -->

    <div id="loginScreen">

        <div class="login-box">

            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABnIAAAT7CAQAAAAAkea2AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAlwSFlzAAAXEQAAFxEByibzPwAAAAd0SU1FB+oCBgkALW6u+QIAADr0SURBVHja7d1RiF35fdjx30lH9GE2YFxGdoghIzcN8eJR7LJmW0mukkhbG63INnGyyYzCloQW4kaS2+xLuw+ayoT0aVtWWpIQBwIhkhIlIV6QtnUs4WwjCRYHvNFsvcUP1hjW1DsDxlANFDTw78NotFqtNHPvnXvv/5zf/Xz84l3Nvfd/tTN3zvf8/+d/mhIAAAB5/FDtAQAAAAyTyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgc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AACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKTy/wGqMxH1v/k36AAAAABJRU5ErkJggg==" alt="iBuild Logo" class="login-logo">

            <div class="login-title">iBuild INC.</div>

            <div class="login-subtitle">방충망 주문서 계산기</div>

            <input type="password" id="loginPassword" class="login-input" placeholder="비밀번호를 입력하세요" onkeypress="if(event.key==='Enter') login()">

            <button onclick="login()" class="login-button">🔐 로그인</button>

            <div id="loginError" class="login-error">비밀번호가 올바르지 않습니다</div>

        </div>

    </div>



    <!-- 메인 앱 (로그인 후 표시) -->

    <div id="mainApp">

    <div class="container">

        <!-- 통합 모던 헤더 -->

        <header style="background:#FFFFFF;border:1px solid #D8D9DC;border-radius:14px;padding:12px 24px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.06);">
            <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">

                <!-- 좌: 로고 + 회사명 -->
                <div style="display:flex;align-items:center;gap:12px;">
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABnIAAAT7CAQAAAAAkea2AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAlwSFlzAAAXEQAAFxEByibzPwAAAAd0SU1FB+oCBgkALW6u+QIAADr0SURBVHja7d1RiF35fdjx30lH9GE2YFxGdoghIzcN8eJR7LJmW0mukkhbG63INnGyyYzCloQW4kaS2+xLuw+ayoT0aVtWWpIQBwIhkhIlIV6QtnUs4WwjCRYHvNFsvcUP1hjW1DsDxlANFDTw78NotFqtNHPvnXvv/5zf/Xz84l3Nvfd/tTN3zvf8/+d/mhIAAAB5/FDtAQAAAAyTyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZEDAACkInIAAIBURA4AAJCKyAEAAFIROQAAQCoiBwAASEXkAAAAqYgcAAAgFZFD563FcqzVHgQAAK0hcuiwpXi57C2PlT3l35baYwEAoC2mag8A+rccN8qluFB7GAAAtJLIoUPW4o1yMc7UHgYAAK0mcuiA9XgrXit/EEu1BwIAQAeIHFptOS6VV+JK7WEAANAhIodWWovXylcsTAMAYAAih1ZZizfK1fjzeLP2QAAA6CyRQ0ssxWvly3G19jAAAOg8kUNlq/F1C9MAABgikUMlG9tB/2ms1B4IAADJiBzGzHbQAACMlshhbJbjRvkj20EDADBiIoeRW42vlz+JC7WHAQDAhBA5jMx6vF6uxmLtYQAAMGFEDiOwFK+VV4a+MO1kfCY+1azFnlL7/QEA0GYihyEa1cK0c7Gvmb37/9dqv0kAAFpO5DAEa/HGSBamnY2Dzcd8kwIA0BfHj+zIUrxWvhxXh/ysp+NQfKKZrv3mAADoJJHDQFbjq+XS0BemzcevxqeamdpvDgCAThM59GUtXitfiT+NlSE/79k42MzVfnMAAKQgcujJxnbQfx5vDvl5T8eheLLxbQgAwPA4umQbo9wOevuFactxqbwSV+KmeR4AAHokcniEUW0HfTaO3tsOeutX/0qcuffPS2Wuqf03AgBAN4gcHrAWb5SL8WfxzpCft7ftoDc2o/69+F5EROyNz8XPNxF73f4TAICeiRzuWo+34rXyB7E05OftbTvojVffXBb34TgZn4mDdx+1XPuvBgCAThE5xHLcqLgd9Hs3o56Po/GUTaQBANgBkTPBNq57GcV20L1cdbOxGfXFewvT/m1Py9kAAGA7jikn0MZ20H8xkoVp228HvR5vxV+Vv4ybERHx4R6XswEAQK9EzkRZjkvly3F1yM/a73bQG3pdzgYAAP0RORPhwQ2Zh+NwPDPAdtC9PgoAAAYjclLb2JD5d4e+HXRvC9M2Xn1zYdre+FxPjwIAgJ1xxJnSqLaD7nVh2tIjt4MGAIBREznJvHdD5mHpfWHag9tB77MwDQCAMRM5SYxuYdrP97Cx81q8US7aDhoAgFZwHNpxGwvTTgz9eU/Gsz1s7Gw7aAAA2kfkdNZy3Ch/dG9D5mHpdWPn97667aDrWovViJgJeQnUsxwREbO1hwEQESKng0a3HfTBZq7PV+/1UQzfWrxW/i7+90OuvzodT0hOYAzW461Yeuh1oPNxNOb8dgAqEjmdsR6vl6vx5/HmkJ/XdtBdsx5/Xf7rFrd0XYyIKHPxH+MZSweBEVmKvyqLj/zTC3Ehomxc1yl1gBocpXbAclwqX97ioHYwg28HbZagnrV4cYvDivstxbGIcjqeFzrAkF0vn+/xFgWLsVjm4vdif1N7zMCkETktthpfL39ScTvo+1/9cPya7aArW4+L5Vifj1mMxXI2fsOcGzAky/Fzpb97sC3FgThU/tBvEGCsHPu0kO2geb/+Dyw2nYjfLl+1YATYsfV4vgx2RejV2OOECzBWPm9aZGND5r/ocRFA707GZ+JgT9tBv1a+dG876N42kWY8zvc9h3O/d2JvOR0vOLwAdmA1Dg14qmXDifhyuWC5MzAmjnpaYTW++tD9aXZmPo72tMTMdtBt98Uer8PZymL8z/I/ZA4woOvlwI6f42rsLjfNKwNj4ZinsldHsB10xNmelphtbAe9uTDNdtDttB7PleHk79X4rMwBBjKMxNmwt1yzDQEwBo54qnq1PD3U5zsdh3pYYraxGfW720F/3nbQLTasxImQOcBghpc4EREH4lqROcCoOd6p6gdDep5BtoPu/VHU88UhJk7ERuZcGdrBxVo8Vh79p/PbPn5ffHCLP/2x+NFtRjodvnth9JZimIkTEXEgbsVs7bcFJCdyOq3XjZ1tB91Nrw7hWpwHXY2Xy/EhZc7qln+6fZ5t+xVl26fY1u441ONX/mT8+DZf8YF4vIe/OelFLmtxeAg/iQ/6Z+Vts8rASPmM6ajBtoP+XE+Poh1WY7iLGTediIMxOdderQx3Q4+BD/YOxe6ImIknI2JfI4TojmfKygie9Z14rpy3ZG0i/b/4bvyD2oPoi0/srnK82zG9bexsO+gM5kdw9nTDQvmGc6hjdvX+f7j7X/ZkPBlzTjvQaq+Wqzt/koe6EL858JU5zcg+HUenSLq7/ln5+9pD6Js9AbvJb9eOmI+j8VQP188sx437NqPu9VG0z+gOLSLejItlwS/c6s5ERJSIj8cvxROuj6OF1uPXRvjsn4u3HYRMoH8c3YucpTLnd2YH+Xxpvd62g16L12wHncqvj/TZj8UzYWavLd6MNyMiyofi39npkFb5nZEsVdv0jtMtE+kf1h4AE8Nv09YafDtoC9O673p5Z8Sv8GI55eCiZd6JxViMKCfjWalDC6zHyyN+hd+KZx2GACPi06WFzsYv97Qw7ZLtoNP6/MhfYTFe8OPfUmfijNShBS6W1Z0/yZbeib8uR5xuAUbCb9AWOrplrDy4HfQzcdR20MksxdIYXuV1t+NrtTNxJnaX34znzcxSybExvMbTw9gpHuAhRE5nrMUb5Wr8nu2gJ8BfjeW3/n+Or9Z+o2xjJRZjsczH7ziRwdiNehZn05rrA4GRcIzceu/fDvozcdC53dT+fCyvciXWfQB0woW4UCKuhZk3xunPxjTF8poFa8BIOMZptfV4rtgOetKsbuy1NQZvTdBNQbvvQHy8/L7QYWxeGdPr/Ekcqf1WgZR+qPYA2MrFciEOx9m42dxpzjcLEmcifGtsS9SXLIbvlDfjQOwt47heC+LetjajdmHnTwHwECKn9b7UHG/mTLlNkO+M7ZUu1X6r9G0p9paFke95BeP8Hluv/WaBlEQOtMz40sOcQDddiN3l5eLAkFFaG+NrvV37zQIpiRyYWOO69ofhOxH/tCzXHgSJ3RjjYtbvWjgLjIDIeY/z5XoZ5/krgMEsxZ7ysoNDEhjfEl1gkoic+yzHsTgQj5WmfKGcd5YUaLkTcdj1OQDwEK5nf6gzERElYj72xSfjE+5KA7TS1dhd3EEHAB4kcrZ0YWNzy/Lx+KV4Ih5313GgdQ7E2XJc5gDAfUROT97cuET77tzOweajYW4HaIsT8f1ySuYwRD82xtfa53sXGAHX5PTpQpyIveWx0pQvlutWwzMCPzm2V5qv/VYZmsV4yqbSDNGPCg+g40TOwBbjQOwuHyoL5XxZdjMzhubHx/ZK48spRu9K7JI5DM1Hxvhas7XfLJCSyNmhlbgQx2JP2VUOl5dtQM0QzI3tDOr4corx+KzMYUisZQe6TuQMzdU48Z4NqB1sMJiPje2VrITP5qrMYWhOjul1Ttd+o0BSImcEzpjbYQem4vCYXmm29ltl6K7G824QylA8O6bXOVT7jQJJmZEeoatxNeLeBtSfamZqD4iO+A9xZQyv4vxpTmfin9hQmiH4RBNjCeYnfbcCIyFyxuDBDag/5q+dLR0cy8HFcw4tkjoRnyxuD8pOTcf8xp3iRuq034fAiFiuNlYbG1DvKk35YnnVBtQ8wvRYVsPP1n6bjMwvhE8Xdu4/jSGVnWwBRsUplEoWI2I8SwHoov/QnBnxd8e12m+REVqJ3eVO4+OdnZkbw2vM1n6TQFpmcqCFZkd+o07LmbL7fSdR2LFRnwxxsgUYHZEDrfTSSCPkpsRJ70Qs1x4CnTfakyHzTrYAIyRyoJVm4uzInvvkWJahUNvPmcthx1ZGmCFfkjjACImc1vvnd28uyqT5jZEdALzo0GIiLMWrMocdmolzI3rmyzFd+80BqYmcVnu2ORmbNxdtylNuLjpRpkZ0DvWWC9Inxq/Heu0h0HkLzSiuEDwZR5xsAUZK5LTaVLzU/J/mdnMtzsbhuBIn4kA8Vn6qfKG8am5nAsyM4LLca3YzmiDvxEVzOezYH48gR8wnA6MmcjpgOvY3x5uvNneaW825mI+VOBNPx57SlIXycllyrjax/c1wM+esC30nzG/5fGDHpuL2kD83bHAOjJ7PmQ6ZitmYbRYiYjW+Va7GX8aFuBBRIvbG5+KJ+FQzU3uIDN3+5lo5MKTnOhvHJc6EeSculgX/1dmh6Vhpdg9tVlDiAOPgk6aTZmKm2R+nYj3eiqVyKS7EzYiIEjEfR2Nf8xH/YRPZ39yMvUM4vLhmFmci/ZdYqD0EEpiJO82uIXwOzccfSxxgLCxX67SpmIuF5nxTmpXmcpyMvXEhjsWesqs8Vb5ok4I05oawWORWI3Em05uxVHsIpDAVpdnpxvbn4rzEAcZE5CQxE0eal5q/b243N5uzMR9XYjEOxGPlR2xAncJ0lGbwjVxPx51mtvZboJo/tPkAQ3K8ubWDkyW3GksngfEROclMx1wcb843pbnVnIsHN6BeCnM73bXQ3G5O9v2o+bjVnHLudKKdsfkAQzM74AmXy1GcagHGSuSkNRsLzYMbUO8tNqDusul4qbndnO7560/Grea8AwvidXM5DNFCc6e53MfXX4vSuCsOMG4iJ72tNqA+bwPqoVqN1ZG/xnScau4012Lr2/PNx+W43by0ZeBcL6869J0QF2sPgDFaj+sj/8meiiNNaW5ue8rldNxqypbXAy7H+eK3EDAKVrFMDBtQj97uEnE6nhv53MlU7G/2x/lYju+W78Tr96XV0fhAPN7D6y/HnhIRMYmVczi2+k6/UHt4I3EmXqo9BMbm+XImooxjN8W5mGtOxVqsxo3y/bhx79/viw/GvmYmprd5/Hr8TlmMiLDNOTACImcCPWoD6g/Hz9iAescWY7Gci/H8yp6N2Wb/ABsEL5Sch/K9+dKWEXg+Nk4DfCNO1B7oUC3H7I6fg27YOOlxIKKM53400zEds03E8T4ftzSUrfEZteX4v7F0L2If9bvjUOyOiKMRMdf8cDiKoB18H06wqZiLuWYhzsdyfLN8Jf7m3tzO4fh0HHJXlYEdi2MlorT0769xYLGNjdMAx2MtXinHag9mSL5ZZlv6/cjo7PI5xEA2TvTciK/F93p8xNWIuJtAJSJidxyKffHJ+AlrRKhI5BAbMwJHImItvh2vlVfiSlyJxbhcXCq6E0253Wy3XGP8Y6o9gi6ZjoVmIa6XA7UHMgRfiSM9fd16XOzE98hcMzfAo14tP6g98D58IIbxCdy0MHTWYxi3FWX4luNGuTSURbsrGydN796k/FctiKcKkcN9pmMu5prjEfFqeTp+UHs4nfdYiYgYz5KR7Qmcwexv7mxc5dBpvd4QtDPvtPR/4P5qebr2qPt0a0iLDDd+9tuROmt3Pxdpk/V4vVyMP42VkTz7xhqRD8W/i59vPuawkzGyuxoP9Xgrfh3msKs0pam6f9B6NEXiDG4qXmqu1R7EDn2tx68b/f6A9fyg9gAqa0rtz4GmNEXitMtavFqeKrvKgTgzosTZ9E4sxt6yq3yh/K/ab5qJIXJgLDZSZ/w3Y12NplgasnP7O585y7UHQCvUSZ01J1paZz2ul4XyWHk6roz1dc9sbHUEY2DeEMZo8yzmOBaOrMZuBxVDtL+5luLqHNhcwDaOqwZdf9NGq/F75XfjndrDgBEzkwMVbJxNXR7Jc6/ffXaJM2z7t731YZvd8P3AAx4rzQhnmJejKeaR22c5FsrusihxmAAiB6rZc/cQYzgLSNbuxo2DitF5wbVqJPTYED+HNk+yNGWPT6LWuV72lj0TfZ80JovIgZa4P3h6PbO6fN+jXNA7elNxs7OZ83rtAdAJzQCnXlbve5STLG11vewtB3reZxEycE0OtJBgaatB7s7SDpn3TWNUbBaQw3KYV2MSmckB6EPXd1kDJslafMHSQSaUmRyAPjzZhAMGoBPOl2O1hwDVmMkB6MNUnKw9BIBtrcZeicNEEzkAfflM7QEAbON82V1sM8BkEzkAfXm8szusAZNgLRbM4YBrcgD6M1t7AAOZqT0AYCyWYq/rBiHM5ABMhCdrDwAYg/NF4sAGkQPQp/naAwB4n/X4gmVqcI/lagAAHbceny1Xaw8CWkTkAEyAfbZLgMRW45Dd1OA9RA4AQIetxsfLSu1BQMu4JgegT1/q4KzIR2oPABiR1dgtceB9RA5An6ZrD2AApu0hp9XYbT81eAiRA5Ce/eAgp9X4uMSBhxI5AOntqz0AYARWY6+FavAIIgegT8u1B9C3T9YeADB063GofK/2IKC1LNMG6NOezi0P+YkObpUAbG1X5z6JYJzM5ACkN1N7AMCQfVHiwJZEDkByJ2sPABiy62Wx9hCg5UQOQHLP1h4AMFSrcaD2EKD1RA5AX5rOLRL5hCtyIJH1mOvcpxCMn8gBSK6LNy8FHuW58k7tIUAHiByA1C7XHgAwREtxofYQoBNEDkAfurdY7aDFapDGehzu3GcQ1CFyABKbt1gNEnm+rNQeAnSEyAHo2VLtAfTtN2sPABiapThTewjQGSIHoEfrsbdzC0X2W6wGSazHsc59AkE9IgegR7s6d4Bh0wHI42Lp3lwy1CNyAHqyXHsAA/iX5nEgibX497WHAJ0yVXsAAF3QvV3VIs75iIc0XiyrtYcAnWImB2BbXUyciGfN40ASa7FYewjQMSIHYBvdTJxr5nEgjRc7+SkENfkdCEyUt0v0Nb/xzfJ07SEPyL5qkIV5HOifyAEmyqcjJuKM6IrEgTTM40D/LFcDSOdszNQeAjAk5nFgECIHIJ3fMI8DabxiHgcGIHIAkllprESGPH6r9gCgk0QOQCqXLVWDRK6Xd2oPATpJ5AAkcjqOWKoGiVysPQDoKJEDkMgLEgcSWYsztYcAHSVyANK442ocSOU1mw7AgEQOQBI2HIBs/mvtAUBniRyAFFYaGw5ALmtxtfYQoLNEDkACEgfysVgNBidyADpP4kBG/632AKDDLOAG6DjbDUBG63Gl9hCgw8zkAHTYSYkDSb1usRrsgN+NAJ11LhbcFweSsukA7ITIAeiom81c7SEAI/O7tQcAnWa5GkAHnYw7EgcSW4t3ag8BOk3kAHSS9fqQ2Rt+wmFHRA5AB52JA9GU6w6DIKlv1B4AdJzIAeisAzEndCClV2oPADpO5AB02JtxIBbKau1hAEPmHjmwMyIHoOMuxO5y3nwOJLJcewDQeSIHIIFjcbis1R4EMCTfTHLaojQb/6s9DiaRyAFI4Wp8tCzXHgQwFD+oPYCBbWbNe+PmYf8ORkvkACSxEntsQwApXKo9gIH0ljAbqXNT7DBiIgcgkQMhc6D7lmoPoE/9z9HMhTkdRkvkAKQic6D73qw9gL7IFdpI5AAkI3Og27q1KbzEoZ1EDkA6Mge6rEs7JUoc2krkACT0Cx07Fwy867udOUkhcWgvkQOQ0ErsLuu1BwEM5Du1B9AjiUObiRyApJ7vzNlgoHskDu0mcoCJcqspW/5vpbnZnIuTtYc5FGfiVZkDHfR67QFAAiIH4D4zMRcLzUtNaW423U+dpzt1ATOwoQtX1JnHoe1EDsBDzcVLze3mdO1h7NAL5nIAmEAiB+CRpuNUc7vT5yvPxHLtIQB9+lrtAWzLPA7tJ3IAtjQdpdPzOf/GXA50zPdqDwASEDkA2zrVXKs9hIFddWNQACaOyAHowf7mbO0hDOzztQcApGKxGl0gcgB6cryzu60tuS4HgAkjcgB69GJnz17aYw2AySJyAHo0FV29MueC++UAMFFEDkDP9nd2LuePzOUAMEFEDkAfLtcewIB+u/YAAGCMRA5AHw52dC7nnViqPQQAGBuRA9CH6ZivPYQB/ZUFawBMDJED0JejtQcwoN+tPQAAGBuRA9CXfZ1dsLZaewgAMCYiB6AvH6k9gIF91YI1ACaEyAHoy1TtAQzsUu0BAD3p6pV/0CYiB6BPXT0AuVB7AAAwJiIHYGIs1x4AkEBj6SsdIHIAJsY3HZpAB+yrPQBIQOQATIy/qz0AoAcfrD2AbZnLof1EDkCfunqnnIi3ag8A6MGP1R4AJCByAPr0eu0BDOxPaw9gaJxHJrMf7cDduNZrDwC2IXIA+tTlm2qu1R4AsK2Z2gPowS4nGmg5kQMwQbocaDAppmsPoCfXZQ6tJnIA+tTl+818N81hiQVrUNcBmUOriRyAvnR7Jfp3ag9giPr7L/F4B65ygE2naw+gJwecbKDFRA5AX96uPYAd+X7tAQxRf9cEfNLBGB3yRO0B9Ezm0FYiB6Av3b6h5o3aAxiqXq8wWncgRsd0aeaxKX6+aCORA9CXr9QeAPfsLr0sWWuKfaDomtnaA+hT09PPIoyTyAHoS7fvNdPlTRMeZte2h1bOMdNNh2sPoE+7SlNsUU+biByAPlwvK7WHwHvs2mKpjGU0dNcztQcwgMdKU/zU0RYiB6APF2sPgId42EHVmjkcOu1gh67KedBG6mx9zdxynPcTykhN1R4AQHesxZnaQ+ChBA3ZzNUewI7t9lNJVWZyAHr2R35pA2NysvYAoNNEDkCP1uJE7SEAE+MztQcAnSZyAHr0gnkcYGy6fFUO1CdyAHqy5HocYIymaw8AOk3kAPRgLfaaxwHG6nLtAUCHiRyAba3HMxIHGDML1mBwIgdgG+vx2XK19iCAiTNthzUYmMgB2NKqxAEqebb2AKCz3AyUh/qupTkk9c0SfS0A+WZ5uvaQgYm1vwm/j2EgIof7rMa3yjfiRlyIiIgP1B4OjMDTMdmHDPO1BwD05Vwcqz0E6CSRwwNpExFxOD4dT8QRFzxCOvtqDwDoy7PNsYk+MQODEjkT61Fp83gzW3towMh8sPYAgL5MmcuBgYicCfP+tNkbPx1Pxj5pAxNhnxla6BhzOTAIkTMR1uLbsVQuxdfie3f/zWbafMS3AEyUmS3/9Frt4QHvYy4HBuEIN7GHpc2z0gYm2vSWf/qv47drDxB4H3M50D/HuulIG+BRtttb7bMiB1poKi6HzeyhP456k3h/2nw45uNozDUf8x8ZuOvoNn/+pHtyQCsd8bMJfXL822nr8XbcKK/H38TNu/9mM20+us2iFGASPbXNtgNTMX/ftiRAe9xq9sgc6IPI6SBpAwxmZtuv+FWRA600G6djsfYgoENETmdIG2BnTvfwNQctioGWeqFZ9NMJPRM5Lff+tImYj31xUNoAffp8D/fImY7DcaX2QIGHmIqbzV6ZAz0SOa22HO+uwJ2PffHJ+Ilm++UmAA/T26fHfxY50FJzlqxBz0ROq90oEafjkLQBduxyj19nhzVoL0vWoFc/VHsAbOe5Zr/EAXbsX/awWC0iYqqna3eAGqZipcefZJh0IgdgApzuY+L+OQdR0Fozca32EKATRA7ABHi+j3CZrT1YYAv7m3O1hwAdIHIqmY9zcc2iEGAszvW5G6MzxdBmC43jB9iOjQfG6sEd0r7j8kFgDJ7tcwHafpsPQKudav622AcRtiJyxuBwPGPzZ6CaywN81F+LA7WHDWzhvze7nIqALYicETodT8TjzWztYQAT7sgAGwmYy4F2m4o7Mge2IHKG7HB8WtoALTLohrPmcqDdZA5sReQMhbQB2ulyDLpQ1lwOtJ3MgUcTOTtiQRrQZqcHWqq26Vazx+ETtJrMgUexhfQATsa5uNWUpjSnmiMSB2itF3Z0W89Z29xD603FneZk7UFAC5nJ6dnJeDL2NR/xVwZ0xEqz08+rF5pF54ih5abipeYflcXaw4CWccS+DWkDdNPKELatn7L9AHTCqeZQ8bMK93Psfp937wgubYBuuzmkO3Ptb06WM7XfDLCt/c2tcBUdvMs1OfeZiZvNzeZ2U5qXmoVmVuIAHXUt5ob2XC/u6LqedrmZ6L3Ag2bjdjNfexDQGiLnPeZi7r75HIAuWmn2D/FgfipuJUmDleaHaw8BRmo6zjfnag8CWkLkAKQyjGtx3ms2Mhw2Df/vBdpooRn0BsCQi8gBSOTOSA7lFzq/CEbiMDlmopjPAZHTfn9clmO99iCADjgdZcebRj/KH3f63PBo0g/aa6FZaQ7XHgRUJXJaba6JWIw9ZVd5qrxcrpe12gMCWutanBphiExFV5fAnI47I0s/aK+Z+GpzufYgoCKf/K02F7ebN8o34pW4ElciIsqH49l4MvY1s7WHBrTK6JdjzcRKs7tzG9SejeMdjTPYuSPNnfj9cqL2MKAKMzktNx37m+PNV5vS3GrOxcmIOBPHYk9pzO0Ad52LMpblWDOdm8252UgcJttUHG9uN6drDwMqEDmdMRsLzUvN/2luN9fibByOK3EiDsRj5afKF8qrZbn28IAqfiVuNwtjO5DvVubcboZ3tyDoruk4JXSYQCKnczbndu40t5pzMR8rcSaejj2lKQvl5bIU5nZgctxsLjTjvbdXVzLnbJQx/81AmwkdJo9rclpoTzkdT8Sntll+MhWzMdssRMRqfKtcjb+NC3EhokTsjc/18Hig267FMG/52bsuXJtzy3WL8D7Tcap5Pl4si7UHAmMhclppMSKiRMzH0ZhrPrbNf6aZmGn2R8R6vBVL5VJciJt9PR7omlqBs2Em7jTPlQu1/xIe4VyMb/kedM10nGpeiL8uT9ceCIyc5WqtdiGOxd6yq+wtXyzXy+o2Xz0Vc7HQnG9Ks9JcjtOx997jf6p8sby67eOBLrgWpamZOBERU3G+OVv7L+Ih5sd6hRJ001QcaUpzszlZeyAwUiKnE5ZiMQ7E7tKUhXK+h00GZuJIc6r5++ZOc7M5F/NxMxbj6dhdfuTu491cFLroZNxs6gfOpuPNrZaMZNOt5rzrcKBHc/FSc7s5V3sYMDIip2Mu3N1A+nBPG0i/O7dzq7kcJ2P33cfvKk/1NDcEtMW5uN281LLdwmbjTmsuZL4WxXU40KfpWGhKs9LKeVnYKRdrdNTVuBoRUSJO9nRz0NmYbY5ExFp8O14rN+JCXIlFNxeFDjgdP9+yuHnXVJxqnos9lbchqHuFEnTdTBxvjsdyXHLbUFIxk9N5mzcH7W0D6emYi+N353bcXBTa7XTcbEpzqrWJs2E2SrUlL/Nxq0UL+KDLZuN4U5rbzeVwrQ45mMlJY3MD6Y/Hz8Zn4vGe5nYW4qVYizfKN+KVuBJXIsztQCucjaOd+hlcaJ6Ni+XYWF/zXDzjChwYsuk40hyJl2I5bpRL0dY9FKEXIiedN+PNONPHBtLTsb/ZH8cj7n6kfS3ORNx9/L442Hw0HEbAeMzH0djXfKSTH8xTYwydNi/ggxw2ToSej+W4UV7fOC6Ajuni79JEnmpihGvZN+d25uIX44me53YednPRn+5pbggYxHz8ZE8/oe03FQvNQlwvF0d2SCRvYLzeXfWxKnfoGJFT1UyUZi1W41K5McJJ4aVYirhvbqb3m4u+fW9up5+5ISaFOb7Bzce++GDsa2YS/i3ub/bHi/H6UFPndDwRBy1O68lM7QH07QN9fv31yhtdTKbpmL6bOxGrsRY3yvfjRsSELGj7QO0BMJDGZ0V7rMbXy1fGcpZkLn4xDsVPNL3+MlyNr5e/i7+Mm3f/eW98Lp6IT/X8+J1Zjj3l3XuYLz90J6f5ON+CS4/Xolubcu/8AHt1260ueK/pDh6C7sTO1vVvnFYZ5pLZ5eo7wfXj1kCze+vxdu2B96n/d7mW8ORAl3Xtd1//ZmsPgIGInBZ6d5vn0evvGoD1eCuW3nPIMo5rCLoTOcDDrcW3Y6lEXIpHn/mdj4iIoxEx1/zwiA4q1uKxDv3Su23uCmBgIqfVxje3s7EcpPe5mY2R/c29uZ3D8em+5ob6IXIAAOiHyOmEjbmdVzY2eR6pD8XP9jU38+Cs04fjZ4Y+tyNyAADoh8jpmPFt5ngo/kUcik/0vFxiOb75wNzOM/HJPh6/1TOLHAAAeidyOmo1vnX3Fp6j9qH45b5uDvruzUU37PzmoiIHAIB+iJzOG99diQ/Fv+rr5qAbs04X43t3//lwPDPQzUVFDgAA/RA5aTw4gzJKJ/u6OehavFGuxt/eG1m/NxcVOQAA9EPkpLN5C89xbUDd+81B37256PfuPX5fD3M7IgcAgH6InMQ2buG5OIZXmotf7HMD6m+Vqz3fXFTkAADQD5EzAd5/C89R2R2H+pzbedjNRR98vMgBAKAfImeijHdup5+bg26M7L1zO5uPFzkAAPRD5Eykcc7t/EpfG0ivx1vvu7noT8ZiiBwAAHolcibcxi08x3Fz0fnY19fNQd97c1GRAwBAr0QOERGxFt+O18qJMbzS7viVPjeg/nYslafuLXwTOQAAbE3k8ICNW3i2cW5nc3wiBwCArYgcHmHj5qLjmNv5UPxyH3M7IgcAgK2JHLYx3puL7ouD22xALXIAANiayKFnG7fwHMcG1D8TPx1PPGJuR+QAALA1kUPfxrcB9cPmdkQOAABbEznswPhuLhpx+u7NQUUOAABbEzkMwcYG1DfGMrdzOK485N+KHAAANokchmp8Nxd9L5EDAMAmkcNIbGxA/cpDZ11GQeQAALBJ5DBi47m5qMgBAGCTyGFMNq7bGdXNRUUOAACbfqj2AJgU0zEXx5vS3GluNedivvZwAABIy0wO1azGt4Z23Y6ZHAAANokcqhvGzUVFDgAAm0QOLTL4zUVFDgAAm0QOLbQeb8eNvuZ2RA4AAJtsPEALTcVsLDTnm9KsNJfjZO3hAADQKWZy6ISNDagfvUmBmRwAADaJHDrm4TcXFTkAAGwSOXTUWrxRrsbf3p3bETkAAGwSOXTcxiYFTzUztQcCAEBLiBwAACAVu6sBAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKQicgAAgFREDgAAkIrIAQAAUhE5AABAKiIHAABIReQAAACpiBwAACAVkQMAAKTy/wGqMxH1v/k36AAAAABJRU5ErkJggg==" alt="iBuild" style="height:36px;width:auto;">
                    <div>
                        <div style="font-size:15px;font-weight:800;color:#2C2C2E;letter-spacing:0.5px;">iBuild INC.</div>
                        <div style="font-size:11px;color:#7A7A80;">🪟 방충망 주문서 계산기</div>
                    </div>
                </div>

                <!-- 중앙: 회사정보 (작게) -->
                <div style="display:flex;gap:16px;flex-wrap:wrap;align-items:center;">
                    <span style="font-size:11px;color:#7A7A80;">📍 614 Cooke Street #203, Honolulu, HI 96813</span>
                    <span style="font-size:11px;color:#7A7A80;">📞 1-808-600-5525</span>
                    <span style="font-size:11px;color:#7A7A80;">🌐 ibuildhawaii.com</span>
                </div>

                <!-- 우: 버튼 그룹 -->
                <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                    <div id="onlineStatusIndicator" style="padding:4px 10px;background:#F2F3F5;border-radius:8px;font-size:11px;font-weight:600;">
                        <span style="color:#6B7685;">🟢 온라인</span>
                    </div>
                    <button onclick="showSavedCalculations()" style="padding:7px 16px;background:#F2F3F5;color:#2C2C2E;border:1px solid #D8D9DC;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;">
                        📂 저장 내역
                    </button>
                    <button onclick="resetAllEntries()" style="padding:7px 16px;background:#dc3545;color:white;border:none;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;">
                        🔄 리셋
                    </button>
                    <button onclick="showEstimateModal()" style="padding:7px 16px;background:#5A6472;color:white;border:none;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;">
                        💰 견적서
                    </button>
                </div>

            </div>
        </header>



        <!-- ===== 새 통합 단일 페이지 ===== -->

        <!-- 공통 기본 정보 카드 -->
        <div class="card" style="margin: 20px auto; max-width: 1100px;">
            <div class="card-title">📋 고객 기본 정보</div>
            <div class="input-grid">
                <div class="input-group">
                    <label>날짜</label>
                    <input type="date" id="date-single">
                </div>
                <div class="input-group">
                    <label>고객명</label>
                    <input type="text" id="customer-single" placeholder="고객명 입력" oninput="syncCommonField('customer-single')">
                </div>
                <div class="input-group">
                    <label>주소</label>
                    <input type="text" id="address-single" placeholder="주소 입력" oninput="syncCommonField('address-single')">
                </div>
                <div class="input-group">
                    <label>이메일</label>
                    <input type="email" id="email-single" placeholder="이메일 입력" oninput="syncCommonField('email-single')">
                </div>
                <div class="input-group">
                    <label>전화번호</label>
                    <input type="tel" id="phone-single" placeholder="전화번호 입력" oninput="syncCommonField('phone-single')">
                </div>
            </div>
            <!-- 숨겨진 double 동기화 필드 -->
            <input type="hidden" id="date-double">
            <input type="hidden" id="customer-double">
            <input type="hidden" id="address-double">
            <input type="hidden" id="email-double">
            <input type="hidden" id="phone-double">
        </div>

        <!-- 설치장소 목록 컨테이너 -->
        <div style="max-width: 1100px; margin: 0 auto 20px auto; padding: 0 0 10px 0;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; padding: 0 4px;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <h2 style="margin:0; color: var(--primary); font-size:1.3em; font-family:'Nanum Myeongjo',serif;">🏠 설치장소</h2>
                    <span id="location-total-count" style="background:var(--primary); color:white; padding:4px 14px; border-radius:20px; font-size:0.82em; font-weight:700;">0개</span>
                </div>
                <button onclick="addLocationEntry()" style="display:flex; align-items:center; gap:8px; padding:11px 22px; background:var(--primary); color:white; border:none; border-radius:12px; cursor:pointer; font-size:0.95em; font-weight:700; box-shadow:0 3px 10px rgba(90,100,114,0.25); transition:all 0.2s; font-family:'Noto Sans KR',sans-serif;">
                    <span style="font-size:1.3em;">＋</span> 설치장소 추가
                </button>
            </div>

            <!-- 빈 상태 안내 -->
            <div id="location-empty-msg" style="text-align:center; padding:50px 20px; background:#F5F6F7; border:2px dashed #D0D7DC; border-radius:16px; color:#888;">
                <div style="font-size:3em; margin-bottom:12px;">🏠</div>
                <div style="font-size:1.05em; font-weight:600; margin-bottom:6px; color:#555;">설치장소를 추가하세요</div>
                <div style="font-size:0.9em;">위의 <strong>＋ 설치장소 추가</strong> 버튼을 눌러 각 장소별 도어 타입과 크기를 입력하세요</div>
            </div>

            <!-- 설치장소 카드들이 여기에 동적으로 추가됨 -->
            <div id="location-entries-container"></div>
        </div>

        <!-- 숨겨진 기존 탭/섹션 (계산 엔진 유지용) -->
        <div style="display:none;" aria-hidden="true">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('single', this)"><span class="emoji">📏</span> Single</div>
                <div class="tab" onclick="switchTab('double', this)"><span class="emoji">📐</span> Double</div>
            </div>
            <div id="single" class="content active">
                <div class="card">
                    <div class="card-title">📐 크기 입력</div>
                    <div class="unit-toggle">
                        <button class="unit-btn" onclick="setUnit('single', 'mm', event)">밀리미터 (mm)</button>
                        <button class="unit-btn active" onclick="setUnit('single', 'inch', event)">인치 (inch)</button>
                    </div>
                    <div class="input-grid">
                        <div class="input-group"><label>가로 (W)</label><input type="number" id="width-single" oninput="calculate('single')"></div>
                        <div class="input-group"><label>세로 (H)</label><input type="number" id="height-single" oninput="calculate('single')"></div>
                    </div>
                    <div class="input-grid" style="margin-top:25px;">
                        <div class="input-group">
                            <label>프레임 색상</label>
                            <select id="frame-color-single" onchange="syncFrameColorToEstimate('single')">
                                <option value="">선택하세요</option>
                                <option value="Black">Black</option>
                                <option value="White">White</option>
                                <option value="Silver">Silver</option>
                                <option value="Custom">Custom Color</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>망 색상</label>
                            <select id="mesh-color-single">
                                <option value="">선택하세요</option>
                                <option value="블랙">Black</option>
                                <option value="그레이">Gray</option>
                                <option value="화이트">White</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="card"><div class="card-title">🛠️ 방충망 부속 가이드 <span class="structure-icon" onmouseenter="showStructureDiagram('single')" onmouseleave="hideStructureDiagram()" title="구조도 보기"><svg viewBox="0 0 24 24" width="20" height="20" fill="white"><rect x="2" y="2" width="20" height="20" fill="none" stroke="white" stroke-width="2" rx="2"/><line x1="2" y1="8" x2="22" y2="8" stroke="white" stroke-width="1.5"/><line x1="2" y1="14" x2="22" y2="14" stroke="white" stroke-width="1.5"/><line x1="8" y1="2" x2="8" y2="22" stroke="white" stroke-width="1.5"/><line x1="14" y1="2" x2="14" y2="22" stroke="white" stroke-width="1.5"/><circle cx="12" cy="12" r="2" fill="white"/></svg></span><span class="structure-icon" onmouseenter="showPartsList('single')" onmouseleave="hidePartsList()" title="부속 리스트 보기" style="margin-left:8px;"><svg viewBox="0 0 24 24" width="20" height="20" fill="white"><rect x="3" y="4" width="18" height="3" rx="1.5" fill="white"/><rect x="3" y="10.5" width="18" height="3" rx="1.5" fill="white"/><rect x="3" y="17" width="18" height="3" rx="1.5" fill="white"/></svg></span></div></div>
                <div class="card">
                    <div class="card-title">✅ 계산 결과</div>
                    <div class="info-section">
                        <div class="info-card"><div class="info-number" id="width-display-single">-</div><div class="info-label">가로</div></div>
                        <div class="info-card"><div class="info-number" id="height-display-single">-</div><div class="info-label">세로</div></div>
                        <div class="info-card"><div class="info-number" id="area-display-single">-</div><div class="info-label">면적 (SF)</div></div>
                        <div class="info-card"><div class="info-number" id="area-sm-display-single">-</div><div class="info-label">면적 (SM)</div></div>
                    </div>
                    <div class="results-grid">
                        <div class="result-item"><div class="result-label">Top Rail Bar <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="frame-top-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Bottom Rail Bar <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="frame-bottom-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Sidewall Vertical Rail Bar <span style="color:#D4851C;font-size:0.8em;">× 2개</span></div><div class="result-value-dual" id="wall-bar-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Large Fix Rail <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="hinge-bar-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Small Fix Rail <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="small-fix-rail-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Handle Bar (Male) <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="handle-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Mesh (20메쉬) <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="mesh-20-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">망 접힘 갯수 <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="mesh-fold-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Privacy Screen <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="privacy-screen-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">PVC 18mm <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="pvc-18-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">String (Inside)</div><div class="result-value-dual" id="string-single"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">String 개수</div><div class="result-value-dual" id="string-count-single"><span class="result-primary">-</span></div></div>
                    </div>
                </div>
                <div class="card"><div class="card-title">🔘 망구멍 정보</div><div id="hole-info-single"></div><div id="single-diagram-container" style="margin-top:20px;"></div></div>
            </div>
            <div id="double" class="content">
                <div class="card">
                    <div class="card-title">📐 크기 입력 (Double)</div>
                    <div class="unit-toggle">
                        <button class="unit-btn" onclick="setUnit('double', 'mm', event)">밀리미터 (mm)</button>
                        <button class="unit-btn active" onclick="setUnit('double', 'inch', event)">인치 (inch)</button>
                    </div>
                    <div class="input-grid">
                        <div class="input-group"><label>가로 (W)</label><input type="number" id="width-double" oninput="calculate('double')"></div>
                        <div class="input-group"><label>세로 (H)</label><input type="number" id="height-double" oninput="calculate('double')"></div>
                    </div>
                    <div class="input-grid" style="margin-top:25px;">
                        <div class="input-group">
                            <label>프레임 색상</label>
                            <select id="frame-color-double" onchange="syncFrameColorToEstimate('double')">
                                <option value="">선택하세요</option>
                                <option value="Black">Black</option>
                                <option value="White">White</option>
                                <option value="Silver">Silver</option>
                                <option value="Custom">Custom Color</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>망 색상</label>
                            <select id="mesh-color-double">
                                <option value="">선택하세요</option>
                                <option value="블랙">Black</option>
                                <option value="그레이">Gray</option>
                                <option value="화이트">White</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="card"><div class="card-title">🛠️ 방충망 부속 가이드 (Double) <span class="structure-icon" onmouseenter="showStructureDiagram('double')" onmouseleave="hideStructureDiagram()" title="구조도 보기"><svg viewBox="0 0 24 24" width="20" height="20" fill="white"><rect x="2" y="2" width="20" height="20" fill="none" stroke="white" stroke-width="2" rx="2"/><line x1="2" y1="8" x2="22" y2="8" stroke="white" stroke-width="1.5"/><line x1="2" y1="14" x2="22" y2="14" stroke="white" stroke-width="1.5"/><line x1="8" y1="2" x2="8" y2="22" stroke="white" stroke-width="1.5"/><line x1="14" y1="2" x2="14" y2="22" stroke="white" stroke-width="1.5"/><circle cx="12" cy="12" r="2" fill="white"/></svg></span><span class="structure-icon" onmouseenter="showPartsList('double')" onmouseleave="hidePartsList()" title="부속 리스트 보기" style="margin-left:8px;"><svg viewBox="0 0 24 24" width="20" height="20" fill="white"><rect x="3" y="4" width="18" height="3" rx="1.5" fill="white"/><rect x="3" y="10.5" width="18" height="3" rx="1.5" fill="white"/><rect x="3" y="17" width="18" height="3" rx="1.5" fill="white"/></svg></span></div></div>
                <div class="card">
                    <div class="card-title">✅ 계산 결과 (Double)</div>
                    <div class="info-section">
                        <div class="info-card"><div class="info-number" id="width-display-double">-</div><div class="info-label">가로</div></div>
                        <div class="info-card"><div class="info-number" id="height-display-double">-</div><div class="info-label">세로</div></div>
                        <div class="info-card"><div class="info-number" id="area-display-double">-</div><div class="info-label">면적 (SF)</div></div>
                        <div class="info-card"><div class="info-number" id="area-sm-display-double">-</div><div class="info-label">면적 (SM)</div></div>
                    </div>
                    <div class="results-grid">
                        <div class="result-item"><div class="result-label">Top Rail Bar <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="frame-top-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Bottom Rail Bar <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="frame-bottom-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Sidewall Vertical Rail Bar <span style="color:#D4851C;font-size:0.8em;">× 2개</span></div><div class="result-value-dual" id="wall-bar-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Large Fix Rail <span style="color:#D4851C;font-size:0.8em;">× 2개</span></div><div class="result-value-dual" id="hinge-bar-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Handle Bar (Male) <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="handle-male-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Handle Bar (Female) <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="handle-female-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Mesh (20메쉬) <span style="color:#D4851C;font-size:0.8em;">× 2개</span></div><div class="result-value-dual" id="mesh-20-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">망 접힘 갯수 <span style="color:#D4851C;font-size:0.8em;">× 2개</span></div><div class="result-value-dual" id="mesh-fold-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">Privacy Screen <span style="color:#D4851C;font-size:0.8em;">× 1개</span></div><div class="result-value-dual" id="privacy-screen-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">PVC 18mm <span style="color:#D4851C;font-size:0.8em;">× 2개</span></div><div class="result-value-dual" id="pvc-18-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">String (Inside) 길이</div><div class="result-value-dual" id="string-inner-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">String (Outside) 길이</div><div class="result-value-dual" id="string-outer-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">String (Inside) 개수</div><div class="result-value-dual" id="string-count-inner-double"><span class="result-primary">-</span></div></div>
                        <div class="result-item"><div class="result-label">String (Outside) 개수</div><div class="result-value-dual" id="string-count-outer-double"><span class="result-primary">-</span></div></div>
                    </div>
                </div>
                <div class="card"><div class="card-title">🔘 망구멍 정보 (Double)</div><div id="hole-info-double"></div><div id="double-diagram-container" style="margin-top:20px;"></div></div>
            </div>
        </div>

    </div> <!-- /.container -->

    <!-- ===== 계산 결과 팝업 모달 ===== -->
    <div id="calcResultModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.75);z-index:11000;overflow-y:auto;">
      <div style="background:white;margin:10px auto;max-width:1050px;border-radius:16px;padding:20px;position:relative;box-shadow:0 20px 60px rgba(0,0,0,0.4);" id="crm-print-area">

        <!-- 닫기 + 인쇄 버튼 (화면용, 인쇄 시 숨김) -->
        <div id="crm-screen-btns" style="display:flex;justify-content:flex-end;gap:10px;margin-bottom:16px;">
          <button onclick="crmPrint()"
                  style="padding:9px 22px;background:linear-gradient(135deg,#5A6472,#4A5260);color:white;border:none;border-radius:10px;font-size:0.9em;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:7px;box-shadow:0 3px 8px rgba(90,100,114,0.3);">
            🖨️ 인쇄
          </button>
          <button onclick="document.getElementById('calcResultModal').style.display='none'"
                  style="padding:9px 22px;background:#EAEBED;color:#4A4A50;border:1px solid #D8D9DC;border-radius:10px;font-size:0.9em;font-weight:700;cursor:pointer;">
            ✕ 닫기
          </button>
        </div>

        <!-- ① 주문 정보 헤더 (축소형) -->
        <div style="background:linear-gradient(135deg,#5A6472,#4A5260);border-radius:10px;padding:10px 14px;margin-bottom:12px;color:white;">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">
            <div style="font-size:1.0em;font-weight:800;" id="crm-title">📊 계산 결과</div>
            <span id="crm-badge" style="padding:2px 10px;border-radius:12px;font-size:0.75em;font-weight:700;"></span>
            <div style="font-size:0.75em;color:rgba(255,255,255,0.7);margin-left:auto;" id="crm-subtitle"></div>
          </div>
          <!-- 주문 정보: 한 줄 테이블 형태 -->
          <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:6px;" id="crm-order-info">
            <div style="background:rgba(255,200,50,0.25);border:1px solid rgba(255,200,50,0.4);border-radius:6px;padding:5px 8px;">
              <div style="font-size:0.65em;color:rgba(255,255,200,0.85);margin-bottom:1px;letter-spacing:0.5px;">🔑 P.O. NUMBER</div>
              <div style="font-weight:900;font-size:0.78em;color:white;font-family:monospace;letter-spacing:0.5px;" id="crm-oi-po">-</div>
            </div>
            <div style="background:rgba(255,255,255,0.12);border-radius:6px;padding:5px 8px;">
              <div style="font-size:0.65em;color:rgba(255,255,255,0.6);margin-bottom:1px;">👤 고객명</div>
              <div style="font-weight:700;font-size:0.8em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" id="crm-oi-customer">-</div>
            </div>
            <div style="background:rgba(255,255,255,0.12);border-radius:6px;padding:5px 8px;">
              <div style="font-size:0.65em;color:rgba(255,255,255,0.6);margin-bottom:1px;">📅 날짜</div>
              <div style="font-weight:700;font-size:0.8em;" id="crm-oi-date">-</div>
            </div>
            <div style="background:rgba(255,255,255,0.12);border-radius:6px;padding:5px 8px;">
              <div style="font-size:0.65em;color:rgba(255,255,255,0.6);margin-bottom:1px;">📍 주소</div>
              <div style="font-weight:700;font-size:0.78em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" id="crm-oi-address">-</div>
            </div>
            <div style="background:rgba(255,255,255,0.12);border-radius:6px;padding:5px 8px;">
              <div style="font-size:0.65em;color:rgba(255,255,255,0.6);margin-bottom:1px;">📞 전화</div>
              <div style="font-weight:700;font-size:0.8em;" id="crm-oi-phone">-</div>
            </div>
            <div style="background:rgba(255,255,255,0.12);border-radius:6px;padding:5px 8px;">
              <div style="font-size:0.65em;color:rgba(255,255,255,0.6);margin-bottom:1px;">🏠 장소</div>
              <div style="font-weight:700;font-size:0.8em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" id="crm-oi-location">-</div>
            </div>
            <div style="background:rgba(255,255,255,0.12);border-radius:6px;padding:5px 8px;">
              <div style="font-size:0.65em;color:rgba(255,255,255,0.6);margin-bottom:1px;">🎨 색상</div>
              <div style="font-weight:700;font-size:0.8em;" id="crm-oi-color">-</div>
            </div>
          </div>
        </div>

        <!-- ② 치수 요약 -->
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:10px;">
          <div style="background:#F2F4F5;border-radius:8px;padding:7px 10px;text-align:center;border:1px solid #D0D7DC;">
            <div style="font-size:0.68em;color:#888;margin-bottom:1px;">가로 (W)</div>
            <div style="font-weight:800;color:var(--primary);font-size:0.95em;" id="crm-w">-</div>
          </div>
          <div style="background:#F2F4F5;border-radius:8px;padding:7px 10px;text-align:center;border:1px solid #D0D7DC;">
            <div style="font-size:0.68em;color:#888;margin-bottom:1px;">세로 (H)</div>
            <div style="font-weight:800;color:var(--primary);font-size:0.95em;" id="crm-h">-</div>
          </div>
          <div style="background:#F2F4F5;border-radius:8px;padding:7px 10px;text-align:center;border:1px solid #D0D7DC;">
            <div style="font-size:0.68em;color:#888;margin-bottom:1px;">면적 (SF)</div>
            <div style="font-weight:800;color:var(--primary);font-size:1.0em;" id="crm-sf">-</div>
          </div>
          <div style="background:#F2F4F5;border-radius:8px;padding:7px 10px;text-align:center;border:1px solid #D0D7DC;">
            <div style="font-size:0.68em;color:#888;margin-bottom:1px;">면적 (SM)</div>
            <div style="font-weight:800;color:var(--primary);font-size:0.95em;" id="crm-sm">-</div>
          </div>
        </div>

        <!-- ③ 계산결과 (왼쪽) + 부속가이드 (오른쪽) 2단 -->
        <div style="display:grid;grid-template-columns:280px 1fr;gap:10px;margin-bottom:8px;align-items:start;">
          <!-- 왼쪽: 계산 결과 한 줄 -->
          <div style="background:#F8F9FA;border:1px solid #D0D7DC;border-radius:12px;padding:12px;">
            <div style="font-weight:700;color:var(--primary);font-size:0.9em;margin-bottom:8px;padding-bottom:5px;border-bottom:2px solid #D0D7DC;">✅ 계산 결과</div>
            <div class="results-grid" id="crm-grid" style="grid-template-columns:1fr;gap:5px;margin-bottom:0;"></div>
          </div>
          <!-- 오른쪽: 부속 가이드 -->
          <div style="background:#F8F9FA;border:1px solid #D0D7DC;border-radius:12px;padding:12px;">
            <div style="font-weight:700;color:var(--primary);font-size:0.9em;margin-bottom:8px;padding-bottom:5px;border-bottom:2px solid #D0D7DC;">🛠️ 방충망 부속 가이드</div>
            <div id="crm-parts"></div>
          </div>
        </div>

        <!-- ④ 망구멍 정보 + 도면 (한 섹션) -->
        <div style="background:#F8F9FA;border:1px solid #D0D7DC;border-radius:12px;padding:12px;margin-bottom:8px;">
          <div style="font-weight:700;color:var(--primary);font-size:0.9em;margin-bottom:8px;padding-bottom:5px;border-bottom:2px solid #D0D7DC;">🔘 망구멍 정보 &amp; 📐 도면</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:8px;">
            <div style="background:white;border-radius:8px;padding:8px;text-align:center;border:1px solid #D0D7DC;">
              <div style="font-size:0.7em;color:#888;margin-bottom:2px;">구멍 갯수</div>
              <div style="font-size:1.4em;font-weight:900;color:var(--primary);" id="crm-hcnt">-</div>
            </div>
            <div style="background:white;border-radius:8px;padding:8px;text-align:center;border:1px solid #D0D7DC;">
              <div style="font-size:0.7em;color:#888;margin-bottom:2px;">구멍 간격</div>
              <div style="font-size:1.0em;font-weight:800;color:var(--primary);" id="crm-hspacing">-</div>
            </div>
          </div>
          <div id="crm-hpos" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(72px,1fr));gap:4px;margin-bottom:8px;"></div>
          <div style="background:white;border-radius:8px;padding:10px;border:1px solid #D0D7DC;overflow-x:auto;">
            <svg id="crm-svg" viewBox="0 0 1200 400" style="width:100%;height:auto;display:block;min-width:500px;"></svg>
          </div>
        </div>

      </div>
    </div>

    <!-- ===== 부속 리스트 팝업 모달 ===== -->
    <div id="partsModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:12000;overflow-y:auto;"
         onmouseenter="keepPartsModalOpen()" onmouseleave="hidePartsList()">
      <div style="background:white;margin:40px auto;max-width:900px;border-radius:18px;padding:28px;position:relative;box-shadow:0 20px 60px rgba(0,0,0,0.4);">
        <button onclick="closePartsModalDirect()"
                style="position:absolute;top:14px;right:18px;background:none;border:none;font-size:32px;cursor:pointer;color:#aaa;line-height:1;"
                onmouseover="this.style.color='#333'" onmouseout="this.style.color='#aaa'">×</button>
        <div style="border-bottom:3px solid var(--primary);padding-bottom:14px;margin-bottom:22px;">
          <h2 style="margin:0;color:var(--primary);font-family:'Nanum Myeongjo',serif;font-size:1.5em;" id="partsModalTitle">🛠️ 방충망 부속 가이드</h2>
        </div>
        <div id="partsModalBody"></div>
      </div>
    </div>

    <!-- ===== 저장 내역 모달 -->

    <div id="savedCalculationsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; overflow-y: auto;">

        <div style="background: white; margin: 50px auto; max-width: 1000px; border-radius: 15px; padding: 30px; position: relative;">

            <button onclick="closeSavedCalculationsModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 28px; cursor: pointer; color: #666;">×</button>

            <h2 style="margin: 0 0 20px 0; color: var(--primary);">📂 저장된 계산 내역</h2>

            

            <!-- 검색 및 정렬 -->

            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">

                <input type="text" id="searchInput" placeholder="🔍 고객명, 주소, 이메일, 전화번호로 검색..." 

                       oninput="filterCalculations()" 

                       style="flex: 1; min-width: 250px; padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">

                <select id="sortSelect" onchange="filterCalculations()" 

                        style="padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; cursor: pointer;">

                    <option value="date-desc">📅 최신순</option>

                    <option value="date-asc">📅 오래된순</option>

                    <option value="customer-asc">👤 고객명 (가나다순)</option>

                    <option value="customer-desc">👤 고객명 (역순)</option>

                    <option value="width-desc">📏 가로 (큰순)</option>

                    <option value="width-asc">📏 가로 (작은순)</option>

                </select>

                <select id="typeFilter" onchange="filterCalculations()" 

                        style="padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; cursor: pointer;">

                    <option value="all">🔍 전체</option>

                    <option value="single">📏 Single</option>

                    <option value="double">📐 Double</option>

                </select>

            </div>

            

            <div id="savedCalculationsList" style="max-height: 500px; overflow-y: auto;">

                <!-- 저장된 계산 내역이 여기에 표시됩니다 -->

            </div>

            <div style="margin-top: 20px; text-align: right;">

                <button onclick="closeSavedCalculationsModal()" style="padding: 8px 18px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight:600;">

                    닫기

                </button>

            </div>

        </div>

    </div>



    <!-- 부품 리스트 팝업 모달 -->



    <!-- 견적서 모달 -->
    <div id="estimateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; overflow-y: auto;">
        <div style="background: white; margin: 30px auto; max-width: 920px; border-radius: 20px; padding: 35px 35px 0 35px; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            
            <!-- 닫기 버튼 -->
            <button onclick="closeEstimateModal()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 30px; cursor: pointer; color: #999; line-height: 1;">×</button>
            
            <!-- 헤더 -->
            <div style="border-bottom: 3px solid var(--primary); padding-bottom: 20px; margin-bottom: 25px;">
                <div style="display:flex; justify-content:space-between; align-items:flex-start; flex-wrap:wrap; gap:10px;">
                    <div>
                        <h2 style="margin: 0 0 6px 0; color: var(--primary); font-family: 'Nanum Myeongjo', serif; font-size: 1.8em;">💰 견적서 (Estimate)</h2>
                        <p style="margin: 0; color: var(--text-light); font-size: 0.9em;">면적(SF)을 기준으로 자동 계산됩니다.</p>
                    </div>
                    <div style="background:#F2F4F5; border:2px solid #D0D7DC; border-radius:10px; padding:10px 18px; text-align:center;">
                        <div style="font-size:0.72em; color:#888; margin-bottom:3px; font-weight:600; letter-spacing:1px;">P.O. NUMBER</div>
                        <div style="font-size:1.1em; font-weight:900; color:var(--primary); font-family:monospace; letter-spacing:1px;" id="est-po-number">-</div>
                    </div>
                </div>
            </div>

            <!-- 관리자 설정 섹션 (접기/펼치기) -->
            <div style="background: #f8f8f8; border-radius: 12px; padding: 20px; margin-bottom: 25px; border: 1px solid #e0e0e0;">
                <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="togglePriceSettings()">
                    <h3 style="margin: 0; color: var(--primary); font-size: 1.1em;">⚙️ 기본 가격 설정 (관리자)</h3>
                    <span id="priceSettingsToggleIcon" style="font-size: 1.2em; transition: transform 0.3s;">▼</span>
                </div>
                <div id="priceSettingsPanel" style="display: none; margin-top: 18px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9em; color: #555;">Single 기본가 ($/SF)</label>
                            <input type="number" id="basePriceSingle" placeholder="예: 45" min="0" step="0.01" oninput="recalcEstimate()"
                                   style="width: 100%; padding: 10px 14px; border: 2px solid var(--border); border-radius: 8px; font-size: 1em;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9em; color: #555;">Double 기본가 ($/SF)</label>
                            <input type="number" id="basePriceDouble" placeholder="예: 50" min="0" step="0.01" oninput="recalcEstimate()"
                                   style="width: 100%; padding: 10px 14px; border: 2px solid var(--border); border-radius: 8px; font-size: 1em;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9em; color: #555;">Custom Color 추가금 ($/SF)</label>
                            <input type="number" id="customColorPrice" placeholder="예: 5" min="0" step="0.01" oninput="recalcEstimate()"
                                   style="width: 100%; padding: 10px 14px; border: 2px solid var(--border); border-radius: 8px; font-size: 1em;">
                        </div>
                    </div>
                    <button onclick="savePriceSettings()" style="padding: 10px 24px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9em;">
                        💾 가격 저장
                    </button>
                    <span id="priceSaveMsg" style="margin-left: 12px; color: green; font-size: 0.9em; display: none;">✅ 저장되었습니다!</span>
                </div>
            </div>

            <!-- 현재 도어 정보 -->
            <div style="background: linear-gradient(135deg, #F2F4F5 0%, #EAEDEF 100%); border-radius: 12px; padding: 16px; margin-bottom: 20px; border: 1px solid #D0D7DC;">
                <h3 style="margin: 0 0 12px 0; color: var(--primary); font-size: 1.0em;">📋 Order Summary</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px;">
                    <div style="background: white; padding: 10px; border-radius: 8px; border:1px solid #D0D7DC;">
                        <div style="font-size: 0.75em; color: #888; margin-bottom: 3px;">고객명</div>
                        <div style="font-weight: 700; color: var(--primary); font-size: 0.9em;" id="est-customer">-</div>
                    </div>
                    <div style="background: white; padding: 10px; border-radius: 8px; border:1px solid #D0D7DC;">
                        <div style="font-size: 0.75em; color: #888; margin-bottom: 3px;">전화번호</div>
                        <div style="font-weight: 700; color: var(--primary); font-size: 0.9em;" id="est-phone">-</div>
                    </div>
                    <div style="background: white; padding: 10px; border-radius: 8px; border:1px solid #1976D2;">
                        <div style="font-size: 0.75em; color: #1976D2; margin-bottom: 3px; font-weight:600;">✉️ 이메일</div>
                        <div style="font-weight: 700; color: #1565C0; font-size: 0.85em; word-break:break-all;" id="est-email">-</div>
                    </div>
                    <div style="background: white; padding: 10px; border-radius: 8px; border:1px solid #D0D7DC;">
                        <div style="font-size: 0.75em; color: #888; margin-bottom: 3px;">도어 타입</div>
                        <div style="font-weight: 700; color: var(--primary); font-size: 0.9em;" id="est-door-type">-</div>
                    </div>
                    <div style="background: white; padding: 10px; border-radius: 8px; border:1px solid #D0D7DC;">
                        <div style="font-size: 0.75em; color: #888; margin-bottom: 3px;">총 면적 (SF)</div>
                        <div style="font-weight: 700; color: var(--primary); font-size: 1.1em;" id="est-area">-</div>
                    </div>
                    <div style="background: white; padding: 10px; border-radius: 8px; border:1px solid #D0D7DC;">
                        <div style="font-size: 0.75em; color: #888; margin-bottom: 3px;">장소 수</div>
                        <div style="font-weight: 700; color: var(--primary); font-size: 0.9em;" id="est-size">-</div>
                    </div>
                </div>
                <!-- 설치장소 표시 -->
                <div id="est-locations-wrap" style="margin-top: 10px; background: white; padding: 10px 12px; border-radius: 8px; display: none; border:1px solid #D0D7DC;">
                    <div style="font-size: 0.78em; color: #888; margin-bottom: 6px; font-weight: 600;">🏠 설치장소</div>
                    <div id="est-locations-list" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
                </div>
            </div>

            <!-- 설치장소별 제품 리스트 -->
            <div id="est-product-list-wrap" style="margin-bottom:25px; display:none;">
                <h3 style="margin:0 0 14px 0; color:var(--primary); font-size:1.05em;">🪟 설치장소별 제품 리스트</h3>
                <div id="est-product-list-table"></div>
            </div>

            <!-- 색상 선택 -->
            <div style="background: white; border: 2px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h3 style="margin: 0 0 15px 0; color: var(--primary); font-size: 1.05em;">🎨 프레임 색상</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;" id="colorOptionGroup">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px 16px; border: 2px solid #e0e0e0; border-radius: 10px; transition: all 0.2s; font-weight: 600; font-size: 0.95em;">
                        <input type="radio" name="estimateColor" value="Black" onchange="recalcEstimate()" style="width: auto; margin: 0;">
                        <span style="display: inline-block; width: 14px; height: 14px; background: #1a1a1a; border-radius: 50%; border: 1px solid #555; flex-shrink:0;"></span> Black
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px 16px; border: 2px solid #e0e0e0; border-radius: 10px; transition: all 0.2s; font-weight: 600; font-size: 0.95em;">
                        <input type="radio" name="estimateColor" value="White" onchange="recalcEstimate()" style="width: auto; margin: 0;">
                        <span style="display: inline-block; width: 14px; height: 14px; background: #f0f0f0; border-radius: 50%; border: 1px solid #ccc; flex-shrink:0;"></span> White
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px 16px; border: 2px solid #e0e0e0; border-radius: 10px; transition: all 0.2s; font-weight: 600; font-size: 0.95em;">
                        <input type="radio" name="estimateColor" value="Silver" onchange="recalcEstimate()" style="width: auto; margin: 0;">
                        <span style="display: inline-block; width: 14px; height: 14px; background: #c0c0c0; border-radius: 50%; border: 1px solid #999; flex-shrink:0;"></span> Silver
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px 16px; border: 2px solid #e0e0e0; border-radius: 10px; transition: all 0.2s; font-weight: 600; font-size: 0.95em;">
                        <input type="radio" name="estimateColor" value="Custom" onchange="recalcEstimate()" style="width: auto; margin: 0;">
                        <span style="display: inline-block; width: 14px; height: 14px; background: linear-gradient(135deg,#ff6b6b,#4ecdc4,#ffd93d); border-radius: 50%; flex-shrink:0;"></span> 
                        Custom Color <span style="color: var(--accent); font-size: 0.82em; margin-left:2px;">(+추가금)</span>
                    </label>
                </div>
            </div>

            <!-- Special Price + Discount + GE Tax 한 줄 -->
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 20px;">

                <!-- Special Price -->
                <div style="background: #fff8e1; border: 2px solid #ffcc02; border-radius: 12px; padding: 16px;">
                    <h3 style="margin: 0 0 12px 0; color: #b8860b; font-size: 1em; display:flex; align-items:center; gap:6px;">
                        ⭐ Special Price
                    </h3>
                    <select id="specialPriceType" onchange="onSpecialTypeChange()" style="width:100%; padding:9px 12px; border:2px solid #ffcc02; border-radius:8px; font-size:0.9em; font-weight:600; background:white; margin-bottom:10px; cursor:pointer;">
                        <option value="none">없음 (일반)</option>
                        <option value="contractor">🔨 CONTRACTOR</option>
                        <option value="military">🎖️ MILITARY</option>
                    </select>
                    <!-- 할인율 입력 -->
                    <div id="specialDiscountRow" style="display:none;">
                        <label style="display:block; font-size:0.82em; color:#888; margin-bottom:5px; font-weight:600;">할인율 (%)</label>
                        <div style="display:flex; gap:6px; flex-wrap:wrap;">
                            <button onclick="setDiscountPreset(5)" class="discount-preset-btn" style="flex:1; min-width:40px; padding:6px 4px; background:#fff3cd; border:1.5px solid #ffcc02; border-radius:6px; cursor:pointer; font-size:0.85em; font-weight:700;">5%</button>
                            <button onclick="setDiscountPreset(10)" class="discount-preset-btn" style="flex:1; min-width:40px; padding:6px 4px; background:#fff3cd; border:1.5px solid #ffcc02; border-radius:6px; cursor:pointer; font-size:0.85em; font-weight:700;">10%</button>
                            <button onclick="setDiscountPreset(15)" class="discount-preset-btn" style="flex:1; min-width:40px; padding:6px 4px; background:#fff3cd; border:1.5px solid #ffcc02; border-radius:6px; cursor:pointer; font-size:0.85em; font-weight:700;">15%</button>
                            <button onclick="setDiscountPreset(20)" class="discount-preset-btn" style="flex:1; min-width:40px; padding:6px 4px; background:#fff3cd; border:1.5px solid #ffcc02; border-radius:6px; cursor:pointer; font-size:0.85em; font-weight:700;">20%</button>
                        </div>
                        <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
                            <input type="number" id="discountValue" placeholder="직접 입력" min="0" max="100" step="0.1" oninput="recalcEstimate()"
                                   style="flex:1; padding:8px 10px; border:2px solid #ffcc02; border-radius:7px; font-size:0.9em; font-weight:600;">
                            <span style="font-size:1.1em; font-weight:700; color:#b8860b;">%</span>
                        </div>
                    </div>
                </div>

                <!-- GE Tax -->
                <div style="background: #f3f8ff; border: 2px solid #90caf9; border-radius: 12px; padding: 16px;">
                    <h3 style="margin: 0 0 12px 0; color: #1565c0; font-size: 1em; display:flex; align-items:center; gap:6px;">
                        🏛️ GE Tax (HI)
                    </h3>
                    <label style="display:flex; align-items:center; gap:10px; cursor:pointer; padding:10px 14px; border:2px solid #90caf9; border-radius:9px; background:white; transition:all 0.2s;" id="geTaxLabel">
                        <input type="checkbox" id="geTaxApply" onchange="recalcEstimate()" style="width:18px; height:18px; cursor:pointer; accent-color:#1565c0;">
                        <span>
                            <span style="font-weight:700; color:#1565c0; display:block; font-size:0.95em;">4.712% 적용</span>
                            <span style="font-size:0.8em; color:#888;">Hawaii GE Tax</span>
                        </span>
                    </label>
                    <div style="margin-top:10px; font-size:0.82em; color:#888; line-height:1.5;">
                        Tax 금액: <strong id="est-tax-amount" style="color:#1565c0;">$0.00</strong>
                    </div>
                </div>

                <!-- 할인 요약 -->
                <div style="background: #fdf2f8; border: 2px solid #ce93d8; border-radius: 12px; padding: 16px;">
                    <h3 style="margin: 0 0 12px 0; color: #7b1fa2; font-size: 1em;">💸 할인 요약</h3>
                    <div style="font-size:0.85em; color:#888; margin-bottom:6px;">할인 유형</div>
                    <div style="font-weight:700; color:#7b1fa2; font-size:0.95em; margin-bottom:10px;" id="est-discount-type-label">없음</div>
                    <div style="font-size:0.85em; color:#888; margin-bottom:4px;">할인 금액</div>
                    <div style="font-weight:700; color: var(--accent); font-size:1.3em;" id="est-discount-amount">-$0.00</div>
                </div>
            </div>

            <!-- 견적 금액 결과 박스 -->
            <div style="background:linear-gradient(135deg,#4A5260,#5A6472); border-radius: 15px; padding: 25px; color: white; margin-bottom: 20px;">
                <h3 style="margin: 0 0 18px 0; font-family: 'Nanum Myeongjo', serif; font-size: 1.3em;">💵 견적 금액 상세</h3>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 18px;">
                    <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 12px; text-align:center;">
                        <div style="font-size: 0.78em; color: rgba(255,255,255,0.7); margin-bottom: 4px;">기본 가격</div>
                        <div style="font-size: 1.15em; font-weight: 700;" id="est-base-price">$0.00</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 12px; text-align:center;">
                        <div style="font-size: 0.78em; color: rgba(255,255,255,0.7); margin-bottom: 4px;">Custom 추가금</div>
                        <div style="font-size: 1.15em; font-weight: 700;" id="est-color-extra">$0.00</div>
                    </div>
                    <div style="background: rgba(255,193,7,0.2); border-radius: 10px; padding: 12px; text-align:center; border:1px solid rgba(255,193,7,0.4);">
                        <div style="font-size: 0.78em; color: rgba(255,255,255,0.7); margin-bottom: 4px;">할인 후 소계</div>
                        <div style="font-size: 1.15em; font-weight: 700;" id="est-after-discount">$0.00</div>
                    </div>
                    <div style="background: rgba(144,202,249,0.2); border-radius: 10px; padding: 12px; text-align:center; border:1px solid rgba(144,202,249,0.3);">
                        <div style="font-size: 0.78em; color: rgba(255,255,255,0.7); margin-bottom: 4px;">GE Tax</div>
                        <div style="font-size: 1.15em; font-weight: 700;" id="est-tax-box">$0.00</div>
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.15); border-radius: 12px; padding: 20px; text-align: center; border: 2px solid rgba(212,165,116,0.6);">
                    <div style="font-size: 0.9em; color: rgba(255,255,255,0.8); margin-bottom: 6px;" id="est-total-label">총 견적 금액 (세전)</div>
                    <div style="font-size: 2.8em; font-weight: 900; font-family: 'Nanum Myeongjo', serif; color: #D4A574;" id="est-total">$0.00</div>
                    <div style="font-size: 0.82em; color: rgba(255,255,255,0.6); margin-top: 6px;" id="est-unit-info">-</div>
                </div>
            </div>

            <!-- 메모 -->
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555; font-size:0.95em;">📝 메모 (선택사항)</label>
                <textarea id="estimateMemo" placeholder="추가 요청사항이나 메모를 입력하세요..."
                          style="width: 100%; padding: 12px 15px; border: 2px solid var(--border); border-radius: 10px; font-size: 0.95em; font-family: 'Noto Sans KR', sans-serif; resize: vertical; min-height: 75px;"></textarea>
            </div>

            <!-- 이메일/SMS 상태 메시지 -->
            <div id="send-status-msg" style="display:none; margin-bottom:12px; padding:10px 16px; border-radius:8px; font-size:0.9em; font-weight:600; text-align:center;"></div>

            <!-- 하단 버튼 (항상 보이도록 sticky) -->
            <div style="position:sticky; bottom:0; background:white; border-top:2px solid #EAEDEF; padding:16px 0 4px 0; margin-top:20px;">
                <!-- 상단 행: 이메일·문자 발송 -->
                <div style="display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap;">
                    <button onclick="sendEstimateEmail()" id="btn-send-email"
                            style="flex:1; min-width:140px; padding:13px 18px; background:linear-gradient(135deg,#1976D2,#1565C0); color:white; border:none; border-radius:10px; cursor:pointer; font-size:0.95em; font-weight:700; display:flex; align-items:center; justify-content:center; gap:7px; box-shadow:0 3px 10px rgba(25,118,210,0.3);">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="white"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                        ✉️ 이메일 발송
                    </button>
                    <button onclick="sendEstimateSMS()" id="btn-send-sms"
                            style="flex:1; min-width:140px; padding:13px 18px; background:linear-gradient(135deg,#2E7D32,#1B5E20); color:white; border:none; border-radius:10px; cursor:pointer; font-size:0.95em; font-weight:700; display:flex; align-items:center; justify-content:center; gap:7px; box-shadow:0 3px 10px rgba(46,125,50,0.3);">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="white"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>
                        📱 문자 발송
                    </button>
                </div>
                <!-- 하단 행: 출력·닫기 -->
                <div style="display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
                    <button onclick="printEstimate()" style="padding:12px 28px; background:var(--primary); color:white; border:none; border-radius:10px; cursor:pointer; font-size:0.95em; font-weight:700;">
                        🖨️ 견적서 출력
                    </button>
                    <button onclick="closeEstimateModal()" style="padding:12px 24px; background:#EAEBED; color:#4A4A50; border:1px solid #D8D9DC; border-radius:10px; cursor:pointer; font-size:0.95em; font-weight:600;">
                        닫기
                    </button>
                </div>
            </div>
        </div>
    </div>

    </div> <!-- /#mainApp -->

    <script>


        // ==================== IndexedDB 설정 ====================

        const DB_NAME = 'ibuildCalculatorDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'calculations';
        let db = null;

        // ==================== 온라인 데이터베이스 설정 ====================

        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyRdOeKH-39qpJco9BPufs10C3zEPk3C_i_6EDLnhftAFRc_47ITVT9YZVVAb0Lu_M_/exec';
        const APP_PASSWORD = 'Screen10000**';
        const LOCAL_STORAGE_KEY = 'ibuild_calculations_local';

        let userPassword = '';
        let isOnlineMode = true;

        // ✅ 중복 저장 방지용 전역 상태
        let syncRunning = false;
        const syncingIds = new Set();
        
        // ✅ 저장 버튼 중복 클릭 방지용 잠금
        const savingLock = { single: false, double: false };

        let allCalculationsCache = [];

        // ==================== 온라인 상태 표시 ====================

        function updateOnlineStatus() {
            isOnlineMode = navigator.onLine;
            const indicator = document.getElementById('onlineStatusIndicator');
            if (indicator) {
                indicator.innerHTML = isOnlineMode
                    ? '<span style="color:#6B7685;font-size:13px;">🟢 온라인</span>'
                    : '<span style="color:#f44336;font-size:13px;">🔴 오프라인 (로컬 저장 중)</span>';
            }
        }
        window.addEventListener('online', () => {
            updateOnlineStatus();
            setTimeout(syncLocalToOnline, 500);
        });
        window.addEventListener('offline', () => { updateOnlineStatus(); });

        // ==================== 로컬 저장소 관리 ====================

        function saveToLocal(record) {
            try {
                // ✅ id 없는 데이터 방어
                if (!record || record.id == null) {
                    console.warn('⚠️ saveToLocal: id 없는 데이터 무시', record);
                    return;
                }
                const all = getLocalAll();
                const idStr = record.id.toString();
                const idx = all.findIndex(r => r.id != null && r.id.toString() === idStr);
                if (idx >= 0) {
                    if (new Date(record.timestamp) >= new Date(all[idx].timestamp)) {
                        all[idx] = record;
                    }
                } else {
                    all.push(record);
                }
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(all));
            } catch(e) { console.error('로컬 저장 오류:', e); }
        }

        function getLocalAll() {
            try { return JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY) || '[]'); }
            catch(e) { return []; }
        }

        function deleteFromLocal(id) {
            try {
                const all = getLocalAll().filter(r => r.id !== id.toString());
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(all));
            } catch(e) { console.error('로컬 삭제 오류:', e); }
        }

        // ==================== timestamp 안전 파싱 ====================

        function safeTimestamp(val) {
            if (!val) return new Date().toISOString();
            const d = new Date(val);
            return isNaN(d.getTime()) ? new Date().toISOString() : d.toISOString();
        }

        // ==================== 온라인/로컬 병합 (최신 우선) ====================

        function mergeData(onlineList, localList) {
            const map = new Map();
            onlineList.forEach(r => {
                // ✅ id 없는 데이터 건너뜀
                if (!r || r.id == null) { console.warn('⚠️ mergeData: id 없는 온라인 데이터 무시', r); return; }
                r.timestamp = safeTimestamp(r.timestamp);
                map.set(r.id.toString(), r);
            });
            localList.forEach(r => {
                // ✅ id 없는 데이터 건너뜀
                if (!r || r.id == null) { console.warn('⚠️ mergeData: id 없는 로컬 데이터 무시', r); return; }
                r.timestamp = safeTimestamp(r.timestamp);
                const existing = map.get(r.id.toString());
                if (!existing || new Date(r.timestamp) > new Date(existing.timestamp)) {
                    map.set(r.id.toString(), r);
                }
            });
            return Array.from(map.values())
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        }

        // ==================== 오프라인 데이터 온라인 동기화 ====================

        async function syncLocalToOnline() {
            if (!navigator.onLine) return;
            if (syncRunning) return;
            syncRunning = true;

            try {
                const localList = getLocalAll();
                const unsynced = localList.filter(r => r._localOnly === true && r._syncing !== true && !syncingIds.has(r.id));

                // ✅ 버그 수정: 동기화할 항목 없어도 반드시 syncRunning 해제 (finally에서 처리)
                if (unsynced.length === 0) return;

                console.log('🔄 동기화 시작:', unsynced.length + '개 업로드');
                let count = 0;
                for (const r of unsynced) {
                    syncingIds.add(r.id);
                    try {
                        const res = await callGAS({
                            password: userPassword, action: 'save', id: r.id,
                            type: r.type, widthInch: r.widthInch, heightInch: r.heightInch,
                            poNumber: r.poNumber || '',
                            customer: r.customer, date: r.date, address: r.address,
                            location: r.location, locations: r.locations, locationEntries: r.locationEntries,
                            email: r.email, phone: r.phone,
                            frameColor: r.frameColor, meshColor: r.meshColor, results: r.results
                        });
                        if (res.success) { r._localOnly = false; saveToLocal(r); count++; }
                    } catch(e) {
                        console.error('동기화 실패:', r.id);
                    } finally {
                        syncingIds.delete(r.id);
                    }
                }
                if (count > 0) {
                    console.log('✅ 동기화 완료:', count + '개');
                    updateOnlineStatus();
                    // ✅ 버그 수정: loadAllCalculations() 호출 금지 (무한루프 방지)
                    // 캐시만 직접 갱신
                    const freshLocal = getLocalAll();
                    allCalculationsCache = mergeData([], freshLocal);
                    console.log('📊 캐시 갱신:', allCalculationsCache.length + '개');
                }
            } finally {
                // ✅ 버그 수정: 어떤 경우에도 반드시 잠금 해제
                syncRunning = false;
            }
        }

        // ==================== 로그인 ====================

        window.login = function login() {
            const password = document.getElementById('loginPassword').value;
            if (password === APP_PASSWORD) {
                userPassword = password;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('loginError').style.display = 'none';
                updateOnlineStatus();
                loadAllCalculations();
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginPassword').focus();
            }
        }

        // ==================== 통합 불러오기 ====================

        async function loadAllCalculations() {
            const localList = getLocalAll();
            let onlineList = [];
            if (navigator.onLine) {
                try {
                    const data = await callGAS({ password: userPassword, action: 'load', t: Date.now() });
                    if (data.success) {
                        onlineList = (data.data || []).filter(r => r && r.id != null); // ✅ id 없는 데이터 사전 제거
                        onlineList.forEach(r => { r.timestamp = safeTimestamp(r.timestamp); saveToLocal(r); });
                        console.log('☁️ 온라인:', onlineList.length + '개');
                    } else {
                        console.warn('온라인 로드 실패:', data.error);
                    }
                } catch(e) {
                    console.warn('오프라인 모드 - 로컬 데이터 사용');
                }
            } else {
                console.log('📴 오프라인 - 로컬 데이터 사용');
            }
            allCalculationsCache = mergeData(onlineList, localList);
            console.log('📊 최종 데이터:', allCalculationsCache.length + '개');
            // ✅ 버그 수정: syncLocalToOnline() 호출 제거
            // syncLocalToOnline()이 완료 후 다시 loadAllCalculations()를 호출하는
            // 무한루프가 중복 저장의 원인이었음
            // 동기화는 온라인 복귀 이벤트(window 'online')에서만 실행됨
        }

        async function loadOnlineCalculations() {
            await loadAllCalculations();
        }

        // ==================== GAS 호출 ====================

        async function callGAS(params) {
            const url = new URL(GOOGLE_SCRIPT_URL);
            Object.keys(params).forEach(k => url.searchParams.append(k,
                typeof params[k] === 'object' ? JSON.stringify(params[k]) : params[k]
            ));
            const response = await fetch(url.toString(), { method: 'GET' });
            return response.json();
        }

        // ==================== 삭제 ====================

        window.gasDelete = async function(id) {
            if (!confirm('삭제하시겠습니까?')) return;
            const idStr = id.toString();
            deleteFromLocal(idStr);
            allCalculationsCache = allCalculationsCache.filter(c => c.id.toString() !== idStr);
            filterCalculations();
            if (navigator.onLine) {
                try {
                    const result = await callGAS({ password: userPassword, action: 'delete', id: idStr });
                    if (result.success) {
                        await loadAllCalculations();
                        filterCalculations();
                    } else {
                        alert('온라인 삭제 실패: ' + (result.error || '알 수 없는 오류'));
                    }
                } catch(e) {
                    alert('⚠️ 오프라인 - 로컬에서만 삭제되었습니다.');
                }
            } else {
                alert('⚠️ 오프라인 상태 - 로컬에서만 삭제되었습니다.\n온라인 연결 시 자동 반영됩니다.');
            }
        };

        // ==================== 저장 (이중 저장) ====================

        async function saveToGoogleSheets(type, widthInch, heightInch, customerInfo, results) {
            const id = "R_" + Date.now().toString();
            const timestamp = new Date().toISOString();
            const poNum = customerInfo.poNumber || currentPONumber || generatePONumber();
            const record = {
                id, timestamp, type, widthInch, heightInch,
                poNumber: poNum,
                customer: customerInfo.customer || '',
                date: customerInfo.date || '',
                address: customerInfo.address || '',
                location: customerInfo.location || '',
                locations: customerInfo.locations || [],
                locationEntries: customerInfo.locationEntries || [],
                email: customerInfo.email || '',
                phone: customerInfo.phone || '',
                frameColor: customerInfo.frameColor || '',
                meshColor: customerInfo.meshColor || '',
                results: results,
                _localOnly: true
            };
            // ① 항상 로컬에 먼저 저장 (캐시에는 추가하지 않음 - loadAllCalculations에서 처리)
            saveToLocal(record);

            // ② 온라인이면 구글 시트에도 저장
            if (navigator.onLine) {
                try {
                    const data = await callGAS({
                        password: userPassword, action: 'save', id,
                        type, widthInch, heightInch,
                        poNumber: poNum,
                        customer: customerInfo.customer, date: customerInfo.date,
                        address: customerInfo.address, location: customerInfo.location,
                        locations: customerInfo.locations, locationEntries: customerInfo.locationEntries,
                        email: customerInfo.email, phone: customerInfo.phone,
                        frameColor: customerInfo.frameColor, meshColor: customerInfo.meshColor,
                        results
                    });
                    if (data.success) {
                        record._localOnly = false;
                        saveToLocal(record);
                        return { success: true, savedOnline: true };
                    } else {
                        return { success: true, savedOnline: false, localOnly: true };
                    }
                } catch(e) {
                    return { success: true, savedOnline: false, localOnly: true };
                }
            } else {
                return { success: true, savedOnline: false, localOnly: true };
            }
        }



        function initDB() {

            return new Promise((resolve, reject) => {

                const request = indexedDB.open(DB_NAME, DB_VERSION);



                request.onerror = () => reject(request.error);

                request.onsuccess = () => {

                    db = request.result;

                    resolve(db);

                };



                request.onupgradeneeded = (event) => {

                    db = event.target.result;

                    if (!db.objectStoreNames.contains(STORE_NAME)) {

                        const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });

                        objectStore.createIndex('timestamp', 'timestamp', { unique: false });

                        objectStore.createIndex('type', 'type', { unique: false });

                    }

                };

            });

        }



        // 계산 결과 저장

        function saveCalculation(type, width, height, results) {

            return new Promise((resolve, reject) => {

                const transaction = db.transaction([STORE_NAME], 'readwrite');

                const objectStore = transaction.objectStore(STORE_NAME);



                const data = {

                    timestamp: new Date().toISOString(),

                    type: type,

                    width: width,

                    height: height,

                    results: results

                };



                const request = objectStore.add(data);

                request.onsuccess = () => resolve(request.result);

                request.onerror = () => reject(request.error);

            });

        }



        // 고객정보 포함 저장 (인치 단위)

        function saveCalculationWithCustomer(type, widthInch, heightInch, customerInfo, results) {

            return new Promise((resolve, reject) => {

                const transaction = db.transaction([STORE_NAME], 'readwrite');

                const objectStore = transaction.objectStore(STORE_NAME);



                const data = {

                    timestamp: new Date().toISOString(),

                    type: type,

                    widthInch: widthInch,

                    heightInch: heightInch,

                    customer: customerInfo.customer,

                    date: customerInfo.date,

                    address: customerInfo.address,

                    location: customerInfo.location,

                    email: customerInfo.email,

                    phone: customerInfo.phone,

                    frameColor: customerInfo.frameColor,

                    meshColor: customerInfo.meshColor,

                    results: results

                };



                const request = objectStore.add(data);

                request.onsuccess = () => resolve(request.result);

                request.onerror = () => reject(request.error);

            });

        }



        // 모든 계산 결과 불러오기

        function getAllCalculations() {

            return new Promise((resolve, reject) => {

                const transaction = db.transaction([STORE_NAME], 'readonly');

                const objectStore = transaction.objectStore(STORE_NAME);

                const request = objectStore.getAll();



                request.onsuccess = () => resolve(request.result);

                request.onerror = () => reject(request.error);

            });

        }



        // 특정 계산 결과 삭제

        function deleteCalculation(id) {

            return new Promise((resolve, reject) => {

                const transaction = db.transaction([STORE_NAME], 'readwrite');

                const objectStore = transaction.objectStore(STORE_NAME);

                const request = objectStore.delete(id);



                request.onsuccess = () => resolve();

                request.onerror = () => reject(request.error);

            });

        }



        // 모든 계산 결과 삭제

        window.clearAllCalculations = function clearAllCalculations() {

            return new Promise((resolve, reject) => {

                const transaction = db.transaction([STORE_NAME], 'readwrite');

                const objectStore = transaction.objectStore(STORE_NAME);

                const request = objectStore.clear();



                request.onsuccess = () => resolve();

                request.onerror = () => reject(request.error);

            });

        }



        // 데이터베이스 초기화 실행

        initDB()

            .then(() => {

                console.log('✅ 데이터베이스 초기화 완료');

            })

            .catch(error => {

                console.error('❌ Database initialization error:', error);

                alert('데이터베이스 초기화에 실패했습니다. 브라우저를 새로고침해주세요.');

            });



        // 팝업 타이머

        let modalOpenTimer = null;

        let modalCloseTimer = null;

        

        // 구조도 표시 (호버용)

        window.showStructureDiagram = function showStructureDiagram(type) {

            // 닫기 타이머가 있으면 취소

            if (modalCloseTimer) {

                clearTimeout(modalCloseTimer);

                modalCloseTimer = null;

            }

            

            // 기존 열기 타이머가 있으면 취소

            if (modalOpenTimer) {

                clearTimeout(modalOpenTimer);

            }

            

            // 약간의 지연 후 팝업 표시

            modalOpenTimer = setTimeout(() => {

                const modal = document.getElementById('structureModal');

                const modalTitle = document.getElementById('modalTitle');

                const modalImage = document.getElementById('modalImage');

                

                if (type === 'single') {

                    modalTitle.textContent = 'Single 구조도';

                    modalImage.src = 'single-door-structure.png';

                    modalImage.alt = 'Single 구조도';

                } else {

                    modalTitle.textContent = 'Double 구조도';

                    modalImage.src = 'double-door-structure.png';

                    modalImage.alt = 'Double 구조도';

                }

                

                modal.style.display = 'block';

            }, 200); // 200ms 지연

        }

        

        // 구조도 숨기기 (호버 종료 시)

        window.hideStructureDiagram = function hideStructureDiagram() {

            // 열기 타이머가 있으면 취소 (아직 열리지 않은 경우)

            if (modalOpenTimer) {

                clearTimeout(modalOpenTimer);

                modalOpenTimer = null;

            }

            

            // 약간의 지연 후 팝업 닫기

            modalCloseTimer = setTimeout(() => {

                const modal = document.getElementById('structureModal');

                modal.style.display = 'none';

            }, 200); // 200ms 지연

        }

        

        // 모달 위에 마우스가 있을 때 닫기 취소

        window.keepModalOpen = function keepModalOpen() {

            if (modalCloseTimer) {

                clearTimeout(modalCloseTimer);

                modalCloseTimer = null;

            }

        }

        

        // 부속 리스트 표시 (호버용)

        let partsModalOpenTimer = null;

        let partsModalCloseTimer = null;

        

        window.showPartsList = function showPartsList(type) {

            // 닫기 타이머가 있으면 취소

            if (partsModalCloseTimer) {

                clearTimeout(partsModalCloseTimer);

                partsModalCloseTimer = null;

            }

            

            // 기존 열기 타이머가 있으면 취소

            if (partsModalOpenTimer) {

                clearTimeout(partsModalOpenTimer);

            }

            

            // 약간의 지연 후 팝업 표시

            partsModalOpenTimer = setTimeout(() => {

                const modal = document.getElementById('partsModal');

                const modalTitle = document.getElementById('partsModalTitle');

                const modalBody = document.getElementById('partsModalBody');

                

                let partsHTML = '';

                

                if (type === 'single') {

                    modalTitle.textContent = 'Single 부속 리스트';

                    const mkCard = (svg, title, sub, qty, clr='var(--primary)') =>
                        `<div style="padding:15px;border:2px solid ${clr};border-radius:12px;text-align:center;background:#f9f9f9;">
                            <svg viewBox="0 0 100 100" style="width:80px;height:80px;margin-bottom:10px;">${svg}</svg>
                            <div style="font-weight:bold;color:${clr};margin-bottom:4px;font-size:.9em;">${title}</div>
                            <div style="font-size:.85em;color:#666;margin-bottom:6px;">${sub}</div>
                            <div style="font-weight:bold;color:#D4851C;">${qty}</div>
                        </div>`;

                    const railH  = (c) => `<rect x="5" y="35" width="90" height="30" fill="${c}" rx="3"/>`;
                    const railV  = (c) => `<rect x="35" y="5" width="30" height="90" fill="${c}" rx="3"/>`;
                    const lfix   = (c) => railV(c)+`<circle cx="50" cy="20" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/><circle cx="50" cy="50" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/><circle cx="50" cy="80" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/>`;
                    const sfix   = (c) => railV(c)+`<circle cx="50" cy="30" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/><circle cx="50" cy="70" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/>`;
                    const mesh   = `<rect x="10" y="10" width="80" height="80" fill="none" stroke="#8B7355" stroke-width="3"/>` + Array.from({length:4},(_,i)=>`<line x1="${25+i*15}" y1="10" x2="${25+i*15}" y2="90" stroke="#8B7355" stroke-width="1"/>`).join('') + Array.from({length:4},(_,i)=>`<line x1="10" y1="${25+i*15}" x2="90" y2="${25+i*15}" stroke="#8B7355" stroke-width="1"/>`).join('');
                    const pvc18  = `<rect x="25" y="35" width="50" height="30" fill="#BDC3C7" rx="3"/><rect x="27" y="37" width="46" height="26" fill="#ECF0F1" rx="2"/><text x="50" y="55" fill="#7f8c8d" font-size="9" text-anchor="middle" font-weight="bold">18mm</text>`;
                    const corner = `<rect x="28" y="28" width="44" height="8" fill="#6B6B6B" rx="2"/><rect x="28" y="28" width="8" height="44" fill="#6B6B6B" rx="2"/><circle cx="32" cy="32" r="3" fill="#C84630"/><circle cx="62" cy="32" r="3" fill="#C84630"/><circle cx="32" cy="62" r="3" fill="#C84630"/>`;
                    const brkt   = `<rect x="32" y="15" width="36" height="70" fill="#6B6B6B" rx="3"/><circle cx="50" cy="30" r="4" fill="white"/><circle cx="50" cy="50" r="4" fill="white"/><circle cx="50" cy="70" r="4" fill="white"/><rect x="20" y="35" width="12" height="8" fill="#4A4A4A" rx="1"/><rect x="68" y="35" width="12" height="8" fill="#4A4A4A" rx="1"/>`;
                    const roller = `<circle cx="50" cy="50" r="22" fill="#4A5568" stroke="#2D3748" stroke-width="2"/><circle cx="50" cy="50" r="14" fill="#718096"/><circle cx="50" cy="50" r="6" fill="#2D3748"/><line x1="50" y1="28" x2="50" y2="18" stroke="#C84630" stroke-width="2.5"/><line x1="50" y1="72" x2="50" y2="82" stroke="#C84630" stroke-width="2.5"/>`;
                    const endcap = `<rect x="30" y="35" width="40" height="30" fill="#8B9EB7" rx="4"/><rect x="20" y="38" width="10" height="24" fill="#6B7E97" rx="2"/><line x1="35" y1="42" x2="65" y2="42" stroke="#6B7E97" stroke-width="1.5"/><line x1="35" y1="50" x2="65" y2="50" stroke="#6B7E97" stroke-width="1.5"/><line x1="35" y1="58" x2="65" y2="58" stroke="#6B7E97" stroke-width="1.5"/>`;

                    partsHTML = `<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px;">
                        ${mkCard(railH('var(--primary)')+'<text x="50" y="28" fill="var(--primary)" font-size="9" text-anchor="middle">Top Rail</text>', 'Top Rail Bar', '상단 프레임', '× 1개')}
                        ${mkCard(railH('var(--primary)')+'<text x="50" y="90" fill="var(--primary)" font-size="9" text-anchor="middle">Bottom Rail</text>', 'Bottom Rail Bar', '하단 프레임', '× 1개')}
                        ${mkCard(railV('var(--primary)')+'<text x="50" y="55" fill="white" font-size="9" text-anchor="middle">32mm</text>', 'Sidewall Vertical Rail Bar', '벽면 수직바', '× 2개')}
                        ${mkCard(lfix('var(--primary)'), 'Large Fix Rail', '큰 경첩바 (3홀)', '× 1개')}
                        ${mkCard(sfix('var(--primary)'), 'Small Fix Rail', '작은 경첩바 (2홀)', '× 1개')}
                        ${mkCard('<rect x="40" y="30" width="20" height="40" fill="var(--primary-light)" rx="6" stroke="white" stroke-width="1.5"/><rect x="30" y="45" width="40" height="10" fill="var(--primary)" rx="3"/><circle cx="50" cy="25" r="6" fill="#D4A574"/><text x="50" y="85" fill="var(--primary-light)" font-size="10" text-anchor="middle">♂</text>', 'Handle Bar (Male)', '핸들 바 (수)', '× 1개', 'var(--primary-light)')}
                        ${mkCard(mesh, 'Mesh 20 (방충망 원단)', '망접힘 갯수 포함', '× 1개', '#8B7355')}
                        ${mkCard(pvc18, 'PVC 18mm', 'PVC 스프링 (내부)', '× 1개', '#95A5A6')}
                        ${mkCard('<path d="M20,50 Q50,20 80,50 Q50,80 20,50" fill="none" stroke="#E74C3C" stroke-width="4"/><circle cx="20" cy="50" r="4" fill="#E74C3C"/><circle cx="80" cy="50" r="4" fill="#E74C3C"/>', 'String (Inside)', '스프링 고정 실', '계산값 참조', '#E74C3C')}
                        ${mkCard(corner, 'Corner Connector', '코너 연결 부품', '× 4 ea', '#6B6B6B')}
                        ${mkCard(brkt, 'Mounting Bracket', '설치 브라켓', '× 8 ea', '#555')}
                        ${mkCard(roller, 'Roller Assembly', '롤러 어셈블리', '× 2 set', '#4A5568')}
                        ${mkCard(endcap, 'End Cap', '엔드 캡', '× 4 ea', '#8B9EB7')}
                        ${mkCard('<ellipse cx="50" cy="50" rx="20" ry="28" fill="#C0392B" stroke="#922B21" stroke-width="2"/><ellipse cx="50" cy="50" rx="12" ry="18" fill="#E74C3C"/><text x="50" y="38" fill="white" font-size="8" text-anchor="middle" font-weight="bold">N</text><text x="50" y="66" fill="white" font-size="8" text-anchor="middle" font-weight="bold">S</text><line x1="50" y1="22" x2="50" y2="78" stroke="rgba(255,255,255,0.4)" stroke-width="1.5"/><text x="50" y="90" fill="#C0392B" font-size="8" text-anchor="middle" font-weight="bold">L</text>', 'Magnet (L)', '자석 (대)', '× 2 ea', '#C0392B')}
                        ${mkCard('<ellipse cx="50" cy="50" rx="16" ry="22" fill="#C0392B" stroke="#922B21" stroke-width="2"/><ellipse cx="50" cy="50" rx="9" ry="14" fill="#E74C3C"/><text x="50" y="40" fill="white" font-size="8" text-anchor="middle" font-weight="bold">N</text><text x="50" y="63" fill="white" font-size="8" text-anchor="middle" font-weight="bold">S</text><line x1="50" y1="28" x2="50" y2="72" stroke="rgba(255,255,255,0.4)" stroke-width="1.5"/><text x="50" y="88" fill="#C0392B" font-size="8" text-anchor="middle" font-weight="bold">M</text>', 'Magnet (M)', '자석 (중)', '× 2 ea', '#C0392B')}
                        ${mkCard('<rect x="38" y="20" width="24" height="60" fill="#7F8C8D" rx="12"/><circle cx="50" cy="35" r="6" fill="#BDC3C7"/><circle cx="50" cy="35" r="3" fill="#5D6D7E"/><rect x="44" y="52" width="12" height="20" fill="#5D6D7E" rx="2"/><text x="50" y="90" fill="#7F8C8D" font-size="8" text-anchor="middle" font-weight="bold">PLUG</text>', 'Plug', '플러그', '× 12 ea', '#7F8C8D')}
                        ${mkCard('<rect x="25" y="30" width="50" height="40" fill="#2980B9" rx="5" stroke="#1A5276" stroke-width="2"/><rect x="35" y="38" width="30" height="8" fill="#AED6F1" rx="2"/><rect x="35" y="50" width="30" height="8" fill="#AED6F1" rx="2"/><line x1="50" y1="70" x2="50" y2="82" stroke="#1A5276" stroke-width="2"/><circle cx="50" cy="85" r="3" fill="#1A5276"/><text x="50" y="18" fill="#2980B9" font-size="7" text-anchor="middle" font-weight="bold">Tension (L)</text>', 'Tension Controller (L)', '텐션 컨트롤러 (대)', '× 2 ea', '#2980B9')}
                    </div>`;

                } else {

                    modalTitle.textContent = 'Double 부속 리스트';

                    const mkCard2 = (svg, title, sub, qty, clr='#1565C0') =>
                        `<div style="padding:15px;border:2px solid ${clr};border-radius:12px;text-align:center;background:#f9f9f9;">
                            <svg viewBox="0 0 100 100" style="width:80px;height:80px;margin-bottom:10px;">${svg}</svg>
                            <div style="font-weight:bold;color:${clr};margin-bottom:4px;font-size:.9em;">${title}</div>
                            <div style="font-size:.85em;color:#666;margin-bottom:6px;">${sub}</div>
                            <div style="font-weight:bold;color:#D4851C;">${qty}</div>
                        </div>`;

                    const railHB = `<rect x="5" y="35" width="90" height="30" fill="#1565C0" rx="3"/>`;
                    const railVB = `<rect x="35" y="5" width="30" height="90" fill="#1565C0" rx="3"/>`;
                    const lfixB  = railVB+`<circle cx="50" cy="20" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/><circle cx="50" cy="50" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/><circle cx="50" cy="80" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/>`;
                    const meshS  = `<rect x="10" y="10" width="80" height="80" fill="none" stroke="#8B7355" stroke-width="3"/>` + Array.from({length:4},(_,i)=>`<line x1="${25+i*15}" y1="10" x2="${25+i*15}" y2="90" stroke="#8B7355" stroke-width="1"/>`).join('') + Array.from({length:4},(_,i)=>`<line x1="10" y1="${25+i*15}" x2="90" y2="${25+i*15}" stroke="#8B7355" stroke-width="1"/>`).join('');
                    const pvc18B = `<rect x="25" y="35" width="50" height="30" fill="#BDC3C7" rx="3"/><rect x="27" y="37" width="46" height="26" fill="#ECF0F1" rx="2"/><text x="50" y="55" fill="#7f8c8d" font-size="9" text-anchor="middle" font-weight="bold">18mm</text>`;
                    const corner2 = `<rect x="28" y="28" width="44" height="8" fill="#6B6B6B" rx="2"/><rect x="28" y="28" width="8" height="44" fill="#6B6B6B" rx="2"/><circle cx="32" cy="32" r="3" fill="#C84630"/><circle cx="62" cy="32" r="3" fill="#C84630"/><circle cx="32" cy="62" r="3" fill="#C84630"/>`;
                    const brkt2   = `<rect x="32" y="15" width="36" height="70" fill="#6B6B6B" rx="3"/><circle cx="50" cy="30" r="4" fill="white"/><circle cx="50" cy="50" r="4" fill="white"/><circle cx="50" cy="70" r="4" fill="white"/><rect x="20" y="35" width="12" height="8" fill="#4A4A4A" rx="1"/><rect x="68" y="35" width="12" height="8" fill="#4A4A4A" rx="1"/>`;
                    const roller2 = `<circle cx="50" cy="50" r="22" fill="#4A5568" stroke="#2D3748" stroke-width="2"/><circle cx="50" cy="50" r="14" fill="#718096"/><circle cx="50" cy="50" r="6" fill="#2D3748"/><line x1="50" y1="28" x2="50" y2="18" stroke="#C84630" stroke-width="2.5"/><line x1="50" y1="72" x2="50" y2="82" stroke="#C84630" stroke-width="2.5"/>`;
                    const endcap2 = `<rect x="30" y="35" width="40" height="30" fill="#8B9EB7" rx="4"/><rect x="20" y="38" width="10" height="24" fill="#6B7E97" rx="2"/><line x1="35" y1="42" x2="65" y2="42" stroke="#6B7E97" stroke-width="1.5"/><line x1="35" y1="50" x2="65" y2="50" stroke="#6B7E97" stroke-width="1.5"/><line x1="35" y1="58" x2="65" y2="58" stroke="#6B7E97" stroke-width="1.5"/>`;

                    partsHTML = `<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px;">
                        ${mkCard2(railHB+'<text x="50" y="28" fill="#1565C0" font-size="9" text-anchor="middle">Top Rail</text>', 'Top Rail Bar', '상단 프레임', '× 1개')}
                        ${mkCard2(railHB+'<text x="50" y="90" fill="#1565C0" font-size="9" text-anchor="middle">Bottom Rail</text>', 'Bottom Rail Bar', '하단 프레임', '× 1개')}
                        ${mkCard2(railVB+'<text x="50" y="55" fill="white" font-size="9" text-anchor="middle">32mm</text>', 'Sidewall Vertical Rail Bar', '벽면 수직바', '× 2개')}
                        ${mkCard2(lfixB, 'Large Fix Rail', '큰 경첩바 (3홀)', '× 2개')}
                        ${mkCard2('<rect x="40" y="30" width="20" height="40" fill="#1976D2" rx="6" stroke="white" stroke-width="1.5"/><rect x="30" y="45" width="40" height="10" fill="#1565C0" rx="3"/><circle cx="50" cy="25" r="6" fill="#D4A574"/><text x="50" y="85" fill="#1976D2" font-size="10" text-anchor="middle">♂</text>', 'Handle Bar (Male)', '핸들 바 (수)', '× 1개', '#1976D2')}
                        ${mkCard2('<rect x="40" y="30" width="20" height="40" fill="#1976D2" rx="6" stroke="white" stroke-width="1.5"/><rect x="30" y="45" width="40" height="10" fill="#1565C0" rx="3"/><circle cx="50" cy="75" r="6" fill="#D4A574"/><text x="50" y="15" fill="#1976D2" font-size="10" text-anchor="middle">♀</text>', 'Handle Bar (Female)', '핸들 바 (암)', '× 1개', '#1976D2')}
                        ${mkCard2(meshS, 'Mesh 20 (방충망 원단)', '망접힘 갯수 포함', '× 2개', '#8B7355')}
                        ${mkCard2(pvc18B, 'PVC 18mm', 'PVC 스프링 (내부)', '× 2개', '#95A5A6')}
                        ${mkCard2('<path d="M20,50 Q50,20 80,50 Q50,80 20,50" fill="none" stroke="#E74C3C" stroke-width="4"/><circle cx="20" cy="50" r="4" fill="#E74C3C"/><circle cx="80" cy="50" r="4" fill="#E74C3C"/>', 'String (Inside)', '내부 스프링 실', '계산값 참조', '#E74C3C')}
                        ${mkCard2('<path d="M15,50 Q50,15 85,50 Q50,85 15,50" fill="none" stroke="#8E44AD" stroke-width="4"/><circle cx="15" cy="50" r="4" fill="#8E44AD"/><circle cx="85" cy="50" r="4" fill="#8E44AD"/>', 'String (Outside)', '외부 스프링 실', '계산값 참조', '#8E44AD')}
                        ${mkCard2(corner2, 'Corner Connector', '코너 연결 부품', '× 4 ea', '#6B6B6B')}
                        ${mkCard2(brkt2, 'Mounting Bracket', '설치 브라켓', '× 8 ea', '#555')}
                        ${mkCard2(roller2, 'Roller Assembly', '롤러 어셈블리', '× 4 set', '#4A5568')}
                        ${mkCard2(endcap2, 'End Cap', '엔드 캡', '× 4 ea', '#8B9EB7')}
                        ${mkCard2('<ellipse cx="50" cy="50" rx="20" ry="28" fill="#C0392B" stroke="#922B21" stroke-width="2"/><ellipse cx="50" cy="50" rx="12" ry="18" fill="#E74C3C"/><text x="50" y="38" fill="white" font-size="8" text-anchor="middle" font-weight="bold">N</text><text x="50" y="66" fill="white" font-size="8" text-anchor="middle" font-weight="bold">S</text><line x1="50" y1="22" x2="50" y2="78" stroke="rgba(255,255,255,0.4)" stroke-width="1.5"/><text x="50" y="90" fill="#C0392B" font-size="8" text-anchor="middle" font-weight="bold">L</text>', 'Magnet (L)', '자석 (대)', '× 2 ea', '#C0392B')}
                        ${mkCard2('<ellipse cx="50" cy="50" rx="12" ry="17" fill="#C0392B" stroke="#922B21" stroke-width="2"/><ellipse cx="50" cy="50" rx="7" ry="11" fill="#E74C3C"/><text x="50" y="41" fill="white" font-size="7" text-anchor="middle" font-weight="bold">N</text><text x="50" y="61" fill="white" font-size="7" text-anchor="middle" font-weight="bold">S</text><line x1="50" y1="33" x2="50" y2="67" stroke="rgba(255,255,255,0.4)" stroke-width="1.5"/><text x="50" y="88" fill="#C0392B" font-size="8" text-anchor="middle" font-weight="bold">S</text>', 'Magnet (S)', '자석 (소)', '× 2 ea', '#C0392B')}
                        ${mkCard2('<rect x="38" y="20" width="24" height="60" fill="#7F8C8D" rx="12"/><circle cx="50" cy="35" r="6" fill="#BDC3C7"/><circle cx="50" cy="35" r="3" fill="#5D6D7E"/><rect x="44" y="52" width="12" height="20" fill="#5D6D7E" rx="2"/><text x="50" y="90" fill="#7F8C8D" font-size="8" text-anchor="middle" font-weight="bold">PLUG</text>', 'Plug', '플러그', '× 24 ea', '#7F8C8D')}
                        ${mkCard2('<rect x="30" y="33" width="40" height="34" fill="#27AE60" rx="5" stroke="#1E8449" stroke-width="2"/><rect x="38" y="40" width="24" height="7" fill="#A9DFBF" rx="2"/><rect x="38" y="52" width="24" height="7" fill="#A9DFBF" rx="2"/><line x1="50" y1="67" x2="50" y2="78" stroke="#1E8449" stroke-width="2"/><circle cx="50" cy="81" r="3" fill="#1E8449"/><text x="50" y="20" fill="#27AE60" font-size="7" text-anchor="middle" font-weight="bold">Tension (S)</text>', 'Tension Controller (S)', '텐션 컨트롤러 (소)', '× 12 ea', '#27AE60')}
                    </div>`;

                }

                

                modalBody.innerHTML = partsHTML;

                modal.style.display = 'block';

            }, 200); // 200ms 지연

        }

        

        // 부속 리스트 숨기기 (호버 종료 시)

        window.hidePartsList = function hidePartsList() {

            // 열기 타이머가 있으면 취소

            if (partsModalOpenTimer) {

                clearTimeout(partsModalOpenTimer);

                partsModalOpenTimer = null;

            }

            

            // 약간의 지연 후 팝업 닫기

            partsModalCloseTimer = setTimeout(() => {

                const modal = document.getElementById('partsModal');

                modal.style.display = 'none';

            }, 200); // 200ms 지연

        }

        

        // 부속 리스트 모달 위에 마우스가 있을 때 닫기 취소

        window.keepPartsModalOpen = function keepPartsModalOpen() {

            if (partsModalCloseTimer) {

                clearTimeout(partsModalCloseTimer);

                partsModalCloseTimer = null;

            }

        }

        

        // 부속 리스트 모달 즉시 닫기 (버튼용)

        window.closePartsModalDirect = function closePartsModalDirect() {

            if (partsModalOpenTimer) {

                clearTimeout(partsModalOpenTimer);

                partsModalOpenTimer = null;

            }

            if (partsModalCloseTimer) {

                clearTimeout(partsModalCloseTimer);

                partsModalCloseTimer = null;

            }

            const modal = document.getElementById('partsModal');

            modal.style.display = 'none';

        }

        

        // 팝업 모달 열기

        function openModal(type) {

            // 닫기 타이머가 있으면 취소

            if (modalCloseTimer) {

                clearTimeout(modalCloseTimer);

                modalCloseTimer = null;

            }

            

            // 기존 열기 타이머가 있으면 취소

            if (modalOpenTimer) {

                clearTimeout(modalOpenTimer);

            }

            

            // 약간의 지연 후 팝업 표시 (자연스러운 hover 효과)

            modalOpenTimer = setTimeout(() => {

                const modal = document.getElementById('structureModal');

                const modalTitle = document.getElementById('modalTitle');

                const modalImage = document.getElementById('modalImage');

                

                if (type === 'single') {

                    modalTitle.textContent = 'Single 구조도';

                    modalImage.src = '/mnt/user-data/uploads/single-door-structure.png';

                    modalImage.alt = 'Single 구조도';

                } else {

                    modalTitle.textContent = 'Double 구조도';

                    modalImage.src = '/mnt/user-data/uploads/double-door-structure.png';

                    modalImage.alt = 'Double 구조도';

                }

                

                modal.style.display = 'block';

            }, 300); // 300ms 지연

        }

        

        // 아이콘에서 마우스가 벗어나면 즉시 팝업 닫기

        function closeModalImmediately() {

            // 열기 타이머가 있으면 취소 (아직 열리지 않은 경우)

            if (modalOpenTimer) {

                clearTimeout(modalOpenTimer);

                modalOpenTimer = null;

            }

            

            // 기존 닫기 타이머가 있으면 취소

            if (modalCloseTimer) {

                clearTimeout(modalCloseTimer);

            }

            

            // 즉시 닫기 (지연 없음)

            const structureModal = document.getElementById('structureModal');

            structureModal.style.display = 'none';

        }

        

        // 팝업 닫기 예약 (모달 위에서 사용)

        function scheduleCloseModal() {

            // 기존 닫기 타이머가 있으면 취소

            if (modalCloseTimer) {

                clearTimeout(modalCloseTimer);

            }

            

            // 약간의 지연 후 팝업 닫기

            modalCloseTimer = setTimeout(() => {

                const modal = document.getElementById('structureModal');

                modal.style.display = 'none';

            }, 200); // 200ms 지연

        }

        

        // 팝업 닫기 취소

        function cancelCloseModal() {

            if (modalCloseTimer) {

                clearTimeout(modalCloseTimer);

                modalCloseTimer = null;

            }

        }

        

        // 팝업 모달 즉시 닫기 (버튼/ESC/외부클릭)

        window.closeModal = function closeModal() {

            // 모든 타이머 취소

            if (modalOpenTimer) {

                clearTimeout(modalOpenTimer);

                modalOpenTimer = null;

            }

            if (modalCloseTimer) {

                clearTimeout(modalCloseTimer);

                modalCloseTimer = null;

            }

            

            const modal = document.getElementById('structureModal');

            modal.style.display = 'none';

        }

        

        // 모달 외부 클릭 시 닫기

        window.onclick = function(event) {

            const modal = document.getElementById('structureModal');

            if (event.target === modal) {

                closeModal();

            }

        }

        

        // ESC 키로 모달 닫기

        document.addEventListener('keydown', function(event) {

            if (event.key === 'Escape') {

                closeModal();

            }

        });

        

        // 이미지 로드 에러 처리

        function handleImageError() {

            const modalImage = document.getElementById('modalImage');

            const imageError = document.getElementById('imageError');

            

            modalImage.style.display = 'none';

            imageError.style.display = 'block';

        }

        

        // 이미지 로드 성공 처리

        function handleImageLoad() {

            const modalImage = document.getElementById('modalImage');

            const imageError = document.getElementById('imageError');

            

            modalImage.style.display = 'block';

            imageError.style.display = 'none';

        }

        

        // 부품 리스트 팝업 열기

        

        // 최대공약수 계산 함수 (유클리드 호제법)

        function calculateGCD(a, b) {

            while (b !== 0) {

                const temp = b;

                b = a % b;

                a = temp;

            }

            return a;

        }

        

        // mm를 인치 분수로 변환 (1/16 단위)

        function mmToInchFraction(mm) {

            const inches = mm / 25.4;

            const whole = Math.floor(inches);

            const decimal = inches - whole;

            const sixteenths = Math.round(decimal * 16);

            

            if (sixteenths === 0) {

                return whole === 0 ? '0"' : `${whole}"`;

            }

            

            if (sixteenths === 16) {

                return `${whole + 1}"`;

            }

            

            // 분수 간소화

            let numerator = sixteenths;

            let denominator = 16;

            

            const divisor = calculateGCD(numerator, denominator);

            numerator /= divisor;

            denominator /= divisor;

            

            if (whole === 0) {

                return `${numerator}/${denominator}"`;

            } else {

                return `${whole} ${numerator}/${denominator}"`;

            }

        }

        

        // inch 값을 분수 형식으로 변환 (1/16 단위)

        function inchToFraction(inches) {

            const whole = Math.floor(inches);

            const decimal = inches - whole;

            const sixteenths = Math.round(decimal * 16);

            

            if (sixteenths === 0) {

                return whole === 0 ? '0' : `${whole}`;

            }

            

            if (sixteenths === 16) {

                return `${whole + 1}`;

            }

            

            // 분수 간소화

            let numerator = sixteenths;

            let denominator = 16;

            

            const divisor = calculateGCD(numerator, denominator);

            numerator /= divisor;

            denominator /= divisor;

            

            if (whole === 0) {

                return `${numerator}/${denominator}`;

            } else {

                return `${whole} ${numerator}/${denominator}`;

            }

        }



        // 인치를 피트-인치 분수로 변환

        function inchToFeetInch(totalInches) {

            const feet = Math.floor(totalInches / 12);

            const inches = totalInches % 12;

            const whole = Math.floor(inches);

            const decimal = inches - whole;

            const sixteenths = Math.round(decimal * 16);

            

            if (sixteenths === 0) {

                if (feet === 0) {

                    return whole === 0 ? '0"' : `${whole}"`;

                }

                return whole === 0 ? `${feet}'` : `${feet}' ${whole}"`;

            }

            

            if (sixteenths === 16) {

                const newWhole = whole + 1;

                if (newWhole === 12) {

                    return `${feet + 1}'`;

                }

                if (feet === 0) {

                    return `${newWhole}"`;

                }

                return `${feet}' ${newWhole}"`;

            }

            

            // 분수 간소화

            let numerator = sixteenths;

            let denominator = 16;

            const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);

            const divisor = gcd(numerator, denominator);

            numerator /= divisor;

            denominator /= divisor;

            

            if (feet === 0) {

                if (whole === 0) {

                    return `${numerator}/${denominator}"`;

                } else {

                    return `${whole} ${numerator}/${denominator}"`;

                }

            } else {

                if (whole === 0) {

                    return `${feet}' ${numerator}/${denominator}"`;

                } else {

                    return `${feet}' ${whole} ${numerator}/${denominator}"`;

                }

            }

        }



        // 치수를 인치와 mm로 함께 표시

        function displayDimension(elementId, mmValue) {

            const element = document.getElementById(elementId);

            if (!element) return;

            

            const inchFraction = mmToInchFraction(mmValue);

            const mmRounded = Math.round(mmValue);

            

            element.innerHTML = `

                <div style="font-size: 2.5em; font-weight: 900; font-family: 'Nanum Myeongjo', serif; color: var(--primary); margin-bottom: 8px;">

                    ${inchFraction}

                </div>

                <div style="font-size: 0.85em; color: var(--text-light); font-weight: 600;">

                    (${mmRounded} mm)

                </div>

            `;

        }



        // 결과를 인치와 mm로 함께 표시

        function displayDualUnit(elementId, mmValue) {

            const element = document.getElementById(elementId);

            if (!element) return;

            

            const inchFraction = mmToInchFraction(mmValue);

            const mmRounded = Math.round(mmValue);

            

            element.innerHTML = `

                <span class="result-primary">${inchFraction}</span>

                <span class="result-secondary">(${mmRounded} mm)</span>

            `;

        }



        // 현재 단위 저장

        const units = {

            single: 'inch',

            double: 'inch'

        };



        // 탭 전환

        // 탭 전환 함수

        window.switchTab = function switchTab(tab, element) {

            // 모든 탭과 콘텐츠에서 active 클래스 제거

            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));

            

            // 클릭한 탭과 해당 콘텐츠에 active 클래스 추가

            element.classList.add('active');

            document.getElementById(tab).classList.add('active');

        }



        // 단위 설정

        window.setUnit = function setUnit(type, unit, event) {

            units[type] = unit;

            const buttons = document.querySelectorAll(`#${type} .unit-btn`);

            buttons.forEach(btn => {

                btn.classList.remove('active');

                // 버튼 텍스트로 단위 확인

                if ((unit === 'mm' && btn.textContent.includes('밀리미터')) ||

                    (unit === 'inch' && btn.textContent.includes('인치'))) {

                    btn.classList.add('active');

                }

            });

            

            // event가 있을 때만 (버튼 클릭 시)

            if (event && event.target) {

                buttons.forEach(btn => btn.classList.remove('active'));

                event.target.classList.add('active');

            }

            

            calculate(type);

        }



        // 방충망 다이어그램 그리기

                function drawScreenDiagram(type, positions, height) {

            // screen-diagram-{type} 이 있으면 기존 방식, 없으면 hole-info 아래에 svg 삽입
            let svg = document.getElementById(`screen-diagram-${type}`);

            // 기존 DOM이 없으면 hole-info-{type} div 아래에 SVG 컨테이너 생성/재사용
            if (!svg) {
                const holeInfoEl = document.getElementById(`hole-info-${type}`);
                if (!holeInfoEl) return; // 둘 다 없으면 포기
                let diagramWrap = document.getElementById(`hole-diagram-wrap-${type}`);
                if (!diagramWrap) {
                    diagramWrap = document.createElement('div');
                    diagramWrap.id = `hole-diagram-wrap-${type}`;
                    diagramWrap.style.cssText = 'margin-top:16px;background:#F5F6F7;border-radius:12px;padding:12px;border:1px solid #D0D7DC;overflow-x:auto;';
                    diagramWrap.innerHTML = `<div style="font-weight:700;color:var(--primary);margin-bottom:8px;font-size:0.9em;">📐 도면</div><svg id="screen-diagram-${type}" viewBox="0 0 1200 400" style="width:100%;height:auto;display:block;min-width:600px;"></svg>`;
                    holeInfoEl.appendChild(diagramWrap);
                }
                svg = document.getElementById(`screen-diagram-${type}`);
                if (!svg) return;
            }

            // 가로 방향 설정

            const svgWidth = 1200;

            const svgHeight = 400;

            const padding = 80;

            const screenHeight = 180;

            const screenWidth = 1000;

            const screenX = padding + 60;

            const screenY = (svgHeight - screenHeight) / 2;

            

            const scale = screenWidth / height;

            

            let svgContent = '';

            

            if (type === 'single') {

                svgContent += `

                    <rect x="${screenX}" y="${screenY}" width="${screenWidth}" height="${screenHeight}" 

                          fill="none" stroke="var(--primary)" stroke-width="6" rx="8"/>

                    

                    <defs>

                        <pattern id="mesh-pattern-h" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">

                            <line x1="0" y1="0" x2="0" y2="20" stroke="#D4A574" stroke-width="0.5" opacity="0.3"/>

                            <line x1="0" y1="0" x2="20" y2="0" stroke="#D4A574" stroke-width="0.5" opacity="0.3"/>

                        </pattern>

                    </defs>

                    <rect x="${screenX + 10}" y="${screenY + 10}" width="${screenWidth - 20}" height="${screenHeight - 20}" 

                          fill="url(#mesh-pattern-h)" opacity="0.5"/>

                    

                    <circle cx="${screenX + 60}" cy="${screenY - 5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>

                    <circle cx="${screenX + screenWidth - 60}" cy="${screenY - 5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>

                    

                    <rect x="${screenX + screenWidth/2 - 30}" y="${screenY + screenHeight - 8}" 

                          width="60" height="16" fill="var(--primary-light)" stroke="white" stroke-width="2" rx="8"/>

                `;

            } else {

                const halfHeight = screenHeight / 2 - 5;

                

                svgContent += `

                    <rect x="${screenX}" y="${screenY}" width="${screenWidth}" height="${halfHeight}" 

                          fill="none" stroke="var(--primary)" stroke-width="6" rx="8"/>

                    <rect x="${screenX + 10}" y="${screenY + 10}" width="${screenWidth - 20}" height="${halfHeight - 20}" 

                          fill="url(#mesh-pattern-h)" opacity="0.5"/>

                    

                    <rect x="${screenX}" y="${screenY + halfHeight + 10}" width="${screenWidth}" height="${halfHeight}" 

                          fill="none" stroke="var(--primary)" stroke-width="6" rx="8"/>

                    <rect x="${screenX + 10}" y="${screenY + halfHeight + 20}" width="${screenWidth - 20}" height="${halfHeight - 20}" 

                          fill="url(#mesh-pattern-h)" opacity="0.5"/>

                    

                    <rect x="${screenX}" y="${screenY + halfHeight}" width="${screenWidth}" height="10" 

                          fill="var(--primary)"/>

                    

                    <defs>

                        <pattern id="mesh-pattern-h" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">

                            <line x1="0" y1="0" x2="0" y2="20" stroke="#D4A574" stroke-width="0.5" opacity="0.3"/>

                            <line x1="0" y1="0" x2="20" y2="0" stroke="#D4A574" stroke-width="0.5" opacity="0.3"/>

                        </pattern>

                    </defs>

                    

                    <circle cx="${screenX + 60}" cy="${screenY - 5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>

                    <circle cx="${screenX + screenWidth - 60}" cy="${screenY - 5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>

                    <circle cx="${screenX + 60}" cy="${screenY + screenHeight + 5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>

                    <circle cx="${screenX + screenWidth - 60}" cy="${screenY + screenHeight + 5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>

                    

                    <rect x="${screenX + screenWidth/2 - 30}" y="${screenY + halfHeight - 5}" 

                          width="60" height="10" fill="var(--primary-light)" stroke="white" stroke-width="2" rx="5"/>

                    <rect x="${screenX + screenWidth/2 - 30}" y="${screenY + halfHeight + 5}" 

                          width="60" height="10" fill="var(--primary-light)" stroke="white" stroke-width="2" rx="5"/>

                `;

            }

            

            svgContent += `

                <line x1="${screenX}" y1="${screenY - 95}" x2="${screenX + screenWidth}" y2="${screenY - 95}" 

                      stroke="var(--primary)" stroke-width="4"/>

                <line x1="${screenX}" y1="${screenY - 100}" x2="${screenX}" y2="${screenY - 90}" 

                      stroke="var(--primary)" stroke-width="4"/>

                <line x1="${screenX + screenWidth}" y1="${screenY - 100}" x2="${screenX + screenWidth}" y2="${screenY - 90}" 

                      stroke="var(--primary)" stroke-width="4"/>

                      

                <text x="${screenX + screenWidth/2}" y="${screenY - 115}" fill="var(--primary)" font-size="16" font-weight="700" 

                      font-family="'Nanum Myeongjo', serif" text-anchor="middle">

                    총 길이: ${mmToInchFraction(height)}

                </text>

                <text x="${screenX + screenWidth/2}" y="${screenY - 100}" fill="var(--primary)" font-size="13" font-weight="600" 

                      font-family="'Noto Sans KR', sans-serif" text-anchor="middle">

                    (${Math.round(height)} mm)

                </text>

            `;

            

            if (positions.length > 0) {

                const firstX = screenX + (positions[0] * scale);

                svgContent += `

                    <line x1="${screenX}" y1="${screenY - 30}" x2="${firstX}" y2="${screenY - 30}" 

                          stroke="var(--primary-light)" stroke-width="2"/>

                    <line x1="${screenX}" y1="${screenY - 35}" x2="${screenX}" y2="${screenY - 25}" 

                          stroke="var(--primary-light)" stroke-width="2"/>

                    <line x1="${firstX}" y1="${screenY - 35}" x2="${firstX}" y2="${screenY - 25}" 

                          stroke="var(--primary-light)" stroke-width="2"/>

                    

                    <text x="${(screenX + firstX) / 2}" y="${screenY - 35}" fill="var(--primary-light)" font-size="11" font-weight="600" 

                          font-family="'Noto Sans KR', sans-serif" text-anchor="middle">

                        ${mmToInchFraction(30)}

                    </text>

                `;

            }

            

            positions.forEach((pos, index) => {

                const actualX = screenX + (pos * scale);

                const circleNumbers = '①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮';

                

                svgContent += `

                    <circle cx="${actualX}" cy="${screenY + screenHeight/2}" r="8" fill="#C84630" stroke="white" stroke-width="3" opacity="0.9"/>

                    

                    <line x1="${actualX}" y1="${screenY}" x2="${actualX}" y2="${screenY + screenHeight}" 

                          stroke="#D4A574" stroke-width="1" stroke-dasharray="5,5" opacity="0.4"/>

                    

                    <line x1="${screenX}" y1="${screenY + screenHeight + 15}" x2="${actualX}" y2="${screenY + screenHeight + 15}" 

                          stroke="#6B6B6B" stroke-width="1" stroke-dasharray="3,3"/>

                    <line x1="${actualX}" y1="${screenY + screenHeight + 10}" x2="${actualX}" y2="${screenY + screenHeight + 50}" 

                          stroke="var(--primary)" stroke-width="2"/>

                    

                    <polygon points="${screenX + 5},${screenY + screenHeight + 15} ${screenX + 10},${screenY + screenHeight + 12} ${screenX + 10},${screenY + screenHeight + 18}" 

                             fill="var(--primary)"/>

                    <polygon points="${actualX - 5},${screenY + screenHeight + 15} ${actualX - 10},${screenY + screenHeight + 12} ${actualX - 10},${screenY + screenHeight + 18}" 

                             fill="var(--primary)"/>

                    

                    <text x="${actualX}" y="${screenY + screenHeight + 65}" fill="var(--primary)" font-size="16" font-weight="700" font-family="'Nanum Myeongjo', serif" text-anchor="middle">

                        ${circleNumbers.charAt(index)}

                    </text>

                    <text x="${actualX}" y="${screenY + screenHeight + 85}" fill="#6B6B6B" font-size="12" font-weight="600" font-family="'Noto Sans KR', sans-serif" text-anchor="middle">

                        ${mmToInchFraction(pos)} (${Math.round(pos)} mm)

                    </text>

                `;

                

                if (index < positions.length - 1) {

                    const nextX = screenX + (positions[index + 1] * scale);

                    const midX = (actualX + nextX) / 2;

                    const spacing = positions[index + 1] - pos;

                    

                    svgContent += `

                        <line x1="${actualX}" y1="${screenY - 60}" x2="${nextX}" y2="${screenY - 60}" 

                              stroke="#C84630" stroke-width="2"/>

                        <line x1="${actualX}" y1="${screenY - 65}" x2="${actualX}" y2="${screenY - 55}" 

                              stroke="#C84630" stroke-width="2"/>

                        <line x1="${nextX}" y1="${screenY - 65}" x2="${nextX}" y2="${screenY - 55}" 

                              stroke="#C84630" stroke-width="2"/>

                        

                        <text x="${midX}" y="${screenY - 65}" fill="#C84630" font-size="11" font-weight="600" 

                              font-family="'Noto Sans KR', sans-serif" text-anchor="middle">

                            간격: ${mmToInchFraction(spacing)} (${Math.round(spacing)} mm)

                        </text>

                    `;

                }

            });

            

            // 마지막 구멍부터 끝까지의 거리 표시 (30mm)

            if (positions.length > 0) {

                const lastX = screenX + (positions[positions.length - 1] * scale);

                const endX = screenX + screenWidth;

                svgContent += `

                    <!-- 마지막 구멍부터 끝까지 거리 (위쪽) -->

                    <line x1="${lastX}" y1="${screenY - 30}" x2="${endX}" y2="${screenY - 30}" 

                          stroke="var(--primary-light)" stroke-width="2"/>

                    <line x1="${lastX}" y1="${screenY - 35}" x2="${lastX}" y2="${screenY - 25}" 

                          stroke="var(--primary-light)" stroke-width="2"/>

                    <line x1="${endX}" y1="${screenY - 35}" x2="${endX}" y2="${screenY - 25}" 

                          stroke="var(--primary-light)" stroke-width="2"/>

                    

                    <!-- 치수 -->

                    <text x="${(lastX + endX) / 2}" y="${screenY - 35}" fill="var(--primary-light)" font-size="11" font-weight="600" 

                          font-family="'Noto Sans KR', sans-serif" text-anchor="middle">

                        ${mmToInchFraction(30)}

                    </text>

                `;

            }

            

            svg.innerHTML = svgContent;

        }



        // 망구멍 갯수 계산 (원본 로직)

        function calculateHoleCount(mesh20) {

            if (mesh20 <= 1000) return 4;

            if (mesh20 <= 1400) return 4;

            if (mesh20 <= 1600) return 6;

            if (mesh20 <= 2200) return 6;

            if (mesh20 <= 2400) return 6;

            if (mesh20 <= 2600) return 8;

            if (mesh20 <= 2900) return 8;

            if (mesh20 < 3200) return 8;

            return 8;

        }



        // 망구멍 위치 계산

        function calculateHolePositions(holeCount, spacing) {

            const positions = [];

            let currentPos = 30; // 첫 번째 구멍은 30mm

            

            for (let i = 0; i < holeCount; i++) {

                positions.push(currentPos);

                currentPos += spacing;

            }

            

            return positions;

        }



        // 망구멍 정보 표시

        function displayHoleInfo(type, mesh20mm) {

            const holeCount = calculateHoleCount(mesh20mm);

            const effectiveHeight = mesh20mm - 60;

            const spacing = Math.round(effectiveHeight / (holeCount - 1));

            const positions = calculateHolePositions(holeCount, spacing);

            const circleNumbers = '①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮';

            // hole-count, hole-spacing, hole-positions 가 있으면 업데이트 (구버전 호환)
            const countEl = document.getElementById(`hole-count-${type}`);
            if (countEl) countEl.textContent = holeCount + '개';

            const spacingEl = document.getElementById(`hole-spacing-${type}`);
            if (spacingEl) {
                spacingEl.innerHTML = `<span class="result-primary">${mmToInchFraction(spacing)}</span><span class="result-secondary">(${spacing} mm)</span>`;
            }

            const positionsContainer = document.getElementById(`hole-positions-${type}`);
            if (positionsContainer) {
                positionsContainer.innerHTML = '';
                positions.forEach((pos, index) => {
                    const posItem = document.createElement('div');
                    posItem.style.cssText = 'background:white;padding:12px;border-radius:10px;border:2px solid var(--border);text-align:center;transition:all 0.3s ease;';
                    posItem.innerHTML = `<div style="font-weight:700;color:var(--primary);font-size:0.9em;margin-bottom:5px;">${circleNumbers.charAt(index)}</div><div style="font-weight:700;color:var(--primary);font-size:1.05em;">${mmToInchFraction(pos)} <span style="font-size:0.85em;color:var(--text-light);">(${Math.round(pos)} mm)</span></div>`;
                    posItem.addEventListener('mouseenter', function() { this.style.borderColor='var(--primary)'; this.style.transform='scale(1.05)'; });
                    posItem.addEventListener('mouseleave', function() { this.style.borderColor='var(--border)'; this.style.transform='scale(1)'; });
                    positionsContainer.appendChild(posItem);
                });
            }

            // hole-info-{type} div 에 직접 렌더링 (새 카드 UI용)
            const holeInfoEl = document.getElementById(`hole-info-${type}`);
            if (holeInfoEl) {
                let posHtml = positions.map((pos, i) =>
                    `<div style="background:white;padding:10px 6px;border-radius:10px;border:2px solid var(--border);text-align:center;">
                        <div style="font-weight:700;color:var(--primary);font-size:.85em;">${circleNumbers.charAt(i)}</div>
                        <div style="font-weight:700;color:var(--primary);">${mmToInchFraction(pos)}"</div>
                        <div style="font-size:.75em;color:#888;">(${Math.round(pos)} mm)</div>
                    </div>`
                ).join('');

                holeInfoEl.innerHTML = `
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;">
                        <div style="background:#F2F4F5;border-radius:10px;padding:12px;text-align:center;border:1px solid #D0D7DC;">
                            <div style="font-size:0.78em;color:#888;font-weight:600;margin-bottom:4px;">🔘 구멍 갯수</div>
                            <div style="font-size:1.8em;font-weight:900;color:var(--primary);">${holeCount}개</div>
                        </div>
                        <div style="background:#F2F4F5;border-radius:10px;padding:12px;text-align:center;border:1px solid #D0D7DC;">
                            <div style="font-size:0.78em;color:#888;font-weight:600;margin-bottom:4px;">📏 구멍 간격</div>
                            <div style="font-size:1.2em;font-weight:800;color:var(--primary);">${mmToInchFraction(spacing)}"</div>
                            <div style="font-size:0.75em;color:#888;">(${spacing} mm)</div>
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:8px;">${posHtml}</div>
                `;
            }

            // 다이어그램 그리기
            drawScreenDiagram(type, positions, mesh20mm);

        }



        // 계산 함수 (Single)

        function calculateSingle(width, height) {

            const results = {};

            

            // 알루미늄 프레임

            results.frameTop = width - 34;

            results.wallBar = height - 26;

            results.hingeBar = height - 42 + 2;   // Large Fix Rail

            results.smallFixRail = height - 42 + 2; // Small Fix Rail (동일 계산)

            results.handle = height - 101;          // Handle Bar (Male)

            

            // 망 / PVC / 실

            results.mesh20 = height - 38;

            results.pvc18 = height - 38;

            results.pvc29 = width - 40;

            

            // 실 계산 (mm 단위)

            results.string = (width + height + 120) * 2;

            

            // 실의 개수 계산 (망의 개수의 절반)

            const holeCount = calculateHoleCount(results.mesh20);

            results.stringCount = Math.round(holeCount / 2);

            

            // 면적 (SF) - 인치로 변환 필요

            const widthInch = width / 25.4;

            const heightInch = height / 25.4;

            results.area = (widthInch * heightInch / 144).toFixed(2);

            

            return results;

        }



        // 계산 함수 (Double)

        function calculateDouble(width, height) {

            const results = {};

            

            // 각 문짝의 가로 길이

            const halfWidth = (width - 20) / 2;

            

            // 알루미늄 프레임

            results.frameTop = width - 34;  // Double 상/하 프레임 = 전체 가로 - 34

            results.middleBar = height - 50;

            results.wallBar = height - 26;

            results.hingeBar = height - 42 + 2;     // Large Fix Rail

            results.smallFixRail = height - 42 + 2; // Small Fix Rail (동일 계산)

            results.handle = height - 101;           // Handle Bar (Male)

            results.handleFemale = height - 101;     // Handle Bar (Female) 동일 길이

            

            // 망 / PVC / 실

            results.mesh20 = height - 38;

            results.pvc18 = height - 38;

            results.pvc29 = halfWidth - 22;

            

            // 실 계산 (mm 단위)

            results.stringInner = width + height + 40;  // 내부실 길이 (전체 넓이 + 전체 높이 + 40)

            results.stringOuter = results.stringInner * 2;  // 외부실 길이 = 내부실의 2배

            

            // 실의 개수 계산 (Double)

            const holeCount = calculateHoleCount(results.mesh20);

            results.stringCountInner = holeCount - 2; // 내부실 = 망구멍 - 2

            results.stringCountOuter = 2; // 외부실 = 항상 2개

            

            // 면적 (SF) - 전체

            const totalWidthInch = width / 25.4;

            const heightInch = height / 25.4;

            results.area = (totalWidthInch * heightInch / 144).toFixed(2);

            

            return results;

        }



        // 메인 계산 함수

        window.calculate = function calculate(type) {

            let width = parseFloat(document.getElementById(`width-${type}`).value);

            let height = parseFloat(document.getElementById(`height-${type}`).value);

            

            if (!width || !height) return;

            

            // 인치를 mm로 변환

            if (units[type] === 'inch') {

                width = width * 25.4;

                height = height * 25.4;

            }

            

            // 치수 표시 (인치 분수 + mm) - 각 타입에 맞게 표시

            displayDimension(`width-display-${type}`, width);

            displayDimension(`height-display-${type}`, height);

            

            let results;

            

            if (type === 'single') {

                results = calculateSingle(width, height);

                

                // 결과 표시 (인치 분수 + mm)

                displayDualUnit('frame-top-single', results.frameTop);

                // Bottom Rail = Top Rail 동일 길이
                const frameBotS = document.getElementById('frame-bottom-single');
                if (frameBotS) frameBotS.innerHTML = document.getElementById('frame-top-single').innerHTML;

                displayDualUnit('wall-bar-single', results.wallBar);

                displayDualUnit('hinge-bar-single', results.hingeBar);

                // Small Fix Rail (same length as Large Fix Rail)
                const smallFixRailSingle = document.getElementById('small-fix-rail-single');
                if (smallFixRailSingle) {
                    const tempEl = document.createElement('div');
                    displayDualUnit('hinge-bar-single', results.hingeBar);
                    smallFixRailSingle.innerHTML = document.getElementById('hinge-bar-single').innerHTML;
                }

                displayDualUnit('handle-single', results.handle);

                displayDualUnit('mesh-20-single', results.mesh20);

                

                // 망접힘 갯수 계산 (가로넓이(mm) / 1000 * 36)

                const meshFoldCount = Math.round((width / 1000) * 36);

                const meshFoldElement = document.getElementById('mesh-fold-single');

                if (meshFoldElement) {

                    meshFoldElement.innerHTML = `<span style="font-size: 1.2em; font-weight: 600;">${meshFoldCount}개</span>`;

                }

                

                // Privacy Screen 두께 계산 (가로넓이(mm) / 10000 * 20)

                const privacyScreenCm = (width / 10000) * 20;

                const privacyScreenInch = privacyScreenCm / 2.54;

                const privacyScreenInchFraction = inchToFraction(privacyScreenInch);

                const privacyScreenElement = document.getElementById('privacy-screen-single');

                if (privacyScreenElement) {

                    privacyScreenElement.innerHTML = `

                        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 3px;">

                            <span style="font-size: 1.2em; font-weight: 600;">${privacyScreenInchFraction}"</span>

                            <span style="font-size: 0.9em; color: var(--text-light);">${privacyScreenCm.toFixed(2)} cm</span>

                        </div>

                    `;

                }

                

                displayDualUnit('pvc-18-single', results.pvc18);

                // PVC 29mm 미사용 (제거됨)

                

                // 실은 인치 분수로 표시 (피트와 인치 형식)

                const stringMm = results.string;

                const stringInches = stringMm / 25.4;

                const stringFeet = Math.floor(stringInches / 12);

                const stringRemainingInches = stringInches - (stringFeet * 12);

                const stringWholeInch = Math.floor(stringRemainingInches);

                const stringDecimal = stringRemainingInches - stringWholeInch;

                const stringSixteenths = Math.round(stringDecimal * 16);

                

                let stringDisplay = `${stringFeet}' ${stringWholeInch}"`;

                if (stringSixteenths > 0 && stringSixteenths < 16) {

                    // 분수 간소화

                    let num = stringSixteenths;

                    let den = 16;

                    const divisor = calculateGCD(num, den);

                    num /= divisor;

                    den /= divisor;

                    stringDisplay += ` ${num}/${den}`;

                } else if (stringSixteenths === 16) {

                    stringDisplay = `${stringFeet}' ${stringWholeInch + 1}"`;

                }

                

                const stringElement = document.getElementById('string-single');

                if (stringElement) {

                    stringElement.innerHTML = `

                        <span class="result-primary">${stringDisplay}</span>

                        <span class="result-secondary">(${Math.round(stringMm)} mm)</span>

                    `;

                }

                

                // 실의 개수 표시

                const stringCountElement = document.getElementById('string-count-single');

                if (stringCountElement) {

                    stringCountElement.innerHTML = `

                        <span class="result-primary">${results.stringCount}개</span>

                    `;

                }

                

                // 면적 표시 (SF와 SM)

                document.getElementById('area-display-single').textContent = results.area;

                document.getElementById('area-sm-display-single').textContent = (results.area * 0.092903).toFixed(2);

                

                // 망구멍 정보 표시

                displayHoleInfo('single', results.mesh20);

            } else {

                results = calculateDouble(width, height);

                

                // 결과 표시 (인치 분수 + mm)

                displayDualUnit('frame-top-double', results.frameTop);

                // Bottom Rail = Top Rail 동일 길이
                const frameBotD = document.getElementById('frame-bottom-double');
                if (frameBotD) frameBotD.innerHTML = document.getElementById('frame-top-double').innerHTML;

                displayDualUnit('wall-bar-double', results.wallBar);

                displayDualUnit('hinge-bar-double', results.hingeBar);

                displayDualUnit('handle-male-double', results.handle);

                // Handle Female - Male과 동일 길이
                const handleFemaleEl = document.getElementById('handle-female-double');
                if (handleFemaleEl) handleFemaleEl.innerHTML = document.getElementById('handle-male-double').innerHTML;

                displayDualUnit('mesh-20-double', results.mesh20);

                

                // 망접힘 갯수 계산 (Double: Single 계산의 1/2, 개수 2개)

                const meshFoldSingleCount = Math.round((width / 1000) * 36);
                const meshFoldCount = Math.round(meshFoldSingleCount / 2);

                const meshFoldElement = document.getElementById('mesh-fold-double');

                if (meshFoldElement) {

                    meshFoldElement.innerHTML = `<span style="font-size: 1.2em; font-weight: 600;">${meshFoldCount}개 × 2</span>`;

                }

                

                // Privacy Screen 두께 계산 (전체 가로(mm) / 10000 * 20)

                const privacyScreenCm = (width / 10000) * 20;

                const privacyScreenInch = privacyScreenCm / 2.54;

                const privacyScreenInchFraction = inchToFraction(privacyScreenInch);

                const privacyScreenElement = document.getElementById('privacy-screen-double');

                if (privacyScreenElement) {

                    privacyScreenElement.innerHTML = `

                        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 3px;">

                            <span style="font-size: 1.2em; font-weight: 600;">${privacyScreenInchFraction}"</span>

                            <span style="font-size: 0.9em; color: var(--text-light);">${privacyScreenCm.toFixed(2)} cm</span>

                        </div>

                    `;

                }

                

                displayDualUnit('pvc-18-double', results.pvc18);

                // PVC 29mm 미사용 (제거됨)

                

                // 내부실 길이 표시

                const stringInnerMm = results.stringInner;

                const stringInnerInches = stringInnerMm / 25.4;

                const stringInnerFeet = Math.floor(stringInnerInches / 12);

                const stringInnerRemainingInches = stringInnerInches - (stringInnerFeet * 12);

                const stringInnerWholeInch = Math.floor(stringInnerRemainingInches);

                const stringInnerDecimal = stringInnerRemainingInches - stringInnerWholeInch;

                const stringInnerSixteenths = Math.round(stringInnerDecimal * 16);

                

                let stringInnerDisplay = `${stringInnerFeet}' ${stringInnerWholeInch}"`;

                if (stringInnerSixteenths > 0 && stringInnerSixteenths < 16) {

                    // 분수 간소화

                    let num = stringInnerSixteenths;

                    let den = 16;

                    const divisor = calculateGCD(num, den);

                    num /= divisor;

                    den /= divisor;

                    stringInnerDisplay += ` ${num}/${den}`;

                } else if (stringInnerSixteenths === 16) {

                    stringInnerDisplay = `${stringInnerFeet}' ${stringInnerWholeInch + 1}"`;

                }

                

                const stringInnerElement = document.getElementById('string-inner-double');

                if (stringInnerElement) {

                    stringInnerElement.innerHTML = `

                        <span class="result-primary">${stringInnerDisplay}</span>

                        <span class="result-secondary">(${Math.round(stringInnerMm)} mm)</span>

                    `;

                }

                

                // 외부실 길이 표시

                const stringOuterMm = results.stringOuter;

                const stringOuterInches = stringOuterMm / 25.4;

                const stringOuterFeet = Math.floor(stringOuterInches / 12);

                const stringOuterRemainingInches = stringOuterInches - (stringOuterFeet * 12);

                const stringOuterWholeInch = Math.floor(stringOuterRemainingInches);

                const stringOuterDecimal = stringOuterRemainingInches - stringOuterWholeInch;

                const stringOuterSixteenths = Math.round(stringOuterDecimal * 16);

                

                let stringOuterDisplay = `${stringOuterFeet}' ${stringOuterWholeInch}"`;

                if (stringOuterSixteenths > 0 && stringOuterSixteenths < 16) {

                    // 분수 간소화

                    let num = stringOuterSixteenths;

                    let den = 16;

                    const divisor = calculateGCD(num, den);

                    num /= divisor;

                    den /= divisor;

                    stringOuterDisplay += ` ${num}/${den}`;

                } else if (stringOuterSixteenths === 16) {

                    stringOuterDisplay = `${stringOuterFeet}' ${stringOuterWholeInch + 1}"`;

                }

                

                const stringOuterElement = document.getElementById('string-outer-double');

                if (stringOuterElement) {

                    stringOuterElement.innerHTML = `

                        <span class="result-primary">${stringOuterDisplay}</span>

                        <span class="result-secondary">(${Math.round(stringOuterMm)} mm)</span>

                    `;

                }

                

                // 내부실 개수 표시

                const stringCountInnerElement = document.getElementById('string-count-inner-double');

                if (stringCountInnerElement) {

                    stringCountInnerElement.innerHTML = `

                        <span class="result-primary">${results.stringCountInner}개</span>

                    `;

                }

                

                // 외부실 개수 표시

                const stringCountOuterElement = document.getElementById('string-count-outer-double');

                if (stringCountOuterElement) {

                    stringCountOuterElement.innerHTML = `

                        <span class="result-primary">${results.stringCountOuter}개</span>

                    `;

                }

                

                // 면적 표시 (SF와 SM)

                document.getElementById('area-display-double').textContent = results.area;

                document.getElementById('area-sm-display-double').textContent = (results.area * 0.092903).toFixed(2);

                

                // 망구멍 정보 표시

                displayHoleInfo('double', results.mesh20);

            }

        }



        // 수동 저장 함수

        window.manualSaveCalculation = function manualSaveCalculation(type) {

            // ✅ 중복 저장 방지: 이미 저장 중이면 무시
            if (savingLock[type]) {
                console.log('⚠️ 이미 저장 중입니다. 중복 저장 방지됨.');
                return;
            }

            const widthInput = document.getElementById(`width-${type}`);

            const heightInput = document.getElementById(`height-${type}`);

            

            if (!widthInput.value || !heightInput.value) {

                alert('가로와 세로 크기를 먼저 입력하고 계산해주세요.');

                return;

            }

            // ✅ 고객정보 필수 항목 검증 (고객명, 주소, 전화번호 필수 / 이메일 선택)
            const customerVal = (document.getElementById(`customer-${type}`) || {}).value || '';
            const addressVal  = (document.getElementById(`address-${type}`)  || {}).value || '';
            const phoneVal    = (document.getElementById(`phone-${type}`)    || {}).value || '';

            const missing = [];
            if (!customerVal.trim()) missing.push('• 고객명 (Customer Name)');
            if (!addressVal.trim())  missing.push('• 주소 (Address)');
            if (!phoneVal.trim())    missing.push('• 전화번호 (Phone)');

            if (missing.length > 0) {
                alert('⚠️ 저장하려면 다음 고객정보를 입력해주세요:\n\n' + missing.join('\n') + '\n\n※ 이메일(Email)은 선택사항입니다.');
                return;
            }



            const width = parseFloat(widthInput.value);

            const height = parseFloat(heightInput.value);



            // 현재 단위 확인

            const currentUnit = document.querySelector(`#${type} .unit-btn.active`).textContent.includes('inch') ? 'inch' : 'mm';

            

            // 인치로 변환

            let widthInch = width;

            let heightInch = height;

            let widthMm = width;

            let heightMm = height;

            

            if (currentUnit === 'mm') {

                widthInch = width / 25.4;

                heightInch = height / 25.4;

            } else {

                widthMm = width * 25.4;

                heightMm = height * 25.4;

            }



            // 고객 정보 수집

            const customerInfo = {

                date: document.getElementById(`date-${type}`).value || '',

                customer: document.getElementById(`customer-${type}`).value || '',

                address: document.getElementById(`address-${type}`).value || '',

                location: getLocations(type)[0] || '',
                locations: getLocations(type),
                locationEntries: (locationEntries || []).filter(e => e.type === type),
                poNumber: currentPONumber || generatePONumber(),

                email: document.getElementById(`email-${type}`).value || '',

                phone: document.getElementById(`phone-${type}`).value || '',

                frameColor: document.getElementById(`frame-color-${type}`).value || '',

                meshColor: document.getElementById(`mesh-color-${type}`).value || ''

            };



            // 계산 실행

            const results = type === 'single' ? calculateSingle(widthMm, heightMm) : calculateDouble(widthMm, heightMm);

            // ✅ 잠금 설정 + 버튼 비활성화
            savingLock[type] = true;
            const saveBtn = document.querySelector(`button[onclick="manualSaveCalculation('${type}')"]`);
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.textContent = '⏳ 저장 중...';
                saveBtn.style.opacity = '0.6';
                saveBtn.style.cursor = 'not-allowed';
            }

            // 온라인 저장

            saveToGoogleSheets(type, widthInch, heightInch, customerInfo, results)

                .then(result => {

                    if (result.success) {

                        if (result.savedOnline) {
                            alert('✅ 온라인 + 로컬 이중 저장 완료!');
                        } else {
                            alert('💾 로컬 저장 완료!\n⚠️ 오프라인 상태 - 인터넷 연결 시 자동으로 온라인 동기화됩니다.');
                        }

                        // ✅ 버그 수정: loadAllCalculations() 대신 로컬 데이터로 캐시 직접 갱신
                        // loadAllCalculations()는 내부에서 syncLocalToOnline()을 또 호출해
                        // 무한루프 + 중복 저장을 유발함
                        const freshLocal = getLocalAll();
                        allCalculationsCache = mergeData([], freshLocal);
                        console.log('📊 저장 후 캐시 갱신:', allCalculationsCache.length + '개');

                    } else {

                        alert('❌ 저장에 실패했습니다: ' + (result.error || '알 수 없는 오류'));

                    }

                })

                .catch(error => {

                    alert('❌ 저장 중 오류가 발생했습니다: ' + error.message);

                    console.error('저장 실패:', error);

                })

                .finally(() => {
                    // ✅ 저장 완료 후 잠금 해제 + 버튼 복구
                    savingLock[type] = false;
                    if (saveBtn) {
                        saveBtn.disabled = false;
                        saveBtn.textContent = '💾 저장하기';
                        saveBtn.style.opacity = '1';
                        saveBtn.style.cursor = 'pointer';
                    }
                });

        }



        // 주문서 출력

        window.printOrder = function printOrder(type) {

            const customer = document.getElementById(`customer-${type}`).value;

            const date = document.getElementById(`date-${type}`).value;

            

            if (!customer) {

                alert('고객명을 입력해주세요.');

                return;

            }

            

            window.print();

        }



        // 폼 초기화

        window.resetForm = function resetForm(type) {

            document.getElementById(`date-${type}`).value = '';

            document.getElementById(`customer-${type}`).value = '';

            document.getElementById(`address-${type}`).value = '';

            initLocationList(type);

            document.getElementById(`email-${type}`).value = '';

            document.getElementById(`phone-${type}`).value = '';

            document.getElementById(`width-${type}`).value = '';

            document.getElementById(`height-${type}`).value = '';

            document.getElementById(`frame-color-${type}`).value = '';

            document.getElementById(`mesh-color-${type}`).value = '';

            

            // 결과 초기화

            document.querySelectorAll(`#${type} .result-value-dual`).forEach(el => {

                el.innerHTML = '<span class="result-primary">-</span>';

            });

            document.querySelectorAll(`#${type} .info-number`).forEach(el => {

                el.innerHTML = '<div style="font-size: 2.5em;">-</div>';

            });

            

            // 면적 초기화

            const widthDisplay = document.getElementById(`width-display-${type}`);

            const heightDisplay = document.getElementById(`height-display-${type}`);

            const areaDisplay = document.getElementById(`area-display-${type}`);

            const areaSmDisplay = document.getElementById(`area-sm-display-${type}`);

            

            if (widthDisplay) widthDisplay.innerHTML = '<div style="font-size: 2.5em;">-</div>';

            if (heightDisplay) heightDisplay.innerHTML = '<div style="font-size: 2.5em;">-</div>';

            if (areaDisplay) areaDisplay.textContent = '-';

            if (areaSmDisplay) areaSmDisplay.textContent = '-';

        }



        // 저장 내역 모달 열기

        window.showSavedCalculations = function showSavedCalculations() {

            // 온라인 데이터 새로고침

            loadOnlineCalculations()

                .then(() => {

                    const modal = document.getElementById('savedCalculationsModal');

                    

                    // 검색 및 필터 초기화

                    document.getElementById('searchInput').value = '';

                    document.getElementById('sortSelect').value = 'date-desc';

                    document.getElementById('typeFilter').value = 'all';

                    

                    filterCalculations();

                    modal.style.display = 'block';

                })

                .catch(error => {

                    console.error('저장 내역 불러오기 실패:', error);

                    alert('저장 내역을 불러올 수 없습니다.');

                });

        }



        // 필터링 및 정렬 함수

        window.filterCalculations = function filterCalculations() {

            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const sortOption = document.getElementById('sortSelect').value;

            const typeFilter = document.getElementById('typeFilter').value;

            const list = document.getElementById('savedCalculationsList');



            console.log('📊 전체 데이터 개수:', allCalculationsCache.length);

            if (allCalculationsCache.length > 0) {

                console.log('📋 첫 번째 데이터 샘플:', allCalculationsCache[0]);

            }



            if (allCalculationsCache.length === 0) {

                list.innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">저장된 계산 내역이 없습니다.</p>';

                return;

            }



            // 필터링

            let filtered = allCalculationsCache.filter(calc => {

                // 타입 필터

                if (typeFilter !== 'all' && calc.type !== typeFilter) {

                    return false;

                }



                // 검색어 필터

                if (searchTerm) {

                    const customer = (calc.customer || '').toLowerCase();

                    const address = (calc.address || '').toLowerCase();

                    const location = ((calc.locations || []).join(' ') || calc.location || '').toLowerCase();

                    const email = (calc.email || '').toLowerCase();

                    const phone = (calc.phone || '').toLowerCase();

                    

                    return customer.includes(searchTerm) || 

                           address.includes(searchTerm) || 

                           location.includes(searchTerm) ||

                           email.includes(searchTerm) || 

                           phone.includes(searchTerm);

                }

                

                return true;

            });



            // 정렬

            filtered.sort((a, b) => {

                switch(sortOption) {

                    case 'date-desc':

                        return new Date(b.timestamp) - new Date(a.timestamp);

                    case 'date-asc':

                        return new Date(a.timestamp) - new Date(b.timestamp);

                    case 'customer-asc':

                        return (a.customer || '').localeCompare(b.customer || '');

                    case 'customer-desc':

                        return (b.customer || '').localeCompare(a.customer || '');

                    case 'width-desc':

                        return (b.widthInch || 0) - (a.widthInch || 0);

                    case 'width-asc':

                        return (a.widthInch || 0) - (b.widthInch || 0);

                    default:

                        return 0;

                }

            });



            // 결과 표시

            if (filtered.length === 0) {

                list.innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">검색 결과가 없습니다.</p>';

            } else {

                list.innerHTML = filtered.map(calc => `

                    <div style="border: 1px solid var(--border,#D8D9DC); border-radius: 10px; padding: 12px; margin-bottom: 12px; background: #FAFAFA;">

                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">

                            <div style="flex: 1;">

                                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 5px;">

                                    <strong style="font-size: 16px; color: var(--primary);">

                                        ${calc.type === 'single' ? '📏 Single' : '📐 Double'}

                                    </strong>

                                    ${calc.customer ? `<span style="background: #e3f2fd; padding: 3px 10px; border-radius: 5px; font-size: 13px; color: #1976d2; font-weight:700;">👤 ${calc.customer}</span>` : '<span style="background:#fff3e0;padding:3px 10px;border-radius:5px;font-size:12px;color:#e65100;">⚠️ 고객명 없음</span>'}

                                    ${calc.poNumber ? `<span style="background:#F2F4F5;border:1.5px solid var(--primary);padding:3px 10px;border-radius:5px;font-size:12px;font-weight:800;color:var(--primary);font-family:monospace;">🔑 ${calc.poNumber}</span>` : ''}

                                </div>

                                <div style="color: #666; font-size: 13px;">

                                    📅 ${new Date(calc.timestamp).toLocaleString('ko-KR')}

                                </div>

                                ${calc.address ? `<div style="color: #555; font-size: 13px; margin-top: 3px;">📍 ${calc.address}</div>` : ''}
                                ${calc.phone ? `<div style="color: #555; font-size: 13px; margin-top: 2px;">📞 ${calc.phone}</div>` : ''}
                                ${calc.email ? `<div style="color: #555; font-size: 13px; margin-top: 2px;">✉️ ${calc.email}</div>` : ''}

                                ${(() => {
                                    const les = calc.locationEntries || [];
                                    if (les.length > 0) {
                                        // locationEntries 기준으로 순서대로 표시 (번호 정확)
                                        return les.map((le, i) => {
                                            const name = le.name || le.location || ('장소' + (i+1));
                                            const dim = (le.width && le.height)
                                                ? ` <span style="color:#5A6472;font-weight:700;">${le.width}×${le.height} ${le.unit||'in'}</span>` : '';
                                            const fc = le.frameColor ? ` [${le.frameColor}]` : '';
                                            const tp = le.type ? ` <span style="font-size:11px;color:#888;">(${le.type})</span>` : '';
                                            return `<div style="color:#555;font-size:12px;margin-top:2px;">🏠 ${i+1}. ${name}${dim}${fc}${tp}</div>`;
                                        }).join('');
                                    } else {
                                        // 구버전 호환: locs 배열 사용
                                        const locs = calc.locations && calc.locations.length > 0
                                            ? calc.locations : (calc.location ? [calc.location] : []);
                                        return locs.map((loc, i) =>
                                            `<div style="color:#555;font-size:12px;margin-top:2px;">🏠 ${i+1}. ${loc}</div>`
                                        ).join('');
                                    }
                                })()}

                            </div>

                            <button onclick="gasDelete('${calc.id}')" 

                                    style="background: #dc3545; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">

                                삭제

                            </button>

                        </div>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 14px; background: white; padding: 10px; border-radius: 8px;">

                            <div><strong>가로:</strong> ${(calc.widthInch || 0).toFixed(2)}"</div>

                            <div><strong>세로:</strong> ${(calc.heightInch || 0).toFixed(2)}"</div>

                            <div><strong>면적:</strong> ${calc.results?.area || '-'} SF</div>

                            <div><strong>프레임 색상:</strong> ${calc.frameColor || '-'}</div>

                            <div><strong>망 색상:</strong> ${calc.meshColor || '-'}</div>

                            <div><strong>날짜:</strong> ${calc.date || '-'}</div>

                        </div>

                        <button onclick="loadCalculation('${calc.id}')" 

                                style="margin-top: 10px; width: 100%; padding: 8px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer;">

                            📋 불러오기

                        </button>

                    </div>

                `).join('');

            }

        }



        // 저장 내역 모달 닫기

        window.closeSavedCalculationsModal = function closeSavedCalculationsModal() {

            document.getElementById('savedCalculationsModal').style.display = 'none';

        }



        // 저장된 계산 불러오기

        window.loadCalculation = function loadCalculation(id) {

            console.log('🔄 불러오기 시도 - ID:', id);

            console.log('📦 캐시 크기:', allCalculationsCache.length);

            

            // 캐시된 데이터 사용

            if (allCalculationsCache.length > 0) {

                const calc = allCalculationsCache.find(c => c.id === id);

                console.log('📋 찾은 데이터:', calc);

                

                if (calc) {

                    try {

                        // 탭 전환

                        const tabs = document.querySelectorAll('.tab');

                        const targetTab = calc.type === 'single' ? tabs[0] : tabs[1];

                        switchTab(calc.type, targetTab);

                        

                        // 약간의 지연 후 데이터 설정 (탭 전환 완료 대기)

                        setTimeout(() => {

                            // 인치 단위로 설정 (units 객체도 직접 업데이트 - 화면 수치 표시 버그 수정)
                            units[calc.type] = 'inch';

                            setUnit(calc.type, 'inch');

                            

                            // 입력값 설정

                            const widthValue = calc.widthInch || (calc.width ? calc.width / 25.4 : 0);

                            const heightValue = calc.heightInch || (calc.height ? calc.height / 25.4 : 0);

                            

                            document.getElementById(`width-${calc.type}`).value = widthValue.toFixed(2);

                            document.getElementById(`height-${calc.type}`).value = heightValue.toFixed(2);

                            

                        // 고객 정보 복원

                            if (calc.customer) document.getElementById(`customer-${calc.type}`).value = calc.customer;

                            if (calc.date) document.getElementById(`date-${calc.type}`).value = calc.date;

                            if (calc.address) document.getElementById(`address-${calc.type}`).value = calc.address;

                            // P.O. Number 복원
                            if (calc.poNumber) currentPONumber = calc.poNumber;

                            // ─── 설치장소 복원 (전체 엔트리 데이터 우선, 없으면 이름만) ───
                            if (calc.locationEntries && calc.locationEntries.length > 0) {
                                locationEntries = locationEntries.filter(e => e.type !== calc.type);
                                calc.locationEntries.forEach(le => {
                                    addLocationEntry({
                                        name: le.name || '',
                                        type: le.type || calc.type,
                                        width: le.width || '',
                                        height: le.height || '',
                                        frameColor: le.frameColor || '',
                                        meshColor: le.meshColor || '',
                                        privacyColor: le.privacyColor || '',
                                        unit: le.unit || 'inch'
                                    });
                                });
                            } else {
                                setLocations(calc.type,
                                    calc.locations || (calc.location ? [calc.location] : []),
                                    calc.locationEntries);
                            }

                            if (calc.email) document.getElementById(`email-${calc.type}`).value = calc.email;

                            if (calc.phone) document.getElementById(`phone-${calc.type}`).value = calc.phone;

                            if (calc.frameColor) document.getElementById(`frame-color-${calc.type}`).value = calc.frameColor;

                            if (calc.meshColor) document.getElementById(`mesh-color-${calc.type}`).value = calc.meshColor;

                            

                            // 계산 실행

                            calculate(calc.type);

                            

                            // 모달 닫기

                            closeSavedCalculationsModal();

                            

                            alert('✅ 계산 내역을 불러왔습니다.');

                        }, 150);

                        

                    } catch (error) {

                        console.error('❌ 데이터 복원 중 에러:', error);

                        alert('❌ 데이터 복원 중 오류가 발생했습니다: ' + error.message);

                    }

                } else {

                    alert('❌ 해당 ID의 데이터를 찾을 수 없습니다.');

                }

            } else {

                // 캐시가 없으면 DB에서 직접 가져오기

                getAllCalculations()

                    .then(calculations => {

                        allCalculationsCache = calculations;

                        const calc = calculations.find(c => c.id === id);

                        

                        if (calc) {

                            // 위와 동일한 처리

                            const tabs = document.querySelectorAll('.tab');

                            const targetTab = calc.type === 'single' ? tabs[0] : tabs[1];

                            switchTab(calc.type, targetTab);

                            

                            setTimeout(() => {

                                // 인치 단위로 설정 (units 객체도 직접 업데이트 - 화면 수치 표시 버그 수정)
                                units[calc.type] = 'inch';

                                setUnit(calc.type, 'inch');

                                

                                const widthValue = calc.widthInch || (calc.width ? calc.width / 25.4 : 0);

                                const heightValue = calc.heightInch || (calc.height ? calc.height / 25.4 : 0);

                                

                                document.getElementById(`width-${calc.type}`).value = widthValue.toFixed(2);

                                document.getElementById(`height-${calc.type}`).value = heightValue.toFixed(2);

                                

                                if (calc.customer) document.getElementById(`customer-${calc.type}`).value = calc.customer;

                                if (calc.date) document.getElementById(`date-${calc.type}`).value = calc.date;

                                if (calc.address) document.getElementById(`address-${calc.type}`).value = calc.address;

                                // P.O. Number 복원
                                if (calc.poNumber) currentPONumber = calc.poNumber;

                                // ─── 설치장소 복원 (전체 엔트리 데이터 우선) ───
                                if (calc.locationEntries && calc.locationEntries.length > 0) {
                                    locationEntries = locationEntries.filter(e => e.type !== calc.type);
                                    calc.locationEntries.forEach(le => {
                                        addLocationEntry({
                                            name: le.name || '',
                                            type: le.type || calc.type,
                                            width: le.width || '',
                                            height: le.height || '',
                                            frameColor: le.frameColor || '',
                                            meshColor: le.meshColor || '',
                                            privacyColor: le.privacyColor || '',
                                            unit: le.unit || 'inch'
                                        });
                                    });
                                } else {
                                    setLocations(calc.type,
                                        calc.locations || (calc.location ? [calc.location] : []),
                                        calc.locationEntries);
                                }

                                if (calc.email) document.getElementById(`email-${calc.type}`).value = calc.email;

                                if (calc.phone) document.getElementById(`phone-${calc.type}`).value = calc.phone;

                                if (calc.frameColor) document.getElementById(`frame-color-${calc.type}`).value = calc.frameColor;

                                if (calc.meshColor) document.getElementById(`mesh-color-${calc.type}`).value = calc.meshColor;

                                

                                calculate(calc.type);

                                closeSavedCalculationsModal();

                                alert('✅ 계산 내역을 불러왔습니다.');

                            }, 150);

                        } else {

                            alert('❌ 계산 내역을 찾을 수 없습니다.');

                        }

                    })

                    .catch(error => {

                        console.error('❌ 계산 불러오기 실패:', error);

                        alert('❌ 계산을 불러올 수 없습니다: ' + error.message);

                    });

            }

        }






        // ==================== 설치장소 엔트리 관리 ====================

        let locationEntries = [];   // [{id, name, type, width, height, frameColor, meshColor, unit}]
        let entryIdCounter = 0;

        // 공통 필드 double에도 동기화
        window.syncCommonField = function(fieldId) {
            const val = document.getElementById(fieldId)?.value || '';
            const doubleId = fieldId.replace('-single', '-double');
            const el = document.getElementById(doubleId);
            if (el) el.value = val;
        };

        // 날짜 동기화
        function syncDate() {
            const val = document.getElementById('date-single')?.value || '';
            const el = document.getElementById('date-double');
            if (el) el.value = val;
        }

        // 설치장소 엔트리 추가
        window.addLocationEntry = function(initData) {
            const id = ++entryIdCounter;
            const entry = initData || { id, name: '', type: 'single', width: '', height: '', frameColor: '', meshColor: '', privacyColor: '', unit: 'inch' };
            entry.id = id;
            // P.O. Number가 없으면 자동 생성
            if (!entry.poNumber) entry.poNumber = generatePONumber();
            locationEntries.push(entry);
            renderEntries();
            // 새 카드로 스크롤
            setTimeout(() => {
                const el = document.getElementById('entry-' + id);
                if (el) el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        };

        // 전체 초기화 (리셋)
        window.resetAllEntries = function() {
            if (!confirm('모든 설치장소와 입력 내용을 초기화하시겠습니까?')) return;
            locationEntries = [];
            entryIdCounter = 0;
            // 고객 기본 정보 초기화
            ['date-single','customer-single','address-single','email-single','phone-single'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            renderEntries();
        };

        // 설치장소 엔트리 삭제
        window.removeLocationEntry = function(id) {
            locationEntries = locationEntries.filter(e => e.id !== id);
            renderEntries();
        };

        // 도어 타입 선택
        window.setEntryType = function(id, type) {
            const entry = locationEntries.find(e => e.id === id);
            if (!entry) return;
            entry.type = type;
            calcEntry(id);
            renderEntries();
        };

        // 단위 선택
        // ── 인치 분수 입력 헬퍼 ──────────────────────────────────────────
        // "10 - 1/8"  "10-1/8"  "10 1/8"  "10.125"  "1/8"  "10"  → 소수 인치
        window.parseInchInput = function(str) {
            if (!str || str === '') return '';
            str = str.toString().trim();

            // 순수 소수 (예: 10.125)
            if (/^\d+(\.\d+)?$/.test(str)) return parseFloat(str);

            // 분수만 (예: 1/8)
            const fracOnly = str.match(/^(\d+)\/(\d+)$/);
            if (fracOnly) return parseInt(fracOnly[1]) / parseInt(fracOnly[2]);

            // 정수 + 분수 (구분자: " - " | "-" | " ")
            const mixed = str.match(/^(\d+)\s*[-–]\s*(\d+)\/(\d+)$/) ||
                          str.match(/^(\d+)\s+(\d+)\/(\d+)$/);
            if (mixed) return parseInt(mixed[1]) + parseInt(mixed[2]) / parseInt(mixed[3]);

            // 그 외: 앞 숫자만 추출
            const fallback = parseFloat(str);
            return isNaN(fallback) ? '' : fallback;
        };

        // 소수 인치 → "10 - 1/8" 형식 (1/16 단위 반올림)
        window.formatInchFraction = function(val) {
            if (val === '' || val === null || val === undefined) return '';
            const num = parseFloat(val);
            if (isNaN(num)) return '';
            const whole = Math.floor(num);
            const sixteenths = Math.round((num - whole) * 16);
            if (sixteenths === 0)  return whole === 0 ? '0' : String(whole);
            if (sixteenths === 16) return String(whole + 1);
            let n = sixteenths, d = 16;
            const g = (a, b) => b === 0 ? a : g(b, a % b);
            const gcd = g(n, d);
            n /= gcd; d /= gcd;
            return whole === 0 ? `${n}/${d}` : `${whole} - ${n}/${d}`;
        };

        // 입력창 blur 시 자동 포맷 (인치일 때)
        window.onDimBlur = function(id, field, inputEl) {
            const entry = locationEntries.find(e => e.id === id);
            if (!entry || entry.unit === 'mm') return;
            const parsed = parseInchInput(inputEl.value);
            if (parsed === '' || isNaN(parsed)) { inputEl.value = ''; return; }
            entry[field] = parsed;          // 소수로 저장
            inputEl.value = formatInchFraction(parsed); // 분수 형식으로 표시
            if (entry.width && entry.height) {
                calcEntry(id);
                setTimeout(() => updateEntryResultBox(id), 0);
            }
            setTimeout(() => updateSaveBtnState(id), 10);
            renderEntries();
        };

        // 입력 중(oninput): 소수값만 entry에 저장, 포맷은 blur에서 처리
        window.onDimInput = function(id, field, inputEl) {
            const entry = locationEntries.find(e => e.id === id);
            if (!entry) return;
            if (entry.unit === 'mm') {
                // mm 모드: 기존 방식 그대로
                const v = parseFloat(inputEl.value);
                entry[field] = isNaN(v) ? '' : v;
            } else {
                // inch 모드: 파싱 시도 (빈 값이면 빈 문자열)
                const parsed = parseInchInput(inputEl.value);
                entry[field] = (parsed === '' || isNaN(parsed)) ? '' : parsed;
            }
            if (entry.width && entry.height) {
                calcEntry(id);
                setTimeout(() => updateEntryResultBox(id), 0);
            }
            setTimeout(() => updateSaveBtnState(id), 10);
        };
        // ── 인치 분수 입력 헬퍼 끝 ──────────────────────────────────────

        window.setEntryUnit = function(id, unit) {
            const entry = locationEntries.find(e => e.id === id);
            if (!entry) return;
            entry.unit = unit;
            calcEntry(id);
            renderEntries();
        };

        // 필드 변경
        window.onEntryInput = function(id, field, value) {
            const entry = locationEntries.find(e => e.id === id);
            if (!entry) return;
            entry[field] = value;
            // width/height 둘 다 있을 때만 자동 계산 (면적 저장용)
            if (entry.width && entry.height) {
                calcEntry(id);
                setTimeout(() => updateEntryResultBox(id), 0);
            }
            // 데이터 변경 → 저장 버튼 상태 갱신 (변경됨 표시)
            setTimeout(() => updateSaveBtnState(id), 10);
        };

        // 엔트리 계산 실행 (기존 hidden 섹션 이용)
        function calcEntry(id) {
            const entry = locationEntries.find(e => e.id === id);
            if (!entry || !entry.width || !entry.height) return;

            const type = entry.type;
            // hidden 섹션에 값 주입
            units[type] = entry.unit;
            document.getElementById('width-' + type).value = entry.width;
            document.getElementById('height-' + type).value = entry.height;
            document.getElementById('frame-color-' + type).value = entry.frameColor || '';
            document.getElementById('mesh-color-' + type).value = entry.meshColor || '';
            // 현재 active 탭도 맞춰줌 (calculate 함수가 active tab 읽는 경우 대비)
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            const tab = document.querySelector(`.tab[onclick*="'${type}'"]`);
            if (tab) tab.classList.add('active');
            document.getElementById(type)?.classList.add('active');
            // 계산 실행
            calculate(type);

            // 계산 후 면적값을 entry에 저장 (견적서에서 사용)
            setTimeout(() => {
                const areaEl = document.getElementById('area-display-' + type);
                const wEl    = document.getElementById('width-display-'  + type);
                const hEl    = document.getElementById('height-display-' + type);
                if (areaEl && areaEl.textContent !== '-') {
                    entry.areaVal   = parseFloat(areaEl.textContent) || 0;
                    entry.widthDisp = wEl  ? wEl.textContent  : '-';
                    entry.heightDisp= hEl  ? hEl.textContent  : '-';
                }
            }, 0);
        }

        // 엔트리 결과 읽어서 DOM 업데이트
        function updateEntryResultBox(id) {
            // 면적값 entry 에 저장 (계산 후 호출)
            const entry = locationEntries.find(e => e.id === id);
            if (!entry || !entry.width || !entry.height) return;
            const type = entry.type;
            const areaEl = document.getElementById('area-display-' + type);
            const wEl    = document.getElementById('width-display-' + type);
            const hEl    = document.getElementById('height-display-' + type);
            if (areaEl && areaEl.textContent !== '-') {
                entry.areaVal    = parseFloat(areaEl.textContent) || 0;
                entry.widthDisp  = wEl ? wEl.textContent : '-';
                entry.heightDisp = hEl ? hEl.textContent : '-';
                entry._hasResult = true;
            }
            // 완료 뱃지 표시
            const box = document.getElementById('result-box-' + id);
            if (!box) return;
            box.style.display = 'block';
            box.innerHTML = '<div style="padding:10px 14px;background:linear-gradient(135deg,#EAEDEF,#F2F4F5);border:1px solid #D0D7DC;border-radius:10px;display:flex;align-items:center;justify-content:space-between;gap:10px;">'
                + '<div style="display:flex;align-items:center;gap:8px;">'
                + '<span style="font-size:1.1em;">✅</span>'
                + '<span style="font-size:.88em;font-weight:600;color:var(--primary);">계산 완료</span>'
                + '<span style="font-size:.82em;color:#888;">' + (entry.areaVal ? entry.areaVal.toFixed(2) + ' SF' : '') + '</span>'
                + '</div>'
                + '<button onclick="calcAndShow(' + id + ')" style="padding:5px 14px;background:var(--primary);color:white;border:none;border-radius:8px;font-size:.82em;font-weight:700;cursor:pointer;">결과 보기 →</button>'
                + '</div>';
        }

        function getResultText(elId) {
            const el = document.getElementById(elId);
            if (!el) return '-';
            return el.textContent.trim() || '-';
        }

        // 전체 엔트리 렌더링
        function renderEntries() {
            const container = document.getElementById('location-entries-container');
            const emptyMsg  = document.getElementById('location-empty-msg');
            const countEl   = document.getElementById('location-total-count');

            if (!container) return;
            countEl.textContent = locationEntries.length + '개';
            emptyMsg.style.display = locationEntries.length === 0 ? 'block' : 'none';

            // 현재 scroll positions 저장
            const scrollTop = window.scrollY;

            container.innerHTML = locationEntries.map((entry, idx) => {
                const typeLabel = entry.type === 'single' ? '📏 Single' : '📐 Double';
                const hasResult = entry.width && entry.height;

                // 프레임 색상에 따른 색상값
                const frameColorMap = { 'Black': '#222', 'White': '#f5f5f5', 'Silver': '#aaa', 'Custom': '#8B6914', '': '#5A6472' };
                const frameClr = frameColorMap[entry.frameColor] || '#5A6472';
                const frameStroke = entry.frameColor === 'White' ? '#ccc' : frameClr;

                // Privacy Screen 색상
                const privacyColorMap = { 'Yellow': '#F5E642', 'Light Gray': '#D0D0D0', 'White': '#F5F5F5', '': '#e8e8e8' };
                const privacyClr = privacyColorMap[entry.privacyColor] || '#e8e8e8';

                // SVG 도어 그림
                const doorSVG = entry.type === 'single' ? `
                  <svg viewBox="0 0 220 310" width="100%" style="max-width:220px;display:block;margin:0 auto;">
                    <!-- 외부 프레임 -->
                    <rect x="4" y="20" width="212" height="282" rx="4" ry="4"
                          fill="none" stroke="${frameStroke}" stroke-width="12"/>
                    <!-- Privacy screen (좌측 패널) -->
                    <rect x="10" y="26" width="36" height="270" fill="${privacyClr}" stroke="${frameStroke}" stroke-width="2"/>
                    <!-- 망 영역 -->
                    <rect x="46" y="26" width="160" height="270" fill="#d8d8d8"/>
                    <!-- 수직 세선들 (망 표현) -->
                    ${Array.from({length:14},(_,i)=>`<line x1="${50+i*11}" y1="26" x2="${50+i*11}" y2="296" stroke="#bbb" stroke-width="0.8"/>`).join('')}
                    <!-- 수평 구분선 3개 -->
                    <line x1="46" y1="116" x2="206" y2="116" stroke="#bbb" stroke-width="1.5"/>
                    <line x1="46" y1="206" x2="206" y2="206" stroke="#bbb" stroke-width="1.5"/>
                    <!-- 치수: 가로 (상단 - SVG 안) -->
                    <line x1="4" y1="8" x2="216" y2="8" stroke="#999" stroke-width="1"/>
                    <line x1="4" y1="4" x2="4" y2="12" stroke="#999" stroke-width="1"/>
                    <line x1="216" y1="4" x2="216" y2="12" stroke="#999" stroke-width="1"/>
                    <text x="110" y="5" text-anchor="middle" dominant-baseline="auto" font-size="11" fill="#333" font-weight="bold">${entry.width ? (entry.unit==='mm' ? entry.width+'mm' : formatInchFraction(entry.width)+'"') : 'W'}</text>
                    <!-- 치수: 세로 (우측 프레임 안 - 세로바 바로 옆) -->
                    <line x1="208" y1="20" x2="208" y2="302" stroke="#999" stroke-width="1"/>
                    <line x1="204" y1="20" x2="212" y2="20" stroke="#999" stroke-width="1"/>
                    <line x1="204" y1="302" x2="212" y2="302" stroke="#999" stroke-width="1"/>
                    <text x="218" y="161" text-anchor="middle" font-size="11" fill="#333" font-weight="bold" transform="rotate(90,218,161)">${entry.height ? (entry.unit==='mm' ? entry.height+'mm' : formatInchFraction(entry.height)+'"') : 'H'}</text>
                    <!-- 프레임 색상 라벨 -->
                    ${entry.frameColor ? `<rect x="46" y="284" width="80" height="14" rx="3" fill="${frameClr}" opacity="0.85"/><text x="86" y="295" text-anchor="middle" font-size="9" fill="${entry.frameColor==='White'?'#555':'white'}">${entry.frameColor}</text>` : ''}
                  </svg>
                ` : `
                  <svg viewBox="0 0 260 310" width="100%" style="max-width:260px;display:block;margin:0 auto;">
                    <!-- 외부 프레임 -->
                    <rect x="4" y="20" width="252" height="282" rx="4" ry="4"
                          fill="none" stroke="${frameStroke}" stroke-width="12"/>
                    <!-- Privacy screen (좌측 패널) -->
                    <rect x="10" y="26" width="30" height="270" fill="${privacyClr}" stroke="${frameStroke}" stroke-width="2"/>
                    <!-- 좌측 망 -->
                    <rect x="40" y="26" width="80" height="270" fill="#d8d8d8"/>
                    <!-- 우측 망 -->
                    <rect x="140" y="26" width="110" height="270" fill="#d8d8d8"/>
                    <!-- 중앙 분리대 -->
                    <rect x="120" y="20" width="20" height="282" fill="white" stroke="${frameStroke}" stroke-width="2"/>
                    <!-- 수직 세선들 - 좌 -->
                    ${Array.from({length:7},(_,i)=>`<line x1="${44+i*11}" y1="26" x2="${44+i*11}" y2="296" stroke="#bbb" stroke-width="0.8"/>`).join('')}
                    <!-- 수직 세선들 - 우 -->
                    ${Array.from({length:9},(_,i)=>`<line x1="${144+i*12}" y1="26" x2="${144+i*12}" y2="296" stroke="#bbb" stroke-width="0.8"/>`).join('')}
                    <!-- 수평 구분선 -->
                    <line x1="40" y1="116" x2="120" y2="116" stroke="#bbb" stroke-width="1.5"/>
                    <line x1="40" y1="206" x2="120" y2="206" stroke="#bbb" stroke-width="1.5"/>
                    <line x1="140" y1="116" x2="250" y2="116" stroke="#bbb" stroke-width="1.5"/>
                    <line x1="140" y1="206" x2="250" y2="206" stroke="#bbb" stroke-width="1.5"/>
                    <!-- 치수: 가로 (상단 - SVG 안) -->
                    <line x1="4" y1="8" x2="256" y2="8" stroke="#999" stroke-width="1"/>
                    <line x1="4" y1="4" x2="4" y2="12" stroke="#999" stroke-width="1"/>
                    <line x1="256" y1="4" x2="256" y2="12" stroke="#999" stroke-width="1"/>
                    <text x="130" y="5" text-anchor="middle" dominant-baseline="auto" font-size="11" fill="#333" font-weight="bold">${entry.width ? (entry.unit==='mm' ? entry.width+'mm' : formatInchFraction(entry.width)+'"') : 'W'}</text>
                    <!-- 치수: 세로 (우측 프레임 안 - 세로바 바로 옆) -->
                    <line x1="248" y1="20" x2="248" y2="302" stroke="#999" stroke-width="1"/>
                    <line x1="244" y1="20" x2="252" y2="20" stroke="#999" stroke-width="1"/>
                    <line x1="244" y1="302" x2="252" y2="302" stroke="#999" stroke-width="1"/>
                    <text x="258" y="161" text-anchor="middle" font-size="11" fill="#333" font-weight="bold" transform="rotate(90,258,161)">${entry.height ? (entry.unit==='mm' ? entry.height+'mm' : formatInchFraction(entry.height)+'"') : 'H'}</text>
                    <!-- 프레임 색상 라벨 -->
                    ${entry.frameColor ? `<rect x="85" y="284" width="80" height="14" rx="3" fill="${frameClr}" opacity="0.85"/><text x="125" y="295" text-anchor="middle" font-size="9" fill="${entry.frameColor==='White'?'#555':'white'}">${entry.frameColor}</text>` : ''}
                  </svg>
                `;

                return `
                <div class="location-entry-card" id="entry-${entry.id}">
                    <div class="location-entry-header">
                        <div class="location-entry-num">${idx + 1}</div>
                        <input type="text" value="${entry.name || ''}"
                               placeholder="설치장소 이름 (예: 거실, 안방...)"
                               oninput="onEntryInput(${entry.id}, 'name', this.value)"
                               onclick="event.stopPropagation()"
                               style="flex:1; background:transparent; border:none; color:white; font-size:1.05em; font-weight:700; outline:none; min-width:0; font-family:'Noto Sans KR',sans-serif;">
                        <span class="location-entry-badge">${typeLabel}</span>
                        <span style="background:rgba(255,255,255,0.15);border-radius:6px;padding:3px 10px;font-size:0.72em;font-weight:800;letter-spacing:0.5px;color:rgba(255,255,255,0.9);font-family:monospace;white-space:nowrap;">${entry.poNumber || ''}</span>
                        <button onclick="removeLocationEntry(${entry.id})" title="삭제"
                                style="background:rgba(255,255,255,0.15); border:none; color:white; width:28px; height:28px; border-radius:50%; cursor:pointer; font-size:1em; display:flex; align-items:center; justify-content:center; flex-shrink:0; transition:background 0.15s;"
                                onmouseover="this.style.background='rgba(220,50,50,0.5)'" onmouseout="this.style.background='rgba(255,255,255,0.15)'">×</button>
                    </div>
                    <div class="location-entry-body">
                        <!-- 도어 타입 선택 -->
                        <div class="door-type-select-row">
                            <button class="door-type-btn ${entry.type === 'single' ? 'active' : ''}"
                                    onclick="setEntryType(${entry.id}, 'single')">
                                📏 Single (외도어)
                            </button>
                            <button class="door-type-btn ${entry.type === 'double' ? 'active' : ''}"
                                    onclick="setEntryType(${entry.id}, 'double')">
                                📐 Double (양개형)
                            </button>
                        </div>
                        <!-- 도어 시각화 그림 + 치수 표시 -->
                        <div style="background:#f0f2f4; border-radius:12px; padding:20px 10px 12px; margin-bottom:16px; overflow:visible;">
                            <div style="display:flex; justify-content:center; align-items:center; gap:0;">
                                <!-- SVG + W 표시 묶음 -->
                                <div style="position:relative; display:inline-block;">
                                    ${doorSVG}
                                    <!-- 가로 치수 표시 (SVG 상단 중앙 - 읽기 전용) -->
                                    <div style="position:absolute; top:2px; left:50%; transform:translateX(-50%); display:flex; align-items:center; gap:3px; z-index:10; pointer-events:none;">
                                        <span style="min-width:52px; padding:2px 6px; border:1.5px solid #5A6472; border-radius:5px; font-size:0.82em; font-weight:800; text-align:center; background:rgba(255,255,255,0.95); color:#333; display:inline-block; font-family:'Noto Sans KR',monospace;">${entry.width ? (entry.unit==='mm' ? entry.width : formatInchFraction(entry.width)) : 'W'}</span>
                                        <span style="font-size:0.75em; color:#555; font-weight:600;">${entry.unit !== 'mm' ? '"' : 'mm'}</span>
                                    </div>
                                </div>
                                <!-- 세로 치수 표시 (SVG 바로 오른쪽 - 읽기 전용) -->
                                <div style="display:flex; flex-direction:column; align-items:center; gap:2px; margin-left:4px; flex-shrink:0; pointer-events:none;">
                                    <span style="min-width:40px; padding:2px 4px; border:1.5px solid #5A6472; border-radius:5px; font-size:0.82em; font-weight:800; text-align:center; background:rgba(255,255,255,0.92); color:#333; display:inline-block; font-family:'Noto Sans KR',monospace;">${entry.height ? (entry.unit==='mm' ? entry.height : formatInchFraction(entry.height)) : 'H'}</span>
                                    <span style="font-size:0.7em; color:#555; font-weight:600;">${entry.unit !== 'mm' ? '"' : 'mm'}</span>
                                </div>
                            </div>
                        </div>
                        <!-- 단위 선택 -->
                        <div class="unit-toggle" style="margin-bottom:16px;">
                            <button class="unit-btn ${entry.unit !== 'mm' ? 'active' : ''}"
                                    onclick="setEntryUnit(${entry.id}, 'inch')">인치 (inch)</button>
                            <button class="unit-btn ${entry.unit === 'mm' ? 'active' : ''}"
                                    onclick="setEntryUnit(${entry.id}, 'mm')">밀리미터 (mm)</button>
                        </div>
                        <!-- 크기 + 프레임 색상 입력 -->
                        <div class="input-grid">
                            <div class="input-group">
                                <label>가로 (W)</label>
                                ${entry.unit !== 'mm' ? `
                                <input type="text" inputmode="decimal"
                                       value="${entry.width ? formatInchFraction(entry.width) : ''}"
                                       placeholder='예: 10 - 1/8'
                                       style="font-family:'Noto Sans KR',monospace;"
                                       oninput="onDimInput(${entry.id}, 'width', this)"
                                       onblur="onDimBlur(${entry.id}, 'width', this)">
                                ` : `
                                <input type="number" value="${entry.width || ''}" placeholder="가로 입력 (mm)"
                                       oninput="onEntryInput(${entry.id}, 'width', this.value)">
                                `}
                            </div>
                            <div class="input-group">
                                <label>세로 (H)</label>
                                ${entry.unit !== 'mm' ? `
                                <input type="text" inputmode="decimal"
                                       value="${entry.height ? formatInchFraction(entry.height) : ''}"
                                       placeholder='예: 10 - 1/8'
                                       style="font-family:'Noto Sans KR',monospace;"
                                       oninput="onDimInput(${entry.id}, 'height', this)"
                                       onblur="onDimBlur(${entry.id}, 'height', this)">
                                ` : `
                                <input type="number" value="${entry.height || ''}" placeholder="세로 입력 (mm)"
                                       oninput="onEntryInput(${entry.id}, 'height', this.value)">
                                `}
                            </div>
                            <div class="input-group">
                                <label>프레임 색상</label>
                                <select oninput="onEntryInput(${entry.id}, 'frameColor', this.value)">
                                    <option value="" ${!entry.frameColor ? 'selected' : ''}>선택하세요</option>
                                    <option value="Black" ${entry.frameColor==='Black' ? 'selected' : ''}>Black</option>
                                    <option value="White" ${entry.frameColor==='White' ? 'selected' : ''}>White</option>
                                    <option value="Silver" ${entry.frameColor==='Silver' ? 'selected' : ''}>Silver</option>
                                    <option value="Custom" ${entry.frameColor==='Custom' ? 'selected' : ''}>Custom Color</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>🔒 Privacy Screen Color</label>
                                <select oninput="onEntryInput(${entry.id}, 'privacyColor', this.value)">
                                    <option value="" ${!entry.privacyColor ? 'selected' : ''}>선택하세요</option>
                                    <option value="Yellow" ${entry.privacyColor==='Yellow' ? 'selected' : ''}>Yellow</option>
                                    <option value="Light Gray" ${entry.privacyColor==='Light Gray' ? 'selected' : ''}>Light Gray</option>
                                    <option value="White" ${entry.privacyColor==='White' ? 'selected' : ''}>White</option>
                                </select>
                            </div>
                        </div>
                        <!-- 계산 버튼 -->
                        <div style="display:flex; gap:10px; margin-top:16px;">
                            <button onclick="calcAndShow(${entry.id})"
                                    style="flex:1; padding:13px; background:linear-gradient(135deg,#5A6472,#4A5260); color:white; border:none; border-radius:10px; font-size:0.95em; font-weight:700; cursor:pointer; box-shadow:0 3px 10px rgba(90,100,114,0.25);">
                                📊 계산하기
                            </button>
                            <button id="save-btn-${entry.id}" onclick="saveEntryCalculation(${entry.id})"
                                    style="flex:1; padding:13px; background:linear-gradient(135deg,#1976D2,#1565C0); color:white; border:none; border-radius:10px; font-size:0.95em; font-weight:700; cursor:pointer; box-shadow:0 3px 10px rgba(25,118,210,0.3);">
                                💾 저장하기
                            </button>
                        </div>
                        <!-- 결과 박스 -->
                        <div class="entry-result-box" id="result-box-${entry.id}" style="display:${hasResult ? 'block' : 'none'};">
                            ${hasResult ? '' : ''}
                        </div>
                    </div>
                </div>`;
            }).join('');

            // 결과 복원
            locationEntries.forEach(entry => {
                if (entry.width && entry.height && entry._results) {
                    updateEntryResultBox(entry.id);
                }
                // 저장 버튼 상태 복원
                updateSaveBtnState(entry.id);
            });

            window.scrollTo(0, scrollTop);
        }

        // ==================== 계산 결과 팝업 ====================

        // crmTab: 이전 버전 호환용 (탭 제거됨, 빈 함수 유지)
        window.crmTab = function(t) {};

        // 인쇄 함수
        window.crmPrint = function() {
            const area = document.getElementById('crm-print-area');
            if (!area) return;
            const pw = window.open('', '_blank', 'width=850,height=1100');
            const html = area.innerHTML;
            pw.document.write(`<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<title>제작 지시서</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;900&family=Nanum+Myeongjo:wght@700;800&display=swap" rel="stylesheet">
<style>
:root{--primary:#5A6472;--primary-light:#7A8494;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Noto Sans KR',sans-serif;background:white;color:#1a1a1a;font-size:8.5px;line-height:1.3;}
@page{size:letter portrait;margin:6mm 7mm 6mm 7mm;}
#crm-screen-btns{display:none!important;}

/* ── 주문 정보 헤더 ── */
div[style*="background:linear-gradient(135deg,#5A6472"]{
  padding:7px 10px!important;border-radius:7px!important;margin-bottom:7px!important;}
div[style*="background:linear-gradient(135deg,#5A6472"] #crm-title{font-size:0.95em!important;}
div[style*="background:linear-gradient(135deg,#5A6472"] #crm-order-info{
  grid-template-columns:repeat(7,1fr)!important;gap:4px!important;}
div[style*="background:rgba(255,255,255,0.12)"]{padding:3px 6px!important;border-radius:4px!important;}
div[style*="background:rgba(255,255,255,0.12)"] > div:first-child{font-size:0.6em!important;margin-bottom:0px!important;}
div[style*="background:rgba(255,255,255,0.12)"] > div:last-child{font-size:0.75em!important;}

/* ── 치수 요약 ── */
div[style*="grid-template-columns:repeat(4,1fr)"]{gap:4px!important;margin-bottom:6px!important;}
div[style*="grid-template-columns:repeat(4,1fr)"] > div{padding:4px 6px!important;border-radius:5px!important;}
div[style*="grid-template-columns:repeat(4,1fr)"] > div > div:first-child{font-size:0.65em!important;margin-bottom:0!important;}
div[style*="grid-template-columns:repeat(4,1fr)"] > div > div:last-child{font-size:0.9em!important;}

/* ── 계산결과+부속가이드 2단 ── */
div[style*="grid-template-columns:280px 1fr"]{grid-template-columns:1fr!important;gap:5px!important;margin-bottom:7px!important;}
/* ── 계산결과 박스들 ── */
.results-grid,div[id="crm-grid"]{display:grid!important;grid-template-columns:1fr!important;gap:3px!important;}
div[style*="background:#F5F6F7;border:1px solid #D0D7DC"]{padding:4px 6px!important;border-radius:5px!important;}
div[style*="background:#F5F6F7;border:1px solid #D0D7DC"] > div:first-child{font-size:0.65em!important;}
div[style*="background:#F5F6F7;border:1px solid #D0D7DC"] > div:last-child{font-size:0.8em!important;}
.result-primary{font-size:0.82em!important;}
.result-secondary{font-size:0.68em!important;}

/* ── 망구멍 정보 카드 ── */
div[style*="background:#F2F4F5;border-radius:8px;padding:10px"]{padding:4px 6px!important;border-radius:5px!important;}
div[style*="font-size:1.6em;font-weight:900"]{font-size:1.2em!important;}
div[style*="font-size:0.72em;color:#888;margin-bottom:3px"]{font-size:0.65em!important;margin-bottom:1px!important;}

/* ── 망구멍 위치표 ── */
#crm-hpos{grid-template-columns:repeat(auto-fill,minmax(52px,1fr))!important;gap:3px!important;}
#crm-hpos > div{padding:3px 2px!important;}
#crm-hpos .hole-pos-num{font-size:0.75em!important;}
#crm-hpos .hole-pos-val{font-size:0.7em!important;}

/* ── 도면 영역 ── */
div[style*="background:#F5F6F7"]{padding:6px!important;margin-bottom:6px!important;}
#crm-svg{min-width:unset!important;width:100%!important;max-height:130px!important;}

/* ── 부속 가이드 (Parts Guide) ── */
div[style*="minmax(160px"]{
  display:grid!important;
  grid-template-columns:repeat(8,1fr)!important;
  gap:4px!important;
  margin-bottom:0!important;}
div[style*="minmax(160px"] > div{padding:4px 2px!important;}
div[style*="minmax(160px"] > div > div:first-child{font-size:0.65em!important;font-weight:700!important;margin-bottom:1px!important;}
div[style*="minmax(160px"] > div svg{width:36px!important;height:36px!important;display:block!important;margin:0 auto 1px!important;}
div[style*="minmax(160px"] > div > div:nth-child(3){font-size:0.6em!important;color:#555!important;}
div[style*="minmax(160px"] > div > div:last-child{font-size:0.72em!important;font-weight:700!important;}

/* ── 섹션 제목 (부속 가이드 제목) ── */
div[style*="font-size:1.1em;font-weight:800"]{font-size:0.85em!important;padding-bottom:3px!important;margin-bottom:5px!important;}

/* ── 전체 레이아웃 마진 줄임 ── */
#crm-print-area{padding:8px!important;}
div[style*="margin-bottom:20px"]{margin-bottom:7px!important;}
div[style*="margin-bottom:16px"]{margin-bottom:5px!important;}
div[style*="margin-bottom:10px"]{margin-bottom:4px!important;}
div[style*="padding:30px"]{padding:8px!important;}
</style>
</head><body>${html}
<script>
  // SVG 인라인 재렌더 방지 위해 바로 인쇄
  window.onload = function(){ window.print(); };
<\/script>
</body></html>`);
            pw.document.close();
        };

        // 팝업 전용 도면 그리기
        function crmDrawDiagram(type, positions, heightMm) {
            const svg = document.getElementById('crm-svg');
            if (!svg) return;
            const W=1200,H=400,pad=80,sH=180,sW=1000;
            const sX=pad+60, sY=(H-sH)/2;
            const scale = sW / heightMm;
            let s = '';
            s += `<defs><pattern id="crm-mp" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
                    <line x1="0" y1="0" x2="0" y2="20" stroke="#D4A574" stroke-width="0.5" opacity="0.3"/>
                    <line x1="0" y1="0" x2="20" y2="0" stroke="#D4A574" stroke-width="0.5" opacity="0.3"/>
                  </pattern></defs>`;
            if (type === 'single') {
                s += `<rect x="${sX}" y="${sY}" width="${sW}" height="${sH}" fill="none" stroke="var(--primary)" stroke-width="6" rx="8"/>
                      <rect x="${sX+10}" y="${sY+10}" width="${sW-20}" height="${sH-20}" fill="url(#crm-mp)" opacity="0.5"/>
                      <circle cx="${sX+60}" cy="${sY-5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>
                      <circle cx="${sX+sW-60}" cy="${sY-5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>
                      <rect x="${sX+sW/2-30}" y="${sY+sH-8}" width="60" height="16" fill="var(--primary-light)" stroke="white" stroke-width="2" rx="8"/>`;
            } else {
                const hH = sH/2-5;
                s += `<rect x="${sX}" y="${sY}" width="${sW}" height="${hH}" fill="none" stroke="var(--primary)" stroke-width="6" rx="8"/>
                      <rect x="${sX+10}" y="${sY+10}" width="${sW-20}" height="${hH-20}" fill="url(#crm-mp)" opacity="0.5"/>
                      <rect x="${sX}" y="${sY+hH+10}" width="${sW}" height="${hH}" fill="none" stroke="var(--primary)" stroke-width="6" rx="8"/>
                      <rect x="${sX+10}" y="${sY+hH+20}" width="${sW-20}" height="${hH-20}" fill="url(#crm-mp)" opacity="0.5"/>
                      <rect x="${sX}" y="${sY+hH}" width="${sW}" height="10" fill="var(--primary)"/>
                      <circle cx="${sX+60}" cy="${sY-5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>
                      <circle cx="${sX+sW-60}" cy="${sY-5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>
                      <circle cx="${sX+60}" cy="${sY+sH+5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>
                      <circle cx="${sX+sW-60}" cy="${sY+sH+5}" r="8" fill="#C84630" stroke="white" stroke-width="2"/>`;
            }
            // 치수선
            s += `<line x1="${sX}" y1="${sY-95}" x2="${sX+sW}" y2="${sY-95}" stroke="var(--primary)" stroke-width="4"/>
                  <line x1="${sX}" y1="${sY-100}" x2="${sX}" y2="${sY-90}" stroke="var(--primary)" stroke-width="4"/>
                  <line x1="${sX+sW}" y1="${sY-100}" x2="${sX+sW}" y2="${sY-90}" stroke="var(--primary)" stroke-width="4"/>
                  <text x="${sX+sW/2}" y="${sY-112}" fill="var(--primary)" font-size="16" font-weight="700"
                        font-family="Nanum Myeongjo,serif" text-anchor="middle">총 길이: ${mmToInchFraction(heightMm)}</text>
                  <text x="${sX+sW/2}" y="${sY-97}" fill="var(--primary)" font-size="13"
                        font-family="Noto Sans KR,sans-serif" text-anchor="middle">(${Math.round(heightMm)} mm)</text>`;
            // 구멍 마커
            positions.forEach((pos, i) => {
                const cx = sX + pos * scale;
                s += `<circle cx="${cx}" cy="${sY+sH/2}" r="11" fill="white" stroke="#C84630" stroke-width="3"/>
                      <text x="${cx}" y="${sY+sH/2+4}" fill="#C84630" font-size="10" font-weight="700"
                            font-family="Noto Sans KR,sans-serif" text-anchor="middle">${i+1}</text>
                      <line x1="${cx}" y1="${sY+8}" x2="${cx}" y2="${sY+sH-8}" stroke="#C84630"
                            stroke-width="1.5" stroke-dasharray="4,3" opacity="0.4"/>`;
                if (i > 0) {
                    const px = sX + positions[i-1] * scale;
                    const mx = (px + cx) / 2;
                    const sp = pos - positions[i-1];
                    s += `<line x1="${px}" y1="${sY-52}" x2="${cx}" y2="${sY-52}" stroke="#C84630" stroke-width="2"/>
                          <line x1="${px}" y1="${sY-57}" x2="${px}" y2="${sY-47}" stroke="#C84630" stroke-width="2"/>
                          <line x1="${cx}" y1="${sY-57}" x2="${cx}" y2="${sY-47}" stroke="#C84630" stroke-width="2"/>
                          <text x="${mx}" y="${sY-55}" fill="#C84630" font-size="10" font-weight="600"
                                font-family="Noto Sans KR,sans-serif" text-anchor="middle">${mmToInchFraction(sp)}</text>`;
                }
            });
            svg.innerHTML = s;
        }

        // 망구멍 패널 채우기
        function crmFillHole(type, mesh20mm) {
            const holeCount = calculateHoleCount(mesh20mm);
            const spacing   = Math.round((mesh20mm - 60) / (holeCount - 1));
            const positions = calculateHolePositions(holeCount, spacing);
            document.getElementById('crm-hcnt').textContent = holeCount + '개';
            document.getElementById('crm-hspacing').innerHTML =
                mmToInchFraction(spacing) + '"<span style="font-size:.75em;color:#888;display:block;">(' + spacing + ' mm)</span>';
            const posEl = document.getElementById('crm-hpos');
            posEl.innerHTML = '';
            const nums = '①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮';
            positions.forEach((pos, i) => {
                const d = document.createElement('div');
                d.style.cssText = 'background:white;padding:10px 6px;border-radius:10px;border:2px solid var(--border);text-align:center;';
                d.innerHTML = '<div style="font-weight:700;color:var(--primary);font-size:.85em;">' + nums[i] + '</div>'
                    + '<div style="font-weight:700;color:var(--primary);">' + mmToInchFraction(pos) + '"</div>'
                    + '<div style="font-size:.75em;color:#888;">(' + Math.round(pos) + ' mm)</div>';
                posEl.appendChild(d);
            });
            crmDrawDiagram(type, positions, mesh20mm);
        }

        // 부속 가이드 패널 채우기 - 직접 HTML 생성
        function makePartsCard(svgContent, title, desc, qty, borderColor) {
            borderColor = borderColor || 'var(--primary)';
            return `<div style="padding:14px;border:2px solid ${borderColor};border-radius:12px;text-align:center;background:#f9faf9;">
                <svg viewBox="0 0 100 100" style="width:70px;height:70px;margin-bottom:8px;">${svgContent}</svg>
                <div style="font-weight:bold;color:${borderColor};margin-bottom:4px;font-size:.9em;">${title}</div>
                <div style="font-size:0.82em;color:#666;margin-bottom:6px;">${desc}</div>
                <div style="font-weight:bold;color:#D4851C;">${qty}</div>
            </div>`;
        }

        function crmFillParts(type) {
            const partsEl = document.getElementById('crm-parts');
            if (!partsEl) return;

            // 계산 결과값 가져오기 헬퍼
            const getVal = (id) => {
                const el = document.getElementById(id);
                if (!el) return '-';
                const t = el.textContent.trim();
                return t && t !== '-' ? t : '-';
            };

            // 공통 SVG 정의
            const svgRailH   = '<rect x="5" y="35" width="90" height="30" fill="var(--primary)" rx="3"/>';
            const svgRailHB  = '<rect x="5" y="35" width="90" height="30" fill="#1565C0" rx="3"/>';
            const svgRailV   = '<rect x="35" y="5" width="30" height="90" fill="var(--primary)" rx="3"/>';
            const svgRailVB  = '<rect x="35" y="5" width="30" height="90" fill="#1565C0" rx="3"/>';
            const svgLargeFix3 = (c) => `<rect x="35" y="5" width="30" height="90" fill="${c}" rx="3"/><circle cx="50" cy="20" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/><circle cx="50" cy="50" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/><circle cx="50" cy="80" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/>`;
            const svgSmallFix2 = (c) => `<rect x="35" y="5" width="30" height="90" fill="${c}" rx="3"/><circle cx="50" cy="30" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/><circle cx="50" cy="70" r="5" fill="#C84630" stroke="white" stroke-width="1.5"/>`;
            const svgMesh    = '<rect x="10" y="10" width="80" height="80" fill="none" stroke="#8B7355" stroke-width="3"/><line x1="25" y1="10" x2="25" y2="90" stroke="#8B7355" stroke-width="1"/><line x1="40" y1="10" x2="40" y2="90" stroke="#8B7355" stroke-width="1"/><line x1="55" y1="10" x2="55" y2="90" stroke="#8B7355" stroke-width="1"/><line x1="70" y1="10" x2="70" y2="90" stroke="#8B7355" stroke-width="1"/><line x1="10" y1="25" x2="90" y2="25" stroke="#8B7355" stroke-width="1"/><line x1="10" y1="40" x2="90" y2="40" stroke="#8B7355" stroke-width="1"/><line x1="10" y1="55" x2="90" y2="55" stroke="#8B7355" stroke-width="1"/><line x1="10" y1="70" x2="90" y2="70" stroke="#8B7355" stroke-width="1"/>';
            const svgPvc18   = '<rect x="25" y="35" width="50" height="30" fill="#BDC3C7" rx="3"/><rect x="27" y="37" width="46" height="26" fill="#ECF0F1" rx="2"/><text x="50" y="55" fill="#7f8c8d" font-size="9" text-anchor="middle" font-weight="bold">18mm</text>';
            const svgCorner  = '<rect x="28" y="28" width="44" height="8" fill="#6B6B6B" rx="2"/><rect x="28" y="28" width="8" height="44" fill="#6B6B6B" rx="2"/><circle cx="32" cy="32" r="3" fill="#C84630"/><circle cx="62" cy="32" r="3" fill="#C84630"/><circle cx="32" cy="62" r="3" fill="#C84630"/>';
            const svgBracket = '<rect x="32" y="15" width="36" height="70" fill="#6B6B6B" rx="3"/><circle cx="50" cy="30" r="4" fill="white"/><circle cx="50" cy="50" r="4" fill="white"/><circle cx="50" cy="70" r="4" fill="white"/><rect x="20" y="35" width="12" height="8" fill="#4A4A4A" rx="1"/><rect x="68" y="35" width="12" height="8" fill="#4A4A4A" rx="1"/>';
            const svgRoller  = '<circle cx="50" cy="50" r="22" fill="#4A5568" stroke="#2D3748" stroke-width="2"/><circle cx="50" cy="50" r="14" fill="#718096"/><circle cx="50" cy="50" r="6" fill="#2D3748"/><line x1="50" y1="28" x2="50" y2="18" stroke="#C84630" stroke-width="2.5"/><line x1="50" y1="72" x2="50" y2="82" stroke="#C84630" stroke-width="2.5"/>';
            const svgEndCap  = '<rect x="30" y="35" width="40" height="30" fill="#8B9EB7" rx="4"/><rect x="20" y="38" width="10" height="24" fill="#6B7E97" rx="2"/><line x1="35" y1="42" x2="65" y2="42" stroke="#6B7E97" stroke-width="1.5"/><line x1="35" y1="50" x2="65" y2="50" stroke="#6B7E97" stroke-width="1.5"/><line x1="35" y1="58" x2="65" y2="58" stroke="#6B7E97" stroke-width="1.5"/>';

            const grid = `<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:16px;">`;

            let html = '';
            if (type === 'single') {
                html = grid
                    // Top Rail - 상단 1개
                    + makePartsCard(svgRailH + '<text x="50" y="28" fill="var(--primary)" font-size="9" text-anchor="middle" font-weight="bold">Top Rail</text>', 'Top Rail Bar', '상단 프레임', `× 1개 | ${getVal('frame-top-single')}`)
                    // Bottom Rail - 하단 1개 (같은 치수)
                    + makePartsCard(svgRailH + '<text x="50" y="90" fill="var(--primary)" font-size="9" text-anchor="middle" font-weight="bold">Bottom Rail</text>', 'Bottom Rail Bar', '하단 프레임', `× 1개 | ${getVal('frame-top-single')}`)
                    + makePartsCard(svgRailV + '<text x="50" y="55" fill="white" font-size="10" text-anchor="middle" font-weight="bold">32mm</text>', 'Sidewall Vertical Rail Bar', '벽면 수직바', `× 2개 | ${getVal('wall-bar-single')}`)
                    + makePartsCard(svgLargeFix3('var(--primary)'), 'Large Fix Rail', '큰 경첩바 (3홀)', `× 1개 | ${getVal('hinge-bar-single')}`)
                    + makePartsCard(svgSmallFix2('var(--primary)'), 'Small Fix Rail', '작은 경첩바 (2홀)', `× 1개 | ${getVal('small-fix-rail-single')}`)
                    + makePartsCard('<rect x="40" y="30" width="20" height="40" fill="var(--primary-light)" rx="6" stroke="white" stroke-width="1.5"/><rect x="30" y="45" width="40" height="10" fill="var(--primary)" rx="3"/><circle cx="50" cy="25" r="6" fill="#D4A574"/>', 'Handle Bar (Male)', '핸들 바 (수)', `× 1개 | ${getVal('handle-single')}`, 'var(--primary-light)')
                    + makePartsCard(svgMesh, 'Mesh 20 + 접힘', `방충망 원단 | 접힘: ${getVal('mesh-fold-single')}`, `× 1개 | ${getVal('mesh-20-single')}`, '#8B7355')
                    + makePartsCard(svgPvc18, 'PVC 18mm', 'PVC 스프링 (내부)', `× 1개 | ${getVal('pvc-18-single')}`, '#95A5A6')
                    + makePartsCard('<path d="M20,50 Q50,20 80,50 Q50,80 20,50" fill="none" stroke="#E74C3C" stroke-width="4"/><circle cx="20" cy="50" r="4" fill="#E74C3C"/><circle cx="80" cy="50" r="4" fill="#E74C3C"/>', 'String (Inside)', '스프링 고정 실', `${getVal('string-single')} | ${getVal('string-count-single')}`, '#E74C3C')
                    // 추가 부속
                    + makePartsCard(svgCorner, 'Corner Connector', '코너 연결 부품', '× 4ea', '#6B6B6B')
                    + makePartsCard(svgBracket, 'Mounting Bracket', '설치 브라켓', '× 8ea', '#555')
                    + makePartsCard(svgRoller, 'Roller Assembly', '롤러 어셈블리', '× 2 set', '#4A5568')
                    + makePartsCard(svgEndCap, 'End Cap', '엔드 캡', '× 4ea', '#8B9EB7')
                    + makePartsCard('<ellipse cx="50" cy="50" rx="20" ry="28" fill="#C0392B" stroke="#922B21" stroke-width="2"/><ellipse cx="50" cy="50" rx="12" ry="18" fill="#E74C3C"/><text x="50" y="38" fill="white" font-size="8" text-anchor="middle" font-weight="bold">N</text><text x="50" y="66" fill="white" font-size="8" text-anchor="middle" font-weight="bold">S</text><text x="50" y="90" fill="#C0392B" font-size="8" text-anchor="middle" font-weight="bold">L</text>', 'Magnet (L)', '자석 (대)', '× 2ea', '#C0392B')
                    + makePartsCard('<ellipse cx="50" cy="50" rx="16" ry="22" fill="#C0392B" stroke="#922B21" stroke-width="2"/><ellipse cx="50" cy="50" rx="9" ry="14" fill="#E74C3C"/><text x="50" y="40" fill="white" font-size="8" text-anchor="middle" font-weight="bold">N</text><text x="50" y="63" fill="white" font-size="8" text-anchor="middle" font-weight="bold">S</text><text x="50" y="88" fill="#C0392B" font-size="8" text-anchor="middle" font-weight="bold">M</text>', 'Magnet (M)', '자석 (중)', '× 2ea', '#C0392B')
                    + makePartsCard('<rect x="38" y="20" width="24" height="60" fill="#7F8C8D" rx="12"/><circle cx="50" cy="35" r="6" fill="#BDC3C7"/><circle cx="50" cy="35" r="3" fill="#5D6D7E"/><rect x="44" y="52" width="12" height="20" fill="#5D6D7E" rx="2"/>', 'Plug', '플러그', '× 12ea', '#7F8C8D')
                    + makePartsCard('<rect x="25" y="30" width="50" height="40" fill="#2980B9" rx="5" stroke="#1A5276" stroke-width="2"/><rect x="35" y="38" width="30" height="8" fill="#AED6F1" rx="2"/><rect x="35" y="50" width="30" height="8" fill="#AED6F1" rx="2"/><line x1="50" y1="70" x2="50" y2="82" stroke="#1A5276" stroke-width="2"/><circle cx="50" cy="85" r="3" fill="#1A5276"/>', 'Tension Controller (L)', '텐션 컨트롤러 (대)', '× 2ea', '#2980B9')
                    + '</div>';
            } else {
                html = grid
                    // Top Rail - 상단 1개
                    + makePartsCard(svgRailHB + '<text x="50" y="28" fill="#1565C0" font-size="9" text-anchor="middle" font-weight="bold">Top Rail</text>', 'Top Rail Bar', '상단 프레임', `× 1개 | ${getVal('frame-top-double')}`, '#1565C0')
                    // Bottom Rail - 하단 1개 (같은 치수)
                    + makePartsCard(svgRailHB + '<text x="50" y="90" fill="#1565C0" font-size="9" text-anchor="middle" font-weight="bold">Bottom Rail</text>', 'Bottom Rail Bar', '하단 프레임', `× 1개 | ${getVal('frame-top-double')}`, '#1565C0')
                    + makePartsCard(svgRailVB + '<text x="50" y="55" fill="white" font-size="10" text-anchor="middle" font-weight="bold">32mm</text>', 'Sidewall Vertical Rail Bar', '벽면 수직바', `× 2개 | ${getVal('wall-bar-double')}`, '#1565C0')
                    + makePartsCard(svgLargeFix3('#1565C0'), 'Large Fix Rail', '큰 경첩바 (3홀)', `× 2개 | ${getVal('hinge-bar-double')}`, '#1565C0')
                    + makePartsCard('<rect x="40" y="30" width="20" height="40" fill="#1976D2" rx="6" stroke="white" stroke-width="1.5"/><rect x="30" y="45" width="40" height="10" fill="#1565C0" rx="3"/><circle cx="50" cy="25" r="6" fill="#D4A574"/>', 'Handle Bar (Male)', '핸들 바 (수)', `× 1개 | ${getVal('handle-male-double')}`, '#1976D2')
                    + makePartsCard('<rect x="40" y="30" width="20" height="40" fill="#1976D2" rx="6" stroke="white" stroke-width="1.5"/><rect x="30" y="45" width="40" height="10" fill="#1565C0" rx="3"/><circle cx="50" cy="75" r="6" fill="#D4A574"/>', 'Handle Bar (Female)', '핸들 바 (암)', `× 1개 | ${getVal('handle-female-double')}`, '#1976D2')
                    + makePartsCard(svgMesh, 'Mesh 20 + 접힘', `방충망 원단 | 접힘: ${getVal('mesh-fold-double')}`, `× 2개 | ${getVal('mesh-20-double')}`, '#8B7355')
                    + makePartsCard(svgPvc18, 'PVC 18mm', 'PVC 스프링 (내부)', `× 2개 | ${getVal('pvc-18-double')}`, '#95A5A6')
                    + makePartsCard('<path d="M20,50 Q50,20 80,50 Q50,80 20,50" fill="none" stroke="#E74C3C" stroke-width="4"/><circle cx="20" cy="50" r="4" fill="#E74C3C"/><circle cx="80" cy="50" r="4" fill="#E74C3C"/>', 'String (Inside)', '내부 스프링 실', `${getVal('string-inner-double')} | ${getVal('string-count-inner-double')}`, '#E74C3C')
                    + makePartsCard('<path d="M15,50 Q50,15 85,50 Q50,85 15,50" fill="none" stroke="#8E44AD" stroke-width="4"/><circle cx="15" cy="50" r="4" fill="#8E44AD"/><circle cx="85" cy="50" r="4" fill="#8E44AD"/>', 'String (Outside)', '외부 스프링 실', `${getVal('string-outer-double')} | ${getVal('string-count-outer-double')}`, '#8E44AD')
                    // 추가 부속
                    + makePartsCard(svgCorner, 'Corner Connector', '코너 연결 부품', '× 4ea', '#6B6B6B')
                    + makePartsCard(svgBracket, 'Mounting Bracket', '설치 브라켓', '× 8ea', '#555')
                    + makePartsCard(svgRoller, 'Roller Assembly', '롤러 어셈블리', '× 4 set', '#4A5568')
                    + makePartsCard(svgEndCap, 'End Cap', '엔드 캡', '× 4ea', '#8B9EB7')
                    + makePartsCard('<ellipse cx="50" cy="50" rx="20" ry="28" fill="#C0392B" stroke="#922B21" stroke-width="2"/><ellipse cx="50" cy="50" rx="12" ry="18" fill="#E74C3C"/><text x="50" y="38" fill="white" font-size="8" text-anchor="middle" font-weight="bold">N</text><text x="50" y="66" fill="white" font-size="8" text-anchor="middle" font-weight="bold">S</text><text x="50" y="90" fill="#C0392B" font-size="8" text-anchor="middle" font-weight="bold">L</text>', 'Magnet (L)', '자석 (대)', '× 2ea', '#C0392B')
                    + makePartsCard('<ellipse cx="50" cy="50" rx="12" ry="17" fill="#C0392B" stroke="#922B21" stroke-width="2"/><ellipse cx="50" cy="50" rx="7" ry="11" fill="#E74C3C"/><text x="50" y="41" fill="white" font-size="7" text-anchor="middle" font-weight="bold">N</text><text x="50" y="61" fill="white" font-size="7" text-anchor="middle" font-weight="bold">S</text><text x="50" y="88" fill="#C0392B" font-size="8" text-anchor="middle" font-weight="bold">S</text>', 'Magnet (S)', '자석 (소)', '× 2ea', '#C0392B')
                    + makePartsCard('<rect x="38" y="20" width="24" height="60" fill="#7F8C8D" rx="12"/><circle cx="50" cy="35" r="6" fill="#BDC3C7"/><circle cx="50" cy="35" r="3" fill="#5D6D7E"/><rect x="44" y="52" width="12" height="20" fill="#5D6D7E" rx="2"/>', 'Plug', '플러그', '× 24ea', '#7F8C8D')
                    + makePartsCard('<rect x="30" y="33" width="40" height="34" fill="#27AE60" rx="5" stroke="#1E8449" stroke-width="2"/><rect x="38" y="40" width="24" height="7" fill="#A9DFBF" rx="2"/><rect x="38" y="52" width="24" height="7" fill="#A9DFBF" rx="2"/><line x1="50" y1="67" x2="50" y2="78" stroke="#1E8449" stroke-width="2"/><circle cx="50" cy="81" r="3" fill="#1E8449"/>', 'Tension Controller (S)', '텐션 컨트롤러 (소)', '× 12ea', '#27AE60')
                    + '</div>';
            }
            partsEl.innerHTML = html;
        }

        // 메인: 계산 결과 팝업 열기
        window.calcAndShow = function(id) {
            const entry = locationEntries.find(e => e.id === id);
            if (!entry) return;

            // 1. 계산 실행 (hidden DOM에 결과 써넣음)
            calcEntry(id);

            // 2. DOM 업데이트 완료 후 팝업 채우기
            setTimeout(() => {
                const type = entry.type;
                const g = id => document.getElementById(id);
                const txt = id => { const e = g(id); return e ? e.textContent.trim() || '-' : '-'; };

                // 헤더 제목
                const place = entry.name || '이름 없음';
                g('crm-title').textContent = '📊 ' + place;
                g('crm-subtitle').textContent = (type==='single'?'📏 Single':'📐 Double')
                    + '  |  ' + (entry.width||'-') + ' × ' + (entry.height||'-') + ' ' + (entry.unit||'inch');
                const badge = g('crm-badge');
                if (type==='single') {
                    badge.textContent='📏 Single';
                    badge.style.cssText='padding:4px 14px;border-radius:20px;font-size:.82em;font-weight:700;background:rgba(255,255,255,0.2);color:white;border:1px solid rgba(255,255,255,0.4);';
                } else {
                    badge.textContent='📐 Double';
                    badge.style.cssText='padding:4px 14px;border-radius:20px;font-size:.82em;font-weight:700;background:rgba(100,180,255,0.25);color:#90caf9;border:1px solid rgba(100,180,255,0.4);';
                }

                // ── 주문 정보 채우기 ──
                const customer = document.getElementById('customer-single')?.value || '-';
                const date     = document.getElementById('date-single')?.value     || '-';
                const address  = document.getElementById('address-single')?.value  || '-';
                const phone    = document.getElementById('phone-single')?.value    || '-';
                const fc = entry.frameColor || '-';
                const mc = entry.meshColor  || '-';
                const pc = entry.privacyColor || '-';
                const setOI = (id, val) => { const el = g(id); if (el) el.textContent = val; };
                setOI('crm-oi-po',       entry.poNumber || '-');
                setOI('crm-oi-customer', customer);
                setOI('crm-oi-date',     date);
                setOI('crm-oi-address',  address);
                setOI('crm-oi-phone',    phone);
                setOI('crm-oi-location', place);
                setOI('crm-oi-color',    fc + ' / ' + mc + (pc !== '-' ? ' / PS: ' + pc : ''));

                // 치수 요약
                const wt=txt('width-display-'+type), ht=txt('height-display-'+type);
                const sf=txt('area-display-'+type),  sm=txt('area-sm-display-'+type);
                g('crm-w').textContent = wt;
                g('crm-h').textContent = ht;
                g('crm-sf').textContent = sf + ' SF';
                g('crm-sm').textContent = sm + ' SM';

                // entry에 면적 저장
                if (sf !== '-') { entry.areaVal = parseFloat(sf) || 0; entry._hasResult = true; }
                entry.widthDisp  = wt;
                entry.heightDisp = ht;

                // 결과 그리드
                const grid = g('crm-grid');
                grid.innerHTML = '';
                let items = [];
                if (type === 'single') {
                    items = [
                        ['Top Rail Bar (× 1개)','frame-top-single'],
                        ['Bottom Rail Bar (× 1개)','frame-top-single'],
                        ['Sidewall Vertical Rail Bar (× 2개)','wall-bar-single'],
                        ['Large Fix Rail (× 1개)','hinge-bar-single'],
                        ['Small Fix Rail (× 1개)','small-fix-rail-single'],
                        ['Handle Bar Male (× 1개)','handle-single'],
                        ['Mesh 20메쉬 (× 1개)','mesh-20-single'],
                        ['망 접힘 갯수 (× 1개)','mesh-fold-single'],
                        ['Privacy Screen (× 1개)','privacy-screen-single'],
                        ['PVC 18mm (× 1개)','pvc-18-single'],
                        ['String (Inside)','string-single'],
                        ['String 개수','string-count-single'],
                    ];
                } else {
                    items = [
                        ['Top Rail Bar (× 1개)','frame-top-double'],
                        ['Bottom Rail Bar (× 1개)','frame-top-double'],
                        ['Sidewall Vertical Rail Bar (× 2개)','wall-bar-double'],
                        ['Large Fix Rail (× 2개)','hinge-bar-double'],
                        ['Handle Bar Male (× 1개)','handle-male-double'],
                        ['Handle Bar Female (× 1개)','handle-female-double'],
                        ['Mesh 20메쉬 (× 2개)','mesh-20-double'],
                        ['망 접힘 갯수 (× 2개)','mesh-fold-double'],
                        ['Privacy Screen (× 1개)','privacy-screen-double'],
                        ['PVC 18mm (× 2개)','pvc-18-double'],
                        ['String (Inside) 길이','string-inner-double'],
                        ['String (Outside) 길이','string-outer-double'],
                        ['String (Inside) 개수','string-count-inner-double'],
                        ['String (Outside) 개수','string-count-outer-double'],
                    ];
                }
                items.forEach(([label, srcId]) => {
                    const srcEl = g(srcId);
                    if (!srcEl) return;
                    const valText = srcEl.textContent.trim();
                    if (!valText || valText === '-') return;
                    const div = document.createElement('div');
                    div.style.cssText = 'background:#F5F6F7;border:1px solid #D0D7DC;border-radius:10px;padding:10px 12px;display:flex;flex-direction:column;gap:4px;';
                    div.innerHTML = '<div style="font-size:0.73em;font-weight:700;color:#888;letter-spacing:0.3px;text-transform:uppercase;">' + label + '</div>'
                                  + '<div style="font-size:0.95em;font-weight:800;color:var(--primary);">' + srcEl.innerHTML + '</div>';
                    grid.appendChild(div);
                });

                // 망구멍 패널
                const mesh20El = g('mesh-20-' + type);
                if (mesh20El) {
                    const m = mesh20El.textContent.match(/\((\d+)\s*mm\)/);
                    const mesh20mm = m ? parseInt(m[1]) : (() => {
                        let w = parseFloat(entry.width)||0, h = parseFloat(entry.height)||0;
                        if (entry.unit !== 'mm') { w*=25.4; h*=25.4; }
                        return type==='single' ? h-38 : h-40;
                    })();
                    crmFillHole(type, mesh20mm);
                }

                // 부속 가이드
                crmFillParts(type);

                // 팝업 표시
                g('calcResultModal').style.display = 'block';
                g('calcResultModal').scrollTop = 0;
            }, 20);
        };

        // ==================== 계산 결과 팝업 끝 ====================

        // 엔트리별 저장 잠금 상태 관리
        const entrySaveLock = {};   // { entryId: true/false }
        const entrySavedData = {};  // { entryId: {width,height,frameColor,meshColor,type} } — 마지막 저장 데이터
        const entryRecordId = {};   // { entryId: googleSheets/local record id } — 같은 장소 업데이트용

        // 저장 버튼 UI 갱신
        function updateSaveBtnState(entryId) {
            const btn = document.getElementById('save-btn-' + entryId);
            if (!btn) return;
            const entry = locationEntries.find(e => e.id === entryId);
            if (!entry) return;

            if (entrySaveLock[entryId]) {
                btn.disabled = true;
                btn.innerHTML = '⏳ 저장 중...';
                btn.style.background = 'linear-gradient(135deg,#9E9E9E,#757575)';
                btn.style.cursor = 'not-allowed';
                btn.style.opacity = '0.7';
                return;
            }

            const saved = entrySavedData[entryId];
            const isDirty = !saved
                || saved.width !== entry.width
                || saved.height !== entry.height
                || saved.frameColor !== entry.frameColor
                || saved.meshColor !== entry.meshColor
                || saved.privacyColor !== (entry.privacyColor || '')
                || saved.type !== entry.type
                || saved.name !== entry.name;

            if (!isDirty && saved) {
                // 저장 완료 상태 — 변경 없음
                btn.disabled = true;
                btn.innerHTML = '✅ 저장됨';
                btn.style.background = 'linear-gradient(135deg,#6B7685,#4A5260)';
                btn.style.cursor = 'not-allowed';
                btn.style.opacity = '0.75';
            } else {
                // 저장 가능 상태 (신규 or 변경됨)
                btn.disabled = false;
                btn.innerHTML = saved ? '🔄 수정 저장' : '💾 저장하기';
                btn.style.background = saved
                    ? 'linear-gradient(135deg,#6B7685,#5A6472)'
                    : 'linear-gradient(135deg,#5A6472,#4A5260)';
                btn.style.cursor = 'pointer';
                btn.style.opacity = '1';
            }
        }

        // 저장하기 — 신규/수정 통합
        window.saveEntryCalculation = function(id) {
            const entry = locationEntries.find(e => e.id === id);
            if (!entry) return;
            if (!entry.width || !entry.height) { alert('가로/세로를 입력해주세요.'); return; }
            if (entrySaveLock[id]) return;

            // 날짜 + 고객정보 동기화
            syncDate();
            ['customer','address','email','phone'].forEach(f => {
                const val = document.getElementById(f + '-single')?.value || '';
                const el = document.getElementById(f + '-' + entry.type);
                if (el) el.value = val;
            });
            const locEl = document.getElementById('location-' + entry.type);
            if (locEl) locEl.value = entry.name || '';

            // hidden 섹션에 값 주입
            calcEntry(id);

            // 잠금
            entrySaveLock[id] = true;
            updateSaveBtnState(id);

            const type = entry.type;
            const currentUnit = entry.unit || 'inch';
            const width  = parseFloat(entry.width);
            const height = parseFloat(entry.height);
            let widthInch = width, heightInch = height;
            let widthMm = width, heightMm = height;
            if (currentUnit === 'mm') { widthInch = width/25.4; heightInch = height/25.4; }
            else { widthMm = width*25.4; heightMm = height*25.4; }

            const customerInfo = {
                poNumber:   entry.poNumber || generatePONumber(),
                date:       document.getElementById('date-'    + type)?.value || '',
                customer:   document.getElementById('customer-'+ type)?.value || '',
                address:    document.getElementById('address-' + type)?.value || '',
                location:   entry.name || '',
                locations:  getLocations(type),
                locationEntries: locationEntries.map(e => ({   // ← 전체 엔트리 데이터 저장
                    name: e.name, type: e.type,
                    width: e.width, height: e.height,
                    frameColor: e.frameColor, meshColor: e.meshColor,
                    privacyColor: e.privacyColor || '',
                    unit: e.unit,
                    poNumber: e.poNumber || ''
                })),
                email:      document.getElementById('email-'   + type)?.value || '',
                phone:      document.getElementById('phone-'   + type)?.value || '',
                frameColor: entry.frameColor || '',
                meshColor:  entry.meshColor  || '',
                privacyColor: entry.privacyColor || ''
            };
            const results = type === 'single'
                ? calculateSingle(widthMm, heightMm)
                : calculateDouble(widthMm, heightMm);

            // 기존 레코드 ID가 있으면 업데이트, 없으면 신규 저장
            const existingId = entryRecordId[id];

            saveToGoogleSheetsWithUpdate(type, widthInch, heightInch, customerInfo, results, existingId)
                .then(result => {
                    if (result.success) {
                        // 저장된 데이터 스냅샷 기록
                        entrySavedData[id] = {
                            width: entry.width, height: entry.height,
                            frameColor: entry.frameColor, meshColor: entry.meshColor,
                            privacyColor: entry.privacyColor || '',
                            type: entry.type, name: entry.name
                        };
                        if (result.recordId) entryRecordId[id] = result.recordId;

                        const msg = result.isUpdate ? '🔄 수정 저장 완료!' : '✅ 저장 완료!';
                        const onlineMsg = result.savedOnline ? ' (온라인+로컬)' : ' (로컬)';
                        // alert 대신 버튼에 잠깐 표시 후 복구
                        const btn = document.getElementById('save-btn-' + id);
                        if (btn) {
                            btn.innerHTML = msg;
                            btn.style.background = 'linear-gradient(135deg,#6B7685,#4A5260)';
                        }
                        const freshLocal = getLocalAll();
                        allCalculationsCache = mergeData([], freshLocal);
                    } else {
                        alert('❌ 저장 실패: ' + (result.error || '오류'));
                    }
                })
                .catch(err => { alert('❌ 저장 오류: ' + err.message); })
                .finally(() => {
                    entrySaveLock[id] = false;
                    updateSaveBtnState(id);
                });
        };

        // 업데이트 지원 저장 함수
        async function saveToGoogleSheetsWithUpdate(type, widthInch, heightInch, customerInfo, results, existingId) {
            const isUpdate = !!existingId;
            const id = existingId || ('R_' + Date.now().toString());
            const timestamp = new Date().toISOString();
            const record = {
                id, timestamp, type, widthInch, heightInch,
                customer: customerInfo.customer || '',
                date: customerInfo.date || '',
                address: customerInfo.address || '',
                location: customerInfo.location || '',
                locations: customerInfo.locations || [],
                locationEntries: customerInfo.locationEntries || [],   // ← 전체 엔트리 저장
                email: customerInfo.email || '',
                phone: customerInfo.phone || '',
                frameColor: customerInfo.frameColor || '',
                meshColor: customerInfo.meshColor || '',
                privacyColor: customerInfo.privacyColor || '',
                results: results,
                _localOnly: true
            };
            saveToLocal(record);

            if (navigator.onLine) {
                try {
                    const data = await callGAS({
                        password: userPassword,
                        action: isUpdate ? 'update' : 'save',
                        id, type, widthInch, heightInch,
                        customer: customerInfo.customer, date: customerInfo.date,
                        address: customerInfo.address, location: customerInfo.location,
                        locations: customerInfo.locations,
                        locationEntries: customerInfo.locationEntries,
                        email: customerInfo.email, phone: customerInfo.phone,
                        frameColor: customerInfo.frameColor, meshColor: customerInfo.meshColor,
                        privacyColor: customerInfo.privacyColor || '',
                        results
                    });
                    if (data.success) {
                        record._localOnly = false;
                        saveToLocal(record);
                        return { success: true, savedOnline: true, recordId: id, isUpdate };
                    }
                } catch(e) {}
            }
            return { success: true, savedOnline: false, recordId: id, isUpdate };
        }

        // 설치장소 데이터 가져오기 (견적서 등에서 활용)
        function getLocationEntries() {
            return locationEntries;
        }

        // getLocations 호환 (기존 코드)
        function getLocations(type) {
            return locationEntries
                .filter(e => e.type === type)
                .map(e => e.name || '(이름 없음)');
        }

        function setLocations(type, locArray, entryDataArray) {
            // 불러오기 시: 기존 엔트리 중 해당 type 것들 제거 후 재추가
            locationEntries = locationEntries.filter(e => e.type !== type);
            if (locArray && locArray.length > 0) {
                locArray.forEach((name, idx) => {
                    const ed = (entryDataArray && entryDataArray[idx]) || {};
                    addLocationEntry({
                        name: name,
                        type: ed.type || type,
                        width: ed.width || '',
                        height: ed.height || '',
                        frameColor: ed.frameColor || '',
                        meshColor: ed.meshColor || '',
                        privacyColor: ed.privacyColor || '',
                        unit: ed.unit || 'inch'
                    });
                });
            }
        }

        // initLocationList 호환 (기존 코드)
        function initLocationList(type) {
            // 새 UI에서는 아무 작업 없음 (빈 상태가 기본)
        }

        // ==================== 설치장소 끝 ====================


        // ==================== 견적서 기능 ====================

        const ESTIMATE_PRICE_KEY = 'ibuild_estimate_prices';
        const GE_TAX_RATE = 0.04712;

        function getEstimatePrices() {
            try {
                const saved = localStorage.getItem(ESTIMATE_PRICE_KEY);
                if (saved) return JSON.parse(saved);
            } catch(e) {}
            return { single: 45, double: 50, customColor: 5 };
        }

        // 계산기 프레임 색상 → 견적서 라디오 동기화
        window.syncFrameColorToEstimate = function(type) {
            // 현재 활성 탭과 일치할 때만 동기화
            const activeTab = document.querySelector('.content.active');
            if (!activeTab || activeTab.id !== type) return;
            const frameColorEl = document.getElementById('frame-color-' + type);
            if (!frameColorEl) return;
            const val = frameColorEl.value; // Black, White, Silver, Custom
            const radio = document.querySelector('input[name="estimateColor"][value="' + val + '"]');
            if (radio) { radio.checked = true; updateColorStyles(); recalcEstimate(); }
        };

        window.savePriceSettings = function() {
            const single = parseFloat(document.getElementById('basePriceSingle').value) || 45;
            const dbl    = parseFloat(document.getElementById('basePriceDouble').value) || 50;
            const cc     = parseFloat(document.getElementById('customColorPrice').value) || 5;
            try { localStorage.setItem(ESTIMATE_PRICE_KEY, JSON.stringify({ single, double: dbl, customColor: cc })); } catch(e) {}
            const msg = document.getElementById('priceSaveMsg');
            msg.style.display = 'inline';
            setTimeout(() => { msg.style.display = 'none'; }, 2000);
            recalcEstimate();
        };

        window.togglePriceSettings = function() {
            const panel = document.getElementById('priceSettingsPanel');
            const icon  = document.getElementById('priceSettingsToggleIcon');
            const open  = panel.style.display === 'none';
            panel.style.display = open ? 'block' : 'none';
            icon.textContent    = open ? '▲' : '▼';
        };

        // Special type 변경 시 할인 입력 영역 표시
        window.onSpecialTypeChange = function() {
            const type = document.getElementById('specialPriceType').value;
            const row  = document.getElementById('specialDiscountRow');
            row.style.display = type === 'none' ? 'none' : 'block';
            if (type !== 'none') {
                // 기본 할인율 preset: contractor 10%, military 15%
                const defaults = { contractor: 10, military: 15 };
                const input = document.getElementById('discountValue');
                if (!input.value) input.value = defaults[type] || 10;
                highlightPresetBtn(parseFloat(input.value));
            }
            recalcEstimate();
        };

        window.setDiscountPreset = function(pct) {
            document.getElementById('discountValue').value = pct;
            highlightPresetBtn(pct);
            recalcEstimate();
        };

        function highlightPresetBtn(pct) {
            document.querySelectorAll('.discount-preset-btn').forEach(b => {
                const val = parseFloat(b.textContent);
                b.style.background = (val === pct) ? '#ffcc02' : '#fff3cd';
                b.style.borderColor = (val === pct) ? '#e6a800' : '#ffcc02';
            });
        }

        function updateColorStyles() {
            document.querySelectorAll('#colorOptionGroup label').forEach(label => {
                const radio = label.querySelector('input[type="radio"]');
                if (radio && radio.checked) {
                    label.style.borderColor = 'var(--primary)';
                    label.style.background  = 'rgba(44,95,45,0.07)';
                } else {
                    label.style.borderColor = '#e0e0e0';
                    label.style.background  = 'white';
                }
            });
        }

        // 견적 모달: 설치장소별 제품 리스트 렌더링 (카드 형태)
        function renderEstimateProductList() {
            const wrap  = document.getElementById('est-product-list-wrap');
            const table = document.getElementById('est-product-list-table');
            if (!wrap || !table) return;

            const prices   = getEstimatePrices();
            const selColor = document.querySelector('input[name="estimateColor"]:checked');
            const isCustom = selColor && selColor.value === 'Custom';
            const entries  = (locationEntries || []).filter(e => e.width && e.height);
            entries.forEach(e => {
                if (!e.areaVal || e.areaVal === 0) calcEntry(e.id);
            });
            const validEntries = entries.filter(e => e.areaVal > 0);

            if (validEntries.length === 0) { wrap.style.display = 'none'; return; }
            wrap.style.display = 'block';

            // 장소 이름 기준 그룹화
            const groups = {};
            validEntries.forEach(e => {
                const key = (e.name || '이름 없음').trim();
                if (!groups[key]) groups[key] = [];
                groups[key].push(e);
            });

            const placeKeys = Object.keys(groups);
            let grandTotal = 0;

            // ── 상단 요약 테이블 ──
            let html = '<table style="width:100%;border-collapse:collapse;font-size:0.88em;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.08);margin-bottom:20px;">';
            html += '<thead><tr style="background:var(--primary);color:white;">'
                  + '<th style="padding:11px 13px;text-align:left;">장소</th>'
                  + '<th style="padding:11px 13px;text-align:center;">#</th>'
                  + '<th style="padding:11px 13px;text-align:center;">타입</th>'
                  + '<th style="padding:11px 13px;text-align:center;">크기 (W × H)</th>'
                  + '<th style="padding:11px 13px;text-align:center;">면적 (SF)</th>'
                  + '<th style="padding:11px 13px;text-align:center;">색상</th>'
                  + '<th style="padding:11px 13px;text-align:right;">소계</th>'
                  + '</tr></thead><tbody>';

            placeKeys.forEach((placeName, pIdx) => {
                const items = groups[placeName];
                let placeSubtotal = 0;

                items.forEach((e, i) => {
                    const unitPrice  = e.type === 'single' ? prices.single : prices.double;
                    const colorExtra = isCustom ? (e.areaVal * prices.customColor) : 0;
                    const sub        = (e.areaVal * unitPrice) + colorExtra;
                    placeSubtotal   += sub;
                    grandTotal      += sub;

                    const bg = pIdx % 2 === 0 ? '#fff' : '#f5faf5';
                    const typeLabel = e.type === 'single'
                        ? '<span style="background:#EAEDEF;color:var(--primary);padding:2px 9px;border-radius:10px;font-size:0.82em;font-weight:700;border:1px solid #D0D7DC;">📏 Single</span>'
                        : '<span style="background:#e3f2fd;color:#1565c0;padding:2px 9px;border-radius:10px;font-size:0.82em;font-weight:700;border:1px solid #90caf9;">📐 Double</span>';

                    const colorDots = {'Black':'#1a1a1a','White':'#f0f0f0','Silver':'#c0c0c0'};
                    const dotStyle  = e.frameColor === 'Custom'
                        ? 'background:linear-gradient(135deg,#ff6b6b,#4ecdc4,#ffd93d);'
                        : ('background:' + (colorDots[e.frameColor] || '#ccc') + ';');
                    const dotBorder = e.frameColor === 'White' ? 'border:1px solid #ccc;' : '';
                    const sizeText  = (e.widthDisp && e.widthDisp !== '-')
                        ? e.widthDisp + '" &times; ' + e.heightDisp + '"'
                        : e.width + ' &times; ' + e.height + ' ' + (e.unit || 'inch');

                    let placeCell = '';
                    if (i === 0) {
                        placeCell = '<td rowspan="' + items.length + '" style="padding:10px 13px;font-weight:700;color:var(--primary);vertical-align:middle;border-right:3px solid #D0D7DC;background:' + bg + ';width:18%;">'
                                  + '<div style="display:flex;align-items:center;gap:7px;">'
                                  + '<span style="min-width:22px;height:22px;background:var(--primary);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.75em;font-weight:800;">' + (pIdx+1) + '</span>'
                                  + '<span>' + placeName + '</span></div></td>';
                    }
                    html += '<tr style="background:' + bg + ';">'
                          + placeCell
                          + '<td style="padding:10px 13px;text-align:center;color:#999;font-size:0.85em;font-weight:600;">' + (i+1) + '</td>'
                          + '<td style="padding:10px 13px;text-align:center;">' + typeLabel + '</td>'
                          + '<td style="padding:10px 13px;text-align:center;font-family:monospace;font-size:0.88em;">' + sizeText + '</td>'
                          + '<td style="padding:10px 13px;text-align:center;font-weight:700;color:var(--primary);">' + e.areaVal.toFixed(2) + '</td>'
                          + '<td style="padding:10px 13px;text-align:center;">'
                          + '<div style="display:inline-flex;align-items:center;gap:5px;">'
                          + '<span style="display:inline-block;width:11px;height:11px;border-radius:50%;' + dotStyle + dotBorder + 'flex-shrink:0;"></span>'
                          + (e.frameColor || '-') + '</div></td>'
                          + '<td style="padding:10px 13px;text-align:right;font-weight:700;color:#333;">$' + sub.toFixed(2) + '</td>'
                          + '</tr>';
                });
                if (items.length > 1) {
                    html += '<tr style="background:#EAEDEF;">'
                          + '<td colspan="6" style="padding:8px 13px;font-size:0.85em;font-weight:600;color:var(--primary);text-align:right;padding-right:16px;">📍 ' + placeName + ' 소계</td>'
                          + '<td style="padding:8px 13px;text-align:right;font-weight:800;color:var(--primary);">$' + placeSubtotal.toFixed(2) + '</td>'
                          + '</tr>';
                }
            });

            html += '<tr style="background:#5A6472;color:white;">'
                  + '<td colspan="6" style="padding:13px 15px;font-weight:700;font-size:0.95em;">소계 (할인·세금 전)</td>'
                  + '<td style="padding:13px 15px;text-align:right;font-weight:900;font-size:1.15em;color:#D4A574;">$' + grandTotal.toFixed(2) + '</td>'
                  + '</tr>';
            html += '</tbody></table>';

            // ── 장소별 개별 카드 (2개 이상일 때만) ──
            if (placeKeys.length >= 2) {
                html += '<div style="margin-top:6px;">';
                html += '<div style="font-weight:700;color:var(--primary);font-size:0.95em;margin-bottom:12px;">📍 설치장소별 상세</div>';
                html += '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;">';

                placeKeys.forEach((placeName, pIdx) => {
                    const items = groups[placeName];
                    let pTotal = 0;
                    items.forEach(e => {
                        const up = e.type === 'single' ? prices.single : prices.double;
                        const ce = isCustom ? (e.areaVal * prices.customColor) : 0;
                        pTotal += (e.areaVal * up) + ce;
                    });

                    const cardColors = ['var(--primary)','#1565C0','#7B1FA2','#E64A19','#00695C','#558B2F'];
                    const cc = cardColors[pIdx % cardColors.length];

                    html += '<div style="border:2px solid ' + cc + ';border-radius:14px;overflow:hidden;">';
                    html += '<div style="background:' + cc + ';color:white;padding:10px 14px;display:flex;align-items:center;gap:8px;">'
                          + '<span style="width:24px;height:24px;background:rgba(255,255,255,0.25);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.8em;font-weight:800;flex-shrink:0;">' + (pIdx+1) + '</span>'
                          + '<span style="font-weight:700;font-size:0.95em;flex:1;">' + placeName + '</span>'
                          + '<span style="font-weight:900;font-size:1.05em;">$' + pTotal.toFixed(2) + '</span>'
                          + '</div>';
                    html += '<div style="padding:12px;">';
                    items.forEach((e, i) => {
                        const sizeText = (e.widthDisp && e.widthDisp !== '-')
                            ? e.widthDisp + '" × ' + e.heightDisp + '"'
                            : e.width + ' × ' + e.height + ' ' + (e.unit || 'inch');
                        const tBadge = e.type === 'single'
                            ? '<span style="background:#EAEDEF;color:var(--primary);padding:1px 7px;border-radius:8px;font-size:0.78em;font-weight:700;border:1px solid #D0D7DC;">Single</span>'
                            : '<span style="background:#e3f2fd;color:#1565c0;padding:1px 7px;border-radius:8px;font-size:0.78em;font-weight:700;border:1px solid #90caf9;">Double</span>';
                        const up = e.type === 'single' ? prices.single : prices.double;
                        const ce = isCustom ? (e.areaVal * prices.customColor) : 0;
                        const sub = (e.areaVal * up) + ce;
                        html += '<div style="' + (i>0?'border-top:1px solid #eee;margin-top:8px;padding-top:8px;':'') + 'font-size:0.88em;">'
                              + '<div style="display:flex;align-items:center;gap:6px;margin-bottom:4px;">'
                              + '<span style="color:#888;font-size:0.82em;font-weight:600;">' + (i+1) + '.</span>'
                              + tBadge
                              + '<span style="font-family:monospace;font-size:0.9em;">' + sizeText + '</span>'
                              + '</div>'
                              + '<div style="display:flex;justify-content:space-between;color:#555;">'
                              + '<span>' + e.areaVal.toFixed(2) + ' SF × $' + up.toFixed(2) + (isCustom ? ' +Custom' : '') + '</span>'
                              + '<span style="font-weight:700;color:' + cc + ';">$' + sub.toFixed(2) + '</span>'
                              + '</div>'
                              + '</div>';
                    });
                    html += '</div></div>';
                });

                html += '</div></div>';
            }

            table.innerHTML = html;
        }

        window.recalcEstimate = function() {
            try {
            updateColorStyles();

            const prices = getEstimatePrices();

            // 전체 설치장소 면적 합산 (각 엔트리 저장값 사용, 없으면 자동 계산)
            let areaSingle = 0, areaDouble = 0;
            (locationEntries || []).forEach(e => {
                if (!e.width || !e.height) return;
                if (!e.areaVal || e.areaVal === 0) calcEntry(e.id);
                const a = e.areaVal || 0;
                if (e.type === 'single') areaSingle += a;
                else areaDouble += a;
            });
            const area = areaSingle + areaDouble;

            // 제품별 리스트 업데이트
            renderEstimateProductList();

            // 색상 (Custom 여부)
            const selColor = document.querySelector('input[name="estimateColor"]:checked');
            const isCustom = selColor && selColor.value === 'Custom';

            // 가중 단가 (single/double 비율로 혼합)
            const totalArea = areaSingle + areaDouble || 1;
            const blendedPrice = (areaSingle / totalArea) * prices.single + (areaDouble / totalArea) * prices.double;
            const unitPrice = area > 0 ? blendedPrice : prices.single;
            const basePrice  = areaSingle * prices.single + areaDouble * prices.double;
            const colorExtra = isCustom ? area * prices.customColor : 0;
            const subtotal   = basePrice + colorExtra;

            // 할인
            const spType   = document.getElementById('specialPriceType').value;
            const discPct  = spType !== 'none' ? (parseFloat(document.getElementById('discountValue').value) || 0) : 0;
            const discAmt  = subtotal * (discPct / 100);
            const afterDisc = subtotal - discAmt;

            // GE Tax
            const taxApply = document.getElementById('geTaxApply').checked;
            const taxAmt   = taxApply ? afterDisc * GE_TAX_RATE : 0;
            const total    = afterDisc + taxAmt;

            // label 매핑
            const specialLabels = { none: '없음', contractor: '🔨 CONTRACTOR', military: '🎖️ MILITARY' };
            const discTypeLabel = spType !== 'none'
                ? (specialLabels[spType] || spType) + ' (' + discPct.toFixed(1) + '% 할인)'
                : '없음';

            // DOM 업데이트
            document.getElementById('est-base-price').textContent   = '$' + basePrice.toFixed(2);
            document.getElementById('est-color-extra').textContent   = '$' + colorExtra.toFixed(2);
            document.getElementById('est-after-discount').textContent = '$' + afterDisc.toFixed(2);
            document.getElementById('est-tax-box').textContent       = '$' + taxAmt.toFixed(2);
            document.getElementById('est-tax-amount').textContent    = '$' + taxAmt.toFixed(2);
            document.getElementById('est-discount-amount').textContent = '-$' + discAmt.toFixed(2);
            document.getElementById('est-discount-type-label').textContent = discTypeLabel;
            document.getElementById('est-total').textContent         = '$' + total.toFixed(2);
            document.getElementById('est-total-label').textContent   = taxApply
                ? '총 견적 금액 (세금 포함)' : '총 견적 금액 (세전)';
            document.getElementById('est-unit-info').textContent     =
                (areaSingle > 0 ? 'Single ' + areaSingle.toFixed(2) + 'SF×$' + prices.single.toFixed(2) : '') +
                (areaSingle > 0 && areaDouble > 0 ? ' + ' : '') +
                (areaDouble > 0 ? 'Double ' + areaDouble.toFixed(2) + 'SF×$' + prices.double.toFixed(2) : '') +
                (isCustom ? ' + Custom $' + prices.customColor.toFixed(2) + '/SF' : '') +
                (discPct > 0 ? ' − ' + discPct + '% discount' : '') +
                (taxApply ? ' + GE Tax 4.712%' : '') || (area.toFixed(2) + ' SF');
            } catch(err) {
                console.error('견적 계산 오류:', err);
            }
        };

        window.showEstimateModal = function() {
            try {
            // P.O. Number 새로 생성
            currentPONumber = generatePONumber();
            const poEl = document.getElementById('est-po-number');
            if (poEl) poEl.textContent = currentPONumber;

            const prices = getEstimatePrices();
            // 가격 설정 입력 채우기
            document.getElementById('basePriceSingle').value  = prices.single;
            document.getElementById('basePriceDouble').value  = prices.double;
            document.getElementById('customColorPrice').value = prices.customColor;

            // 고객 정보
            const customer = document.getElementById('customer-single')?.value || '-';
            const phone    = document.getElementById('phone-single')?.value    || '-';
            const email    = document.getElementById('email-single')?.value    || '-';
            document.getElementById('est-customer').textContent = customer;
            const phoneEl = document.getElementById('est-phone');
            if (phoneEl) phoneEl.textContent = phone;
            const emailEl = document.getElementById('est-email');
            if (emailEl) emailEl.textContent = email;

            // 설치장소 요약: 모든 엔트리 — 미계산 항목도 자동 계산
            locationEntries.forEach(e => {
                if (e.width && e.height) {
                    calcEntry(e.id);
                }
            });

            const entries = locationEntries;
            const totalSingle = entries.filter(e => e.type === 'single').length;
            const totalDouble = entries.filter(e => e.type === 'double').length;
            const typeText = [];
            if (totalSingle > 0) typeText.push('Single ×' + totalSingle);
            if (totalDouble > 0) typeText.push('Double ×' + totalDouble);
            document.getElementById('est-door-type').textContent = typeText.join(' / ') || '-';

            // 총 면적 계산 (entry의 areaVal 우선 사용)
            let totalArea = 0;
            entries.forEach(e => {
                if (e.width && e.height) {
                    if (e.areaVal && e.areaVal > 0) {
                        totalArea += e.areaVal;
                    } else {
                        // areaVal 없으면 직접 계산
                        let w = parseFloat(e.width) || 0;
                        let h = parseFloat(e.height) || 0;
                        if (e.unit !== 'mm') { w *= 1; h *= 1; } // 인치 그대로
                        else { w /= 25.4; h /= 25.4; } // mm → 인치 변환
                        const sf = (w * h / 144);
                        if (sf > 0) totalArea += sf;
                    }
                }
            });
            document.getElementById('est-area').textContent = totalArea.toFixed(2) + ' SF';
            document.getElementById('est-size').textContent = entries.length + '개 장소';

            // 설치장소 태그 표시
            const locWrap = document.getElementById('est-locations-wrap');
            const locList = document.getElementById('est-locations-list');
            if (entries.length > 0) {
                locWrap.style.display = 'block';
                locList.innerHTML = entries.map((e, i) =>
                    '<span style="background:#EAEDEF;color:var(--primary);padding:4px 12px;border-radius:20px;font-size:0.88em;font-weight:600;border:1px solid #D0D7DC; margin-bottom:4px;">' +
                    (i+1) + '. ' + (e.name || '이름 없음') + ' (' + (e.type === 'single' ? 'Single' : 'Double') + ')</span>'
                ).join('');
            } else {
                locWrap.style.display = 'none';
                locList.innerHTML = '';
            }

            // 가장 많은 타입의 첫 번째 색상으로 라디오 자동 선택
            const firstEntry = entries[0];
            const frameVal = firstEntry ? (firstEntry.frameColor || 'Black') : 'Black';
            document.querySelectorAll('input[name="estimateColor"]').forEach(r => { r.checked = false; });
            const matchRadio = document.querySelector('input[name="estimateColor"][value="' + frameVal + '"]');
            if (matchRadio) { matchRadio.checked = true; }
            else { const fb = document.querySelector('input[name="estimateColor"][value="Black"]'); if (fb) fb.checked = true; }

            // 할인 초기화
            document.getElementById('specialPriceType').value = 'none';
            document.getElementById('specialDiscountRow').style.display = 'none';
            document.getElementById('discountValue').value = '';

            recalcEstimate();
            renderEstimateProductList();
            document.getElementById('estimateModal').style.display = 'block';
            } catch(err) {
                console.error('견적서 열기 오류:', err);
                // 오류가 나도 모달은 열어줌
                document.getElementById('estimateModal').style.display = 'block';
            }
        };

        window.closeEstimateModal = function() {
            document.getElementById('estimateModal').style.display = 'none';
        };

        // ==================== 이메일 / SMS 발송 ====================

        // 견적 요약 텍스트 생성 (이메일/SMS 공통)
        function buildEstimateSummary(forEmail) {
            const customer  = (document.getElementById('customer-single') || {}).value || '-';
            const address   = (document.getElementById('address-single')  || {}).value || '-';
            const phone     = (document.getElementById('phone-single')    || {}).value || '-';
            const email     = (document.getElementById('email-single')    || {}).value || '';
            const poNum     = currentPONumber || generatePONumber();
            const memo      = (document.getElementById('estimateMemo')    || {}).value || '';
            const prices    = getEstimatePrices();

            const selColor  = document.querySelector('input[name="estimateColor"]:checked');
            const colorValue = selColor ? selColor.value : 'Black';
            const isCustom  = colorValue === 'Custom';
            const spType    = document.getElementById('specialPriceType').value;
            const discPct   = spType !== 'none' ? (parseFloat(document.getElementById('discountValue').value) || 0) : 0;
            const taxApply  = document.getElementById('geTaxApply').checked;
            const specialLabels = { none: 'Standard', contractor: 'CONTRACTOR', military: 'MILITARY' };
            const spLabel   = specialLabels[spType] || 'Standard';

            const entries = (locationEntries || []).filter(e => e.width && e.height && e.areaVal > 0);
            let areaSingle = 0, areaDouble = 0, basePrice = 0, colorExtra = 0;
            entries.forEach(e => {
                const a = e.areaVal || 0;
                const unitPrice = e.type === 'single' ? prices.single : prices.double;
                basePrice += a * unitPrice;
                if (isCustom) colorExtra += a * prices.customColor;
                if (e.type === 'single') areaSingle += a; else areaDouble += a;
            });
            const subtotal  = basePrice + colorExtra;
            const discAmt   = subtotal * (discPct / 100);
            const afterDisc = subtotal - discAmt;
            const taxAmt    = taxApply ? afterDisc * (typeof GE_TAX_RATE !== 'undefined' ? GE_TAX_RATE : 0.04712) : 0;
            const total     = afterDisc + taxAmt;

            // 설치장소 목록
            const locLines = entries.map((e, i) =>
                `  ${i+1}. ${e.name || '장소'+(i+1)} — ${e.type==='single'?'Single':'Double'} | ${e.width}×${e.height} ${e.unit||'in'} | ${e.areaVal.toFixed(2)} SF${e.frameColor ? ' | Frame: '+e.frameColor : ''}`
            ).join(forEmail ? '\n' : ', ');

            const NL = forEmail ? '\n' : ' | ';

            let body = '';
            if (forEmail) {
                body =
`Dear ${customer},

Thank you for your interest in iBuild INC. screen door services.
Please find your estimate details below.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ESTIMATE — iBuild INC.
  P.O. Number : ${poNum}
  Address     : ${address}
  Frame Color : ${colorValue}
  Price Type  : ${spLabel}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📍 Installation Locations:
${locLines || '  (No items)'}

💰 Price Breakdown:
${areaSingle > 0 ? `  Single  : ${areaSingle.toFixed(2)} SF × $${prices.single.toFixed(2)}/SF = $${(areaSingle*prices.single).toFixed(2)}\n` : ''}${areaDouble > 0 ? `  Double  : ${areaDouble.toFixed(2)} SF × $${prices.double.toFixed(2)}/SF = $${(areaDouble*prices.double).toFixed(2)}\n` : ''}${isCustom ? `  Custom Color: +$${colorExtra.toFixed(2)}\n` : ''}  Subtotal : $${subtotal.toFixed(2)}${discPct > 0 ? `\n  Discount (${discPct}%): -$${discAmt.toFixed(2)}\n  After Discount: $${afterDisc.toFixed(2)}` : ''}${taxApply ? `\n  GE Tax (4.712%): $${taxAmt.toFixed(2)}` : ''}
  ─────────────────────────────
  TOTAL    : $${total.toFixed(2)}${taxApply ? ' (tax included)' : ''}

${memo ? `📝 Note: ${memo}\n` : ''}
This estimate is valid for 30 days from the date of issue.
For questions, please contact us:

  iBuild INC.
  614 Cooke Street #203, Honolulu, Hawaii 96813
  📞 1-808-600-5525
  🌐 www.ibuildhawaii.com

Thank you for your business!
iBuild INC. Team`;
            } else {
                // SMS — 간결하게
                body =
`[iBuild INC. Estimate]
P.O.: ${poNum}
Customer: ${customer}
${locLines}
Total: $${total.toFixed(2)}${taxApply?' (tax incl.)':''}
Valid 30 days.
Questions: 808-600-5525
www.ibuildhawaii.com`;
            }
            return { body, email, phone, customer, poNum, total };
        }

        window.sendEstimateEmail = function() {
            const { body, email, customer, poNum } = buildEstimateSummary(true);
            const statusEl = document.getElementById('send-status-msg');

            if (!email || email === '-') {
                statusEl.style.display = 'block';
                statusEl.style.background = '#FFF3E0';
                statusEl.style.color = '#E65100';
                statusEl.style.border = '1px solid #FFCC80';
                statusEl.textContent = '⚠️ 고객 이메일이 입력되지 않았습니다. 고객정보에서 이메일을 먼저 입력해주세요.';
                setTimeout(() => { statusEl.style.display = 'none'; }, 4000);
                return;
            }

            const subject = encodeURIComponent(`[iBuild INC.] Estimate — P.O. ${poNum} / ${customer}`);
            const bodyEnc = encodeURIComponent(body);
            const mailtoLink = `mailto:${encodeURIComponent(email)}?subject=${subject}&body=${bodyEnc}`;

            // mailto 링크로 기본 메일 앱 열기
            const a = document.createElement('a');
            a.href = mailtoLink;
            a.click();

            statusEl.style.display = 'block';
            statusEl.style.background = '#E3F2FD';
            statusEl.style.color = '#1565C0';
            statusEl.style.border = '1px solid #90CAF9';
            statusEl.textContent = `✅ 이메일 앱이 열렸습니다 — 수신: ${email}`;
            setTimeout(() => { statusEl.style.display = 'none'; }, 4000);
        };

        window.sendEstimateSMS = function() {
            const { body, phone, customer } = buildEstimateSummary(false);
            const statusEl = document.getElementById('send-status-msg');

            if (!phone || phone === '-') {
                statusEl.style.display = 'block';
                statusEl.style.background = '#FFF3E0';
                statusEl.style.color = '#E65100';
                statusEl.style.border = '1px solid #FFCC80';
                statusEl.textContent = '⚠️ 고객 전화번호가 입력되지 않았습니다. 고객정보에서 전화번호를 먼저 입력해주세요.';
                setTimeout(() => { statusEl.style.display = 'none'; }, 4000);
                return;
            }

            // 전화번호 정리 (숫자와 +만 남김)
            const cleanPhone = phone.replace(/[^\d+]/g, '');
            const bodyEnc = encodeURIComponent(body);

            // sms: 링크 — iOS는 &, Android는 ?
            const smsLink = `sms:${cleanPhone}${/iPhone|iPad|iPod/i.test(navigator.userAgent) ? '&' : '?'}body=${bodyEnc}`;

            const a = document.createElement('a');
            a.href = smsLink;
            a.click();

            statusEl.style.display = 'block';
            statusEl.style.background = '#E8F5E9';
            statusEl.style.color = '#2E7D32';
            statusEl.style.border = '1px solid #A5D6A7';
            statusEl.textContent = `✅ 문자 앱이 열렸습니다 — 수신: ${phone}`;
            setTimeout(() => { statusEl.style.display = 'none'; }, 4000);
        };

        // ==================== 이메일 / SMS 발송 끝 ====================

        window.printEstimate = function() {
            const prices    = getEstimatePrices();
            const customer  = (document.getElementById('customer-single') || {}).value || '-';
            const address   = (document.getElementById('address-single')  || {}).value || '-';
            const phone     = (document.getElementById('phone-single')    || {}).value || '-';
            const email     = (document.getElementById('email-single')    || {}).value || '-';
            const date      = (document.getElementById('date-single')     || {}).value || new Date().toISOString().split('T')[0];
            const memo      = (document.getElementById('estimateMemo')    || {}).value || '';
            const poNum     = currentPONumber || generatePONumber();

            const selColor   = document.querySelector('input[name="estimateColor"]:checked');
            const colorValue = selColor ? selColor.value : 'Black';
            const isCustom   = colorValue === 'Custom';

            const spType    = document.getElementById('specialPriceType').value;
            const discPct   = spType !== 'none' ? (parseFloat(document.getElementById('discountValue').value) || 0) : 0;
            const taxApply  = document.getElementById('geTaxApply').checked;
            const specialLabels = { none: 'Standard', contractor: 'CONTRACTOR', military: 'MILITARY' };
            const spLabel   = specialLabels[spType] || 'Standard';

            // 엔트리 기반 계산
            const entries   = (locationEntries || []).filter(e => e.width && e.height && e.areaVal > 0);
            let areaSingle  = 0, areaDouble = 0, basePrice = 0, colorExtra = 0;
            entries.forEach(e => {
                const unitPrice = e.type === 'single' ? prices.single : prices.double;
                const a = e.areaVal || 0;
                basePrice  += a * unitPrice;
                if (isCustom) colorExtra += a * prices.customColor;
                if (e.type === 'single') areaSingle += a;
                else areaDouble += a;
            });
            const area      = areaSingle + areaDouble;
            const subtotal  = basePrice + colorExtra;
            const discAmt   = subtotal * (discPct / 100);
            const afterDisc = subtotal - discAmt;
            const taxAmt    = taxApply ? afterDisc * GE_TAX_RATE : 0;
            const total     = afterDisc + taxAmt;

            // 장소 그룹화
            const groups = {};
            entries.forEach(e => {
                const key = (e.name || '이름 없음').trim();
                if (!groups[key]) groups[key] = [];
                groups[key].push(e);
            });

            // 제품 리스트 행 생성
            let productRows = '';
            const placeKeys = Object.keys(groups);
            let listGrandTotal = 0;
            let rowNum = 1;
            placeKeys.forEach((placeName) => {
                const items = groups[placeName];
                items.forEach((e, i) => {
                    const unitP  = e.type === 'single' ? prices.single : prices.double;
                    const cExtra = isCustom ? (e.areaVal * prices.customColor) : 0;
                    const sub    = (e.areaVal * unitP) + cExtra;
                    listGrandTotal += sub;
                    const sizeText = (e.widthDisp && e.widthDisp !== '-')
                        ? e.widthDisp + '" × ' + e.heightDisp + '"'
                        : e.width + ' × ' + e.height;
                    const pcColor = e.privacyColor || '-';
                    productRows +=
                        '<tr>'
                        + '<td style="text-align:center;color:#666;font-size:11px;">' + rowNum++ + '</td>'
                        + '<td style="font-weight:600;color:#333;">' + placeName + '</td>'
                        + '<td style="text-align:center;"><span style="display:inline-block;padding:2px 8px;border-radius:8px;font-size:10px;font-weight:700;' + (e.type==='single'?'background:#EAEDEF;color:#5A6472;':'background:#e3f2fd;color:#1565c0;') + '">' + (e.type==='single'?'Single':'Double') + '</span></td>'
                        + '<td style="text-align:center;font-family:monospace;font-size:12px;">' + sizeText + '</td>'
                        + '<td style="text-align:center;font-weight:700;">' + e.areaVal.toFixed(2) + '</td>'
                        + '<td style="text-align:center;font-size:11px;">' + (e.frameColor||'-') + '</td>'
                        + '<td style="text-align:center;font-size:11px;">' + pcColor + '</td>'
                        + '<td style="text-align:right;font-weight:700;">$' + sub.toFixed(2) + '</td>'
                        + '</tr>';
                });
            });

            // 날짜 포맷
            const dateObj = new Date(date + 'T00:00:00');
            const dateFormatted = dateObj.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });

            const pw = window.open('', '_blank', 'width=820,height=1100');
            pw.document.write(`<!DOCTYPE html>
<html><head><meta charset="UTF-8">
<title>Estimate ${poNum} - ${customer}</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;900&family=Nanum+Myeongjo:wght@700;800&display=swap" rel="stylesheet">
<style>
:root{--primary:#5A6472;--accent:#C4A882;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:"Noto Sans KR",sans-serif;background:white;color:#1a1a1a;font-size:13px;line-height:1.5;}
@media print{@page{size:letter portrait;margin:12mm 14mm;}body{font-size:11.5px;}}
.page{max-width:760px;margin:0 auto;padding:32px 36px;}
/* ── 헤더 ── */
.est-header{display:flex;justify-content:space-between;align-items:flex-start;padding-bottom:18px;border-bottom:3px solid var(--primary);margin-bottom:22px;}
.co-name{font-size:26px;font-weight:900;color:var(--primary);letter-spacing:1px;font-family:"Nanum Myeongjo",serif;}
.co-info{font-size:11px;color:#666;line-height:1.7;margin-top:5px;}
.co-info a{color:var(--primary);text-decoration:none;}
.est-title-block{text-align:right;}
.est-doc-title{font-size:22px;font-weight:900;color:var(--primary);font-family:"Nanum Myeongjo",serif;letter-spacing:2px;text-transform:uppercase;}
.po-box{margin-top:8px;background:#F2F4F5;border:2px solid var(--primary);border-radius:8px;padding:7px 14px;display:inline-block;}
.po-label{font-size:9px;color:#888;font-weight:700;letter-spacing:2px;text-transform:uppercase;}
.po-num{font-size:14px;font-weight:900;color:var(--primary);font-family:monospace;letter-spacing:1px;}
.est-date{font-size:11px;color:#888;margin-top:5px;}
/* ── 고객/회사 정보 2단 ── */
.info-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:18px;}
.info-box{border:1px solid #D8D9DC;border-radius:8px;padding:12px 14px;}
.info-box-title{font-size:10px;font-weight:700;color:white;background:var(--primary);padding:4px 10px;border-radius:4px;display:inline-block;letter-spacing:1px;text-transform:uppercase;margin-bottom:9px;}
.info-row-line{display:flex;gap:6px;margin-bottom:4px;font-size:12px;}
.info-lbl{width:68px;color:#888;flex-shrink:0;font-size:11px;}
.info-val{font-weight:600;color:#222;word-break:break-all;}
/* ── 가격 뱃지 ── */
.sp-badge{display:inline-block;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700;}
.sp-none{background:#f0f0f0;color:#555;border:1px solid #ddd;}
.sp-contractor{background:#fff3cd;color:#b8860b;border:1px solid #ffc107;}
.sp-military{background:#e8f4fd;color:#0d47a1;border:1px solid #90caf9;}
/* ── 제품 테이블 ── */
.section-title{font-size:12px;font-weight:800;color:var(--primary);margin:14px 0 7px;padding-bottom:5px;border-bottom:2px solid var(--primary);letter-spacing:0.3px;}
table{width:100%;border-collapse:collapse;}
.prod-table th{background:var(--primary);color:white;padding:8px 10px;font-size:11px;text-align:left;font-weight:700;}
.prod-table td{padding:7px 10px;border-bottom:1px solid #EAEDEF;font-size:12px;vertical-align:middle;}
.prod-table tr:nth-child(even) td{background:#FAFBFC;}
/* ── 합계 섹션 ── */
.price-section{margin-top:16px;display:grid;grid-template-columns:1fr 300px;gap:16px;align-items:start;}
.price-notes{background:#FFFDF7;border:1px solid #E8D9B0;border-radius:8px;padding:12px 14px;font-size:11.5px;color:#555;line-height:1.8;}
.price-notes strong{color:#8B6914;}
.price-table{border:1px solid #D0D7DC;border-radius:8px;overflow:hidden;}
.price-table table{width:100%;}
.price-table td{padding:7px 14px;font-size:12px;border-bottom:1px solid #EAEDEF;}
.price-table tr:last-child td{border-bottom:none;}
.price-table .lbl{color:#555;width:55%;}
.price-table .val{text-align:right;font-weight:700;}
.total-row-final td{background:var(--primary)!important;color:white!important;font-size:15px!important;font-weight:900!important;padding:10px 14px!important;}
.discount-row td{background:#fff8e1!important;color:#b8860b!important;}
.tax-row td{background:#e3f2fd!important;color:#1565c0!important;}
.subtotal-row td{background:#F2F4F5!important;color:var(--primary)!important;font-weight:700!important;}
/* ── 메모 ── */
.memo-box{background:#FBF9F4;border-left:4px solid var(--accent);border-radius:4px;padding:10px 14px;margin-top:14px;font-size:12px;color:#555;}
/* ── 서명란 ── */
.sign-row{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-top:22px;}
.sign-box{border-top:2px solid #D0D7DC;padding-top:8px;}
.sign-label{font-size:11px;color:#888;font-weight:600;}
/* ── 풋터 ── */
.est-footer{margin-top:24px;padding-top:12px;border-top:1px solid #EAEDEF;text-align:center;font-size:10px;color:#aaa;line-height:1.7;}
</style>
</head><body>
<div class="page">

  <!-- 헤더 -->
  <div class="est-header">
    <div>
      <div class="co-name">iBuild INC.</div>
      <div class="co-info">
        614 Cooke Street #203, Honolulu, Hawaii 96813<br>
        📞 1-808-600-5525 &nbsp;|&nbsp; 🌐 <a href="http://www.ibuildhawaii.com">www.ibuildhawaii.com</a><br>
        Licensed &amp; Insured
      </div>
    </div>
    <div class="est-title-block">
      <div class="est-doc-title">Estimate</div>
      <div class="po-box">
        <div class="po-label">P.O. Number</div>
        <div class="po-num">${poNum}</div>
      </div>
      <div class="est-date">Date: ${dateFormatted}</div>
    </div>
  </div>

  <!-- 고객 정보 + 회사 정보 -->
  <div class="info-row">
    <div class="info-box">
      <div class="info-box-title">Bill To / Customer</div>
      <div class="info-row-line"><span class="info-lbl">Name</span><span class="info-val">${customer}</span></div>
      <div class="info-row-line"><span class="info-lbl">Address</span><span class="info-val">${address}</span></div>
      <div class="info-row-line"><span class="info-lbl">Phone</span><span class="info-val">${phone}</span></div>
      <div class="info-row-line"><span class="info-lbl">Email</span><span class="info-val">${email}</span></div>
      <div class="info-row-line" style="margin-top:6px;"><span class="info-lbl">Price Type</span><span class="info-val"><span class="sp-badge sp-${spType}">${spLabel}</span></span></div>
    </div>
    <div class="info-box">
      <div class="info-box-title">From / Contractor</div>
      <div class="info-row-line"><span class="info-lbl">Company</span><span class="info-val">iBuild INC.</span></div>
      <div class="info-row-line"><span class="info-lbl">Address</span><span class="info-val">614 Cooke St #203<br>Honolulu, HI 96813</span></div>
      <div class="info-row-line"><span class="info-lbl">Phone</span><span class="info-val">1-808-600-5525</span></div>
      <div class="info-row-line"><span class="info-lbl">Web</span><span class="info-val">www.ibuildhawaii.com</span></div>
      <div class="info-row-line" style="margin-top:6px;"><span class="info-lbl">Date</span><span class="info-val">${dateFormatted}</span></div>
    </div>
  </div>

  <!-- 제품 리스트 -->
  <div class="section-title">🪟 Product / Installation List</div>
  <table class="prod-table">
    <thead>
      <tr>
        <th style="width:30px;text-align:center;">#</th>
        <th>Location</th>
        <th style="text-align:center;width:70px;">Type</th>
        <th style="text-align:center;width:110px;">Size (W × H)</th>
        <th style="text-align:center;width:60px;">Area (SF)</th>
        <th style="text-align:center;width:65px;">Frame</th>
        <th style="text-align:center;width:70px;">Privacy</th>
        <th style="text-align:right;width:75px;">Amount</th>
      </tr>
    </thead>
    <tbody>
      ${productRows || '<tr><td colspan="8" style="text-align:center;color:#aaa;padding:20px;">No items</td></tr>'}
    </tbody>
  </table>

  <!-- 합계 + 가격 세부 -->
  <div class="price-section">
    <div class="price-notes">
      <strong>Notes / 유의사항</strong><br>
      • Estimate valid for <strong>30 days</strong> from issue date.<br>
      • Prices based on square footage (SF).<br>
      • Frame: <strong>${colorValue}</strong> color<br>
      ${areaSingle > 0 ? '• Single: ' + areaSingle.toFixed(2) + ' SF × $' + prices.single.toFixed(2) + '/SF<br>' : ''}
      ${areaDouble > 0 ? '• Double: ' + areaDouble.toFixed(2) + ' SF × $' + prices.double.toFixed(2) + '/SF<br>' : ''}
      ${isCustom ? '• Custom Color: ' + area.toFixed(2) + ' SF × $' + prices.customColor.toFixed(2) + '/SF<br>' : ''}
    </div>
    <div class="price-table">
      <table>
        ${areaSingle > 0 ? '<tr><td class="lbl">Single Base</td><td class="val">$' + (areaSingle * prices.single).toFixed(2) + '</td></tr>' : ''}
        ${areaDouble > 0 ? '<tr><td class="lbl">Double Base</td><td class="val">$' + (areaDouble * prices.double).toFixed(2) + '</td></tr>' : ''}
        ${isCustom ? '<tr><td class="lbl">Custom Color</td><td class="val">$' + colorExtra.toFixed(2) + '</td></tr>' : ''}
        <tr class="subtotal-row"><td class="lbl" style="font-weight:700;">Subtotal</td><td class="val">$${subtotal.toFixed(2)}</td></tr>
        ${discPct > 0 ? '<tr class="discount-row"><td class="lbl">' + spLabel + ' Discount (' + discPct + '%)</td><td class="val">−$' + discAmt.toFixed(2) + '</td></tr>' : ''}
        ${discPct > 0 ? '<tr class="subtotal-row"><td class="lbl" style="font-weight:700;">After Discount</td><td class="val">$' + afterDisc.toFixed(2) + '</td></tr>' : ''}
        ${taxApply ? '<tr class="tax-row"><td class="lbl">GE Tax (4.712%)</td><td class="val">$' + taxAmt.toFixed(2) + '</td></tr>' : ''}
        <tr class="total-row-final"><td><strong>TOTAL</strong></td><td style="text-align:right;font-size:16px;font-family:'Nanum Myeongjo',serif;">$${total.toFixed(2)}${taxApply ? ' <span style="font-size:11px;opacity:0.8;">(tax incl.)</span>' : ''}</td></tr>
      </table>
    </div>
  </div>

  ${memo ? '<div class="memo-box"><strong>📝 Note / 메모:</strong><br>' + memo.replace(/\n/g,'<br>') + '</div>' : ''}

  <!-- 서명란 -->
  <div class="sign-row">
    <div class="sign-box">
      <div class="sign-label">Customer Signature &amp; Date</div>
      <div style="height:42px;"></div>
    </div>
    <div class="sign-box">
      <div class="sign-label">Authorized By — iBuild INC.</div>
      <div style="height:42px;"></div>
    </div>
  </div>

  <!-- 풋터 -->
  <div class="est-footer">
    <strong>iBuild INC.</strong> &nbsp;|&nbsp; 614 Cooke Street #203, Honolulu, Hawaii 96813
    &nbsp;|&nbsp; 1-808-600-5525 &nbsp;|&nbsp; www.ibuildhawaii.com<br>
    Thank you for your business! &nbsp;•&nbsp; P.O. ${poNum}
  </div>

</div>
<script>window.onload=function(){window.print();};<\/script>
</body></html>`);
            pw.document.close();
        };

        // ==================== 견적서 기능 끝 ====================


        // ==================== P.O. Number 자동 생성 ====================
        function generatePONumber() {
            const now = new Date();
            const yy = String(now.getFullYear()).slice(2);
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const dd = String(now.getDate()).padStart(2, '0');
            const hhmm = String(now.getHours()).padStart(2, '0') + String(now.getMinutes()).padStart(2, '0');
            // 예: IB-250215-1432
            return 'IB-' + yy + mm + dd + '-' + hhmm;
        }
        // 현재 세션의 P.O. Number (견적서 열기 시 새로 생성)
        let currentPONumber = generatePONumber();

        // 오늘 날짜 자동 설정
        window.onload = function() {

            const today = new Date().toISOString().split('T')[0];

            document.getElementById('date-single').value = today;

            document.getElementById('date-double').value = today;

            // 설치장소 목록 초기화 (빈 상태가 기본 - 새 UI 사용)
            // initLocationList는 호환용으로 빈 함수로 유지됨
            

            // 다이어그램 초기화 (새 UI에서는 개별 계산 시 처리)
        };

    </script>
</body>
</html>