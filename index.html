<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iBuild INC. | ë°©ì¶©ë§ ì£¼ë¬¸ì„œ ê³„ì‚°ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Nanum+Myeongjo:wght@700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2C5F2D;
            --primary-light: #4A8B4D;
            --secondary: #D4A574;
            --accent: #C84630;
            --bg: #FAF8F3;
            --card-bg: #FFFFFF;
            --text: #1A1A1A;
            --text-light: #6B6B6B;
            --border: #E0DDD5;
            --shadow: rgba(44, 95, 45, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        /* ë¡œê·¸ì¸ í™”ë©´ */
        #loginScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1e3a1f 0%, #2d5a2e 50%, #3d7a3f 100%);
            display: flex; align-items: center; justify-content: center; z-index: 10000;
        }

        .login-box {
            background: white; padding: 50px; border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 400px; width: 90%; text-align: center;
        }

        .login-logo { width: 120px; height: auto; margin-bottom: 30px; }
        .login-title { font-size: 28px; font-weight: 700; color: var(--primary); margin-bottom: 10px; }
        .login-input { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; margin-bottom: 20px; }
        .login-button { width: 100%; padding: 15px; background: linear-gradient(135deg, var(--primary), #2d5a2e); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .login-error { color: #dc3545; font-size: 14px; margin-top: 10px; display: none; }

        #mainApp { display: none; }
        .container { max-width: 1200px; margin: 0 auto; }

        header {
            text-align: center; margin-bottom: 50px; padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 20px; color: white; position: relative; overflow: hidden;
        }

        .tabs { display: flex; gap: 15px; margin-bottom: 30px; justify-content: center; }
        .tab {
            padding: 15px 35px; background: var(--card-bg); border: 2px solid var(--border);
            border-radius: 50px; cursor: pointer; font-weight: 700; transition: all 0.3s;
        }
        .tab.active { background: var(--primary); color: white; border-color: var(--primary); }

        .content { display: none; }
        .content.active { display: block; }

        .card {
            background: var(--card-bg); padding: 35px; border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.06); margin-bottom: 25px; border: 1px solid var(--border);
        }

        .card-title { font-family: 'Nanum Myeongjo', serif; font-size: 1.6em; font-weight: 800; color: var(--primary); margin-bottom: 25px; display: flex; align-items: center; gap: 12px; }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 25px; }
        label { display: block; margin-bottom: 10px; font-weight: 600; font-size: 0.95em; }
        input, select { width: 100%; padding: 14px 18px; border: 2px solid var(--border); border-radius: 12px; font-size: 1em; }

        .unit-toggle { display: flex; gap: 10px; margin-bottom: 15px; }
        .unit-btn { flex: 1; padding: 10px; border: 2px solid var(--border); border-radius: 10px; cursor: pointer; font-weight: 600; }
        .unit-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .results { background: #F8F6F1; padding: 30px; border-radius: 15px; border: 2px solid var(--secondary); margin-top: 25px; }
        .result-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 12px; background: white; border-radius: 10px; border-left: 4px solid var(--primary); }
        .result-primary { font-weight: 700; color: var(--primary); font-size: 1.2em; font-family: 'Nanum Myeongjo', serif; }
        .result-secondary { font-size: 0.85em; color: var(--text-light); }

        .info-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-top: 25px; }
        .info-card { background: white; padding: 20px; border-radius: 12px; border: 2px solid var(--border); text-align: center; }
        .info-number { font-size: 2.5em; font-weight: 900; font-family: 'Nanum Myeongjo', serif; color: var(--primary); }

        .structure-icon { display: inline-flex; align-items: center; justify-content: center; width: 36px; height: 36px; background: var(--secondary); border-radius: 50%; cursor: pointer; color: white; margin-left: 10px; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal { display: none; position: fixed; z-index: 20000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: white; margin: 5% auto; padding: 20px; border-radius: 15px; max-width: 900px; width: 90%; position: relative; }

        @media print {
            .tabs, .btn-group, #loginScreen, .unit-toggle, button { display: none !important; }
            body { background: white; padding: 0; }
            .card { box-shadow: none; border: 1px solid #eee; }
        }
    </style>
</head>
<body>
    <div id="loginScreen">
        <div class="login-box">
            <img src="ibuild-logo.png" alt="iBuild Logo" class="login-logo">
            <div class="login-title">iBuild INC.</div>
            <input type="password" id="loginPassword" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            <button onclick="login()" class="login-button">ğŸ” ë¡œê·¸ì¸</button>
            <div id="loginError" class="login-error">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</div>
        </div>
    </div>

    <div id="mainApp">
        <div class="container">
            <header>
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <img src="ibuild-logo.png" alt="iBuild Logo" style="height: 60px;">
                    <button onclick="showSavedCalculations()" style="padding: 10px 20px; background: rgba(255,255,255,0.2); border: 1px solid white; color: white; border-radius: 10px; cursor: pointer;">ğŸ“‚ ì €ì¥ ë‚´ì—­</button>
                </div>
                <h1 style="margin-top: 20px;">ğŸªŸ ë°©ì¶©ë§ ì£¼ë¬¸ì„œ ê³„ì‚°ê¸°</h1>
                <p>#203 614 Cooke St, Honolulu, HI 96813 | 1-808-600-5525</p>
            </header>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('single', this)">ğŸ“ ì™¸ë„ì–´ í¸ê°œí˜•</div>
                <div class="tab" onclick="switchTab('double', this)">ğŸ“ ì–‘ê°œí˜•</div>
            </div>

            <div id="single" class="content active">
                <div class="card">
                    <div class="card-title">ğŸ“‹ ê¸°ë³¸ ì •ë³´</div>
                    <div class="input-grid">
                        <div class="input-group"><label>ë‚ ì§œ</label><input type="date" id="date-single"></div>
                        <div class="input-group"><label>ê³ ê°ëª…</label><input type="text" id="customer-single" placeholder="ê³ ê°ëª…"></div>
                        <div class="input-group"><label>ì£¼ì†Œ</label><input type="text" id="address-single" placeholder="ì£¼ì†Œ"></div>
                        <div class="input-group"><label>ì„¤ì¹˜ì¥ì†Œ</label><input type="text" id="location-single" placeholder="ì˜ˆ: ì•ˆë°©"></div>
                        <div class="input-group"><label>ì „í™”ë²ˆí˜¸</label><input type="tel" id="phone-single" placeholder="ì „í™”ë²ˆí˜¸"></div>
                        <div class="input-group"><label>ì´ë©”ì¼</label><input type="email" id="email-single" placeholder="ì´ë©”ì¼"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ“ í¬ê¸° ì…ë ¥</div>
                    <div class="unit-toggle">
                        <button class="unit-btn" onclick="setUnit('single', 'mm', event)">mm</button>
                        <button class="unit-btn active" onclick="setUnit('single', 'inch', event)">inch</button>
                    </div>
                    <div class="input-grid">
                        <div class="input-group"><label>ê°€ë¡œ (W)</label><input type="number" id="width-single" step="any" oninput="calculate('single')"></div>
                        <div class="input-group"><label>ì„¸ë¡œ (H)</label><input type="number" id="height-single" step="any" oninput="calculate('single')"></div>
                    </div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>í”„ë ˆì„ ìƒ‰ìƒ</label>
                            <select id="frame-color-single">
                                <option value="í™”ì´íŠ¸">í™”ì´íŠ¸</option><option value="ë¸Œë¡ ì¦ˆ">ë¸Œë¡ ì¦ˆ</option>
                                <option value="ë¸”ë™">ë¸”ë™</option><option value="ì‹¤ë²„">ì‹¤ë²„</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>ë§ ìƒ‰ìƒ</label>
                            <select id="mesh-color-single">
                                <option value="ë¸”ë™">ë¸”ë™</option><option value="ê·¸ë ˆì´">ê·¸ë ˆì´</option><option value="í™”ì´íŠ¸">í™”ì´íŠ¸</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="calculate('single')" style="flex: 1; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; cursor: pointer;">ğŸ“Š ê³„ì‚°í•˜ê¸°</button>
                        <button onclick="manualSaveCalculation('single')" style="flex: 1; padding: 15px; background: #1976D2; color: white; border: none; border-radius: 12px; cursor: pointer;">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">âœ… ê³„ì‚° ê²°ê³¼</div>
                    <div class="info-section">
                        <div class="info-card"><div class="info-number" id="width-display-single">-</div><div class="info-label">ê°€ë¡œ</div></div>
                        <div class="info-card"><div class="info-number" id="height-display-single">-</div><div class="info-label">ì„¸ë¡œ</div></div>
                        <div class="info-card"><div class="info-number" id="area-display-single">-</div><div class="info-label">SF</div></div>
                    </div>
                    <div class="results">
                        <div class="result-item"><span class="result-label">ìƒ/í•˜ í”„ë ˆì„ (ê° 1ê°œ)</span><div id="frame-top-single" class="result-value-dual">-</div></div>
                        <div class="result-item"><span class="result-label">ë²½ë©´ë°” (2ê°œ)</span><div id="wall-bar-single" class="result-value-dual">-</div></div>
                        <div class="result-item"><span class="result-label">Mesh Length</span><div id="mesh-20-single" class="result-value-dual">-</div></div>
                        <div class="result-item"><span class="result-label">ì‹¤ì˜ ê°œìˆ˜</span><div id="string-count-single" class="result-primary">-</div></div>
                    </div>
                </div>
            </div>

            <div id="double" class="content">
                <div class="card">
                    <div class="card-title">ğŸ“ í¬ê¸° ì…ë ¥ (ì–‘ê°œí˜•)</div>
                    <div class="unit-toggle">
                        <button class="unit-btn" onclick="setUnit('double', 'mm', event)">mm</button>
                        <button class="unit-btn active" onclick="setUnit('double', 'inch', event)">inch</button>
                    </div>
                    <div class="input-grid">
                        <div class="input-group"><label>ê°€ë¡œ (W)</label><input type="number" id="width-double" step="any" oninput="calculate('double')"></div>
                        <div class="input-group"><label>ì„¸ë¡œ (H)</label><input type="number" id="height-double" step="any" oninput="calculate('double')"></div>
                    </div>
                    <button onclick="calculate('double')" style="width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; cursor: pointer;">ğŸ“Š ê³„ì‚° ë° ì €ì¥</button>
                </div>
            </div>

            <footer><p>Â© 2026 IBUILD INC. | Professional Screen Solutions</p></footer>
        </div>
    </div>

    <div id="savedCalculationsModal" class="modal">
        <div class="modal-content">
            <span onclick="closeSavedCalculationsModal()" style="position: absolute; right: 20px; top: 10px; cursor: pointer; font-size: 30px;">&times;</span>
            <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ“‚ ì˜¨ë¼ì¸ ì €ì¥ ë‚´ì—­</h2>
            <div style="margin-bottom: 15px;">
                <input type="text" id="searchInput" oninput="filterCalculations()" placeholder="ê³ ê°ëª… ë˜ëŠ” ì£¼ì†Œ ê²€ìƒ‰" style="padding: 10px; width: 100%; border-radius: 8px; border: 1px solid #ccc;">
            </div>
            <div id="savedCalculationsList" style="max-height: 500px; overflow-y: auto; border-top: 1px solid #eee; padding-top: 15px;">
                <p style="text-align: center; padding: 20px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxyuQ9Jbfe47qKtYqRfrBJdEQgbHPed7QUb1VaBB0GgIfFFfUw_o8EDFXWDnFFCoeWV/exec';
        const APP_PASSWORD = 'Screen10000**';
        let allCalculationsCache = [];
        const units = { single: 'inch', double: 'inch' };

        function login() {
            const pw = document.getElementById('loginPassword').value;
            if (pw === APP_PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                loadOnlineCalculations();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        async function loadOnlineCalculations() {
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?password=${encodeURIComponent(APP_PASSWORD)}&action=load`);
                const data = await response.json();
                if (data.success) {
                    allCalculationsCache = data.data || [];
                    console.log('âœ… ë°ì´í„° ë¡œë“œ ì„±ê³µ:', allCalculationsCache.length);
                }
            } catch (e) { console.error('ë¶ˆëŸ¬ì˜¤ê¸° ì—ëŸ¬:', e); }
        }

        async function manualSaveCalculation(type) {
            const w = parseFloat(document.getElementById(`width-${type}`).value);
            const h = parseFloat(document.getElementById(`height-${type}`).value);
            const customer = document.getElementById(`customer-${type}`).value;

            if (!w || !h || !customer) { alert('ê³ ê°ëª…ê³¼ í¬ê¸°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }

            let wInch = units[type] === 'mm' ? w / 25.4 : w;
            let hInch = units[type] === 'mm' ? h / 25.4 : h;

            const info = {
                customer: customer,
                date: document.getElementById(`date-${type}`).value,
                address: document.getElementById(`address-${type}`).value,
                location: document.getElementById(`location-${type}`).value,
                email: document.getElementById(`email-${type}`).value,
                phone: document.getElementById(`phone-${type}`).value,
                frameColor: document.getElementById(`frame-color-${type}`).value,
                meshColor: document.getElementById(`mesh-color-${type}`).value
            };

            const resMm = calculateSingle(wInch * 25.4, hInch * 25.4);

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        password: APP_PASSWORD, action: 'save', type: type,
                        widthInch: wInch.toFixed(2), heightInch: hInch.toFixed(2),
                        ...info, results: resMm
                    })
                });
                alert('âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadOnlineCalculations();
            } catch (e) { alert('ì €ì¥ ì‹¤íŒ¨'); }
        }

        function loadCalculation(id) {
            const data = allCalculationsCache.find(item => item.id == id);
            if (!data) return;

            const type = data.type === 'double' ? 'double' : 'single';
            switchTab(type, document.querySelectorAll('.tab')[type === 'single' ? 0 : 1]);

            setTimeout(() => {
                setUnit(type, 'inch');
                document.getElementById(`width-${type}`).value = data.widthInch;
                document.getElementById(`height-${type}`).value = data.heightInch;
                document.getElementById(`customer-${type}`).value = data.customer || '';
                document.getElementById(`address-${type}`).value = data.address || '';
                document.getElementById(`location-${type}`).value = data.location || '';
                document.getElementById(`date-${type}`).value = data.date || '';
                
                calculate(type);
                closeSavedCalculationsModal();
            }, 200);
        }

        function calculate(type) {
            let w = parseFloat(document.getElementById(`width-${type}`).value);
            let h = parseFloat(document.getElementById(`height-${type}`).value);
            if (!w || !h) return;

            if (units[type] === 'inch') { w *= 25.4; h *= 25.4; }

            displayDimension(`width-display-${type}`, w);
            displayDimension(`height-display-${type}`, h);

            const res = calculateSingle(w, h);
            displayDualUnit(`frame-top-${type}`, res.frameTop);
            displayDualUnit(`wall-bar-${type}`, res.wallBar);
            displayDualUnit(`mesh-20-${type}`, res.mesh20);
            document.getElementById(`area-display-${type}`).textContent = ( (w/25.4) * (h/25.4) / 144 ).toFixed(2);
            document.getElementById(`string-count-${type}`).textContent = Math.round(calculateHoleCount(res.mesh20) / 2) + 'ê°œ';
        }

        function calculateSingle(w, h) {
            return { frameTop: w - 34, wallBar: h - 26, mesh20: h - 38 };
        }

        function calculateHoleCount(mesh) {
            if (mesh <= 1400) return 4;
            if (mesh <= 2400) return 6;
            return 8;
        }

        function switchTab(tab, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        function setUnit(type, u, ev) {
            units[type] = u;
            const btns = document.querySelectorAll(`#${type} .unit-btn`);
            btns.forEach(b => b.classList.remove('active'));
            if (ev) ev.target.classList.add('active');
            calculate(type);
        }

        function displayDimension(id, mm) {
            const inch = mm / 25.4;
            const whole = Math.floor(inch);
            const frac = Math.round((inch - whole) * 16);
            document.getElementById(id).innerHTML = `${whole}${frac>0?' '+frac+'/16':''}"<br><small>${Math.round(mm)}mm</small>`;
        }

        function displayDualUnit(id, mm) {
            const inch = mm / 25.4;
            document.getElementById(id).innerHTML = `<span class="result-primary">${inch.toFixed(2)}"</span> <span class="result-secondary">(${Math.round(mm)}mm)</span>`;
        }

        function showSavedCalculations() {
            document.getElementById('savedCalculationsModal').style.display = 'block';
            filterCalculations();
        }

        function closeSavedCalculationsModal() { document.getElementById('savedCalculationsModal').style.display = 'none'; }

        function filterCalculations() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const list = document.getElementById('savedCalculationsList');
            const filtered = allCalculationsCache.filter(c => 
                (c.customer || '').toLowerCase().includes(search) || (c.address || '').toLowerCase().includes(search)
            );

            list.innerHTML = filtered.map(c => `
                <div style="padding: 15px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>${c.customer || 'ë¯¸ì§€ì •'}</strong> (${c.date || '-'})<br>
                        <small>${c.widthInch}" x ${c.heightInch}" | ${c.type === 'double' ? 'ì–‘ê°œ' : 'í¸ê°œ'}</small>
                    </div>
                    <button onclick="loadCalculation(${c.id})" style="padding: 5px 15px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer;">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>
            `).join('') || '<p style="text-align:center">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        window.onload = () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date-single').value = today;
        };
    </script>
</body>
</html>
